<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.8" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.29" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://swx08.github.io/vuepress/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/MQ/RabbitMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.html"><meta property="og:site_name" content="æ–‡å­¦åšå®¢"><meta property="og:title" content="RabbitMQæ¶ˆæ¯é˜Ÿåˆ—"><meta property="og:description" content="RabbitMQæ¶ˆæ¯é˜Ÿåˆ— 1.1 MQ çš„ç›¸å…³æ¦‚å¿µ 1.1.1. ä»€ä¹ˆæ˜¯ MQï¼Ÿ MQ(message queue)ï¼Œä»å­—é¢æ„æ€ä¸Šçœ‹ï¼Œæœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼ŒFIFO å…ˆå…¥å…ˆå‡ºï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯ message è€Œå·²ï¼Œè¿˜æ˜¯ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯ã€‚åœ¨äº’è”ç½‘æ¶æ„ä¸­ï¼ŒMQ æ˜¯ä¸€ç§éå¸¸å¸¸ è§çš„ä¸Šä¸‹æ¸¸â€œé€»è¾‘è§£è€¦+ç‰©ç†è§£è€¦â€çš„æ¶ˆæ¯é€šä¿¡æœåŠ¡ã€‚ä½¿ç”¨äº† ..."><meta property="og:type" content="article"><meta property="og:image" content="https://s1.ax1x.com/2023/06/02/pCSt7qS.jpg"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="RabbitMQæ¶ˆæ¯é˜Ÿåˆ—"><meta property="article:author" content="sixkey"><meta property="article:tag" content="RabbitMQ"><meta property="article:published_time" content="2022-01-12T00:00:00.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"RabbitMQæ¶ˆæ¯é˜Ÿåˆ—","image":["https://s1.ax1x.com/2023/06/02/pCSt7qS.jpg","https://s1.ax1x.com/2023/06/02/pCStTr8.jpg","https://s1.ax1x.com/2023/06/02/pCSUM60.jpg","https://s1.ax1x.com/2023/06/02/pCSUKlq.jpg","https://s1.ax1x.com/2023/06/02/pCSBVRH.jpg","https://s1.ax1x.com/2023/06/02/pCSBJzj.jpg","https://s1.ax1x.com/2023/06/02/pCSrjJS.jpg","https://s1.ax1x.com/2023/06/02/pCSyc4K.jpg","https://s1.ax1x.com/2023/06/02/pCScuLj.jpg","https://s1.ax1x.com/2023/06/02/pCS45DO.jpg","https://s1.ax1x.com/2023/06/02/pCShQw4.jpg","https://s1.ax1x.com/2023/06/02/pCSTaoF.jpg","https://s1.ax1x.com/2023/06/02/pCSTKIg.jpg","https://s1.ax1x.com/2023/06/03/pCpc7xU.jpg","https://s1.ax1x.com/2023/06/02/pCS7lTO.jpg","https://s1.ax1x.com/2023/06/02/pCSbAz9.jpg","https://s1.ax1x.com/2023/06/02/pCSbeqx.jpg","https://s1.ax1x.com/2023/06/02/pCSqepQ.jpg","https://s1.ax1x.com/2023/06/02/pCSqmlj.jpg","https://s1.ax1x.com/2023/06/02/pCSqVfg.jpg","https://s1.ax1x.com/2023/06/02/pCpiyZD.jpg","https://s1.ax1x.com/2023/06/02/pCpi6de.jpg","https://s1.ax1x.com/2023/06/02/pCpiIL8.jpg","https://s1.ax1x.com/2023/06/03/pCpNXVS.jpg","https://s1.ax1x.com/2023/06/03/pCpNXVS.jpg","https://s1.ax1x.com/2023/06/03/pCpUNRA.jpg","https://s1.ax1x.com/2023/06/03/pCpauFg.jpg","https://s1.ax1x.com/2023/06/03/pCpwlq0.jpg","https://s1.ax1x.com/2023/06/03/pCpysot.jpg","https://pic.imgdb.cn/item/647ad3abf024cca173b620be.jpg","https://s1.ax1x.com/2023/06/03/pCpcrPP.jpg","https://pic.imgdb.cn/item/647ad543f024cca173b7b63d.jpg","https://pic.imgdb.cn/item/647ad56ef024cca173b7dd3c.jpg","https://pic.imgdb.cn/item/647ad6cff024cca173b91d3f.jpg","https://pic.imgdb.cn/item/647ad6cff024cca173b91d0c.jpg","https://pic.imgdb.cn/item/647ad6cff024cca173b91d1c.jpg","https://pic.imgdb.cn/item/647adf8af024cca173c2aaad.jpg","https://pic.imgdb.cn/item/647adfb5f024cca173c2e98e.jpg","https://pic.imgdb.cn/item/647ae00af024cca173c34b17.jpg","https://pic.imgdb.cn/item/647ae00af024cca173c34b0b.jpg","https://pic.imgdb.cn/item/647ae45ff024cca173c90a16.jpg","https://pic.imgdb.cn/item/647ae45ff024cca173c90a31.jpg","https://s1.ax1x.com/2023/06/04/pC9chkR.jpg","https://s1.ax1x.com/2023/06/04/pC9gS9P.jpg","https://s1.ax1x.com/2023/06/04/pC9gp1f.jpg","https://s1.ax1x.com/2023/06/04/pC9gQuF.jpg","https://s1.ax1x.com/2023/06/04/pC9goUs.jpg","https://s1.ax1x.com/2023/06/04/pC9gT5n.jpg","https://s1.ax1x.com/2023/06/04/pC9gjrF.jpg","https://s1.ax1x.com/2023/06/04/pC9WcCR.jpg","https://s1.ax1x.com/2023/06/04/pC9WfKK.jpg","https://s1.ax1x.com/2023/06/04/pC9fQR1.jpg","https://s1.ax1x.com/2023/06/04/pC94g8s.jpg","https://s1.ax1x.com/2023/06/04/pC95QRs.jpg","https://s1.ax1x.com/2023/06/04/pC9oKvn.jpg","https://s1.ax1x.com/2023/06/04/pC9TVqx.jpg","https://s1.ax1x.com/2023/06/04/pC9T8sI.jpg","https://s1.ax1x.com/2023/06/04/pC9T3QA.jpg","https://s1.ax1x.com/2023/06/04/pC9HmCD.jpg","https://s1.ax1x.com/2023/06/04/pC9xT8P.jpg","https://s1.ax1x.com/2023/06/04/pCCPHvq.jpg","https://s1.ax1x.com/2023/06/05/pCCiHFe.jpg","https://s1.ax1x.com/2023/06/05/pCCiToD.jpg","https://s1.ax1x.com/2023/06/05/pCCibJH.jpg","https://s1.ax1x.com/2023/06/05/pCCytzT.jpg","https://s1.ax1x.com/2023/06/05/pCCyYWV.jpg","https://s1.ax1x.com/2023/06/05/pCCy4wd.jpg","https://s1.ax1x.com/2023/06/05/pCC2d91.jpg","https://s1.ax1x.com/2023/06/05/pCC2UhR.jpg","https://s1.ax1x.com/2023/06/05/pCC2NN9.jpg","https://s1.ax1x.com/2023/06/05/pCCRKVe.jpg","https://s1.ax1x.com/2023/06/05/pCCRnbD.jpg","https://s1.ax1x.com/2023/06/05/pCC4BwT.jpg","https://s1.ax1x.com/2023/06/05/pCC4dO0.jpg","https://s1.ax1x.com/2023/06/05/pCC4DTU.jpg","https://s1.ax1x.com/2023/06/05/pCC40mV.jpg","https://s1.ax1x.com/2023/06/05/pCC4skF.jpg","https://s1.ax1x.com/2023/06/05/pCC4ayq.jpg","https://s1.ax1x.com/2023/06/05/pCCoYfe.jpg","https://s1.ax1x.com/2023/06/05/pCCoJYD.jpg","https://s1.ax1x.com/2023/06/05/pCCogpQ.jpg","https://s1.ax1x.com/2023/06/05/pCCo2lj.jpg","https://s1.ax1x.com/2023/06/05/pCCoR6s.jpg"],"datePublished":"2022-01-12T00:00:00.000Z","dateModified":null,"author":[{"@type":"Person","name":"sixkey","url":"https://swx08.github.io"}]}</script><link rel="icon" href="https://ice.frostsky.com/2024/03/08/b7a77c7e8a4f97f2ec552bf9ee992bb6.png"><title>RabbitMQæ¶ˆæ¯é˜Ÿåˆ— | æ–‡å­¦åšå®¢</title><meta name="description" content="RabbitMQæ¶ˆæ¯é˜Ÿåˆ— 1.1 MQ çš„ç›¸å…³æ¦‚å¿µ 1.1.1. ä»€ä¹ˆæ˜¯ MQï¼Ÿ MQ(message queue)ï¼Œä»å­—é¢æ„æ€ä¸Šçœ‹ï¼Œæœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼ŒFIFO å…ˆå…¥å…ˆå‡ºï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯ message è€Œå·²ï¼Œè¿˜æ˜¯ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯ã€‚åœ¨äº’è”ç½‘æ¶æ„ä¸­ï¼ŒMQ æ˜¯ä¸€ç§éå¸¸å¸¸ è§çš„ä¸Šä¸‹æ¸¸â€œé€»è¾‘è§£è€¦+ç‰©ç†è§£è€¦â€çš„æ¶ˆæ¯é€šä¿¡æœåŠ¡ã€‚ä½¿ç”¨äº† ...">
    <link rel="preload" href="/vuepress/assets/style-CBAlR06r.css" as="style"><link rel="stylesheet" href="/vuepress/assets/style-CBAlR06r.css">
    <link rel="modulepreload" href="/vuepress/assets/app-DCsLG_oX.js"><link rel="modulepreload" href="/vuepress/assets/RabbitMQæ¶ˆæ¯é˜Ÿåˆ—.html-D9Y7wDVw.js"><link rel="modulepreload" href="/vuepress/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/vuepress/assets/index.html-DEBrOV2y.js" as="script"><link rel="prefetch" href="/vuepress/assets/å…³äº.html-C-ShVUpV.js" as="script"><link rel="prefetch" href="/vuepress/assets/HarmonyOS4.0.html-DO51n-KK.js" as="script"><link rel="prefetch" href="/vuepress/assets/é¸¿è’™ HarmonyOS4.0 Httpæ•°æ®è¯·æ±‚å°è£…è¯¦è§£.html-hx8eFIy-.js" as="script"><link rel="prefetch" href="/vuepress/assets/Linux.html-CNKzmFzO.js" as="script"><link rel="prefetch" href="/vuepress/assets/linuxé¡¹ç›®éƒ¨ç½².html-BA7gAybh.js" as="script"><link rel="prefetch" href="/vuepress/assets/Axios.html-icWWglpA.js" as="script"><link rel="prefetch" href="/vuepress/assets/CSSæ ·å¼å­¦ä¹ .html-CShDTi7Q.js" as="script"><link rel="prefetch" href="/vuepress/assets/PiniaåŸºæœ¬ä½¿ç”¨.html-CrXuoRzA.js" as="script"><link rel="prefetch" href="/vuepress/assets/Uniappå¼€å‘.html-Bx1mVT5V.js" as="script"><link rel="prefetch" href="/vuepress/assets/vue.html-BUa0zJqo.js" as="script"><link rel="prefetch" href="/vuepress/assets/Vue3é›†æˆEchartsè¯¦è§£.html-ZF1vzRHv.js" as="script"><link rel="prefetch" href="/vuepress/assets/vueé¡¹ç›®ç»“æ„è¯´æ˜ç¬”è®°.html-D7ES9YV3.js" as="script"><link rel="prefetch" href="/vuepress/assets/nginx.html-DeRD4pog.js" as="script"><link rel="prefetch" href="/vuepress/assets/æ™ºçº¦ä¼šè®®ç®¡ç†ç³»ç»Ÿ.html-6-GFQ1Ro.js" as="script"><link rel="prefetch" href="/vuepress/assets/æ›²å¸ˆå•†åŸ.html-C7KMc7TH.js" as="script"><link rel="prefetch" href="/vuepress/assets/ElastaicSearch.html-Bc7OblTB.js" as="script"><link rel="prefetch" href="/vuepress/assets/git.html-Chu2squT.js" as="script"><link rel="prefetch" href="/vuepress/assets/redis.html-Brm-Ej-T.js" as="script"><link rel="prefetch" href="/vuepress/assets/javaä¸­æ—¥æœŸä¸æ—¶é—´å·¥å…·å°è£….html-B9jSevlc.js" as="script"><link rel="prefetch" href="/vuepress/assets/Mybatis.html-NKkfkaG-.js" as="script"><link rel="prefetch" href="/vuepress/assets/Spring.html-XJRSYj6X.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringSecurityå¿«é€Ÿå…¥é—¨.html-BYC052Y7.js" as="script"><link rel="prefetch" href="/vuepress/assets/SSMæ•´åˆ.html-Ck_khvUS.js" as="script"><link rel="prefetch" href="/vuepress/assets/å¾®ä¿¡å…¬ä¼—å·å…³é”®è¯è‡ªåŠ¨å›å¤.html-BPV7kZnX.js" as="script"><link rel="prefetch" href="/vuepress/assets/EasyExcel.html-NUoPp43Q.js" as="script"><link rel="prefetch" href="/vuepress/assets/Jackson.html-NhrAuAO6.js" as="script"><link rel="prefetch" href="/vuepress/assets/JWTå·¥å…·ç±».html-BJIoO3WG.js" as="script"><link rel="prefetch" href="/vuepress/assets/JWTå¿«é€Ÿå…¥é—¨.html-DF7xgi0L.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBootè‡ªå®šä¹‰Starter.html-DFrv4Zx8.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBootè§£å†³è·¨åŸŸé—®é¢˜.html-BXQ-bOCZ.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBooté›†æˆES.html-C1LCxG4P.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBooté›†æˆJWT.html-BmGelLnq.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBooté›†æˆMinio.html-Dgs2RPKm.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBooté›†æˆRedis.html-BHxhEddc.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBooté›†æˆSwagger2-ui.html-DxaaRCAt.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBooté›†æˆWebSocket.html-2xYiqbJW.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringBooté›†æˆåŠŸèƒ½åˆé›†.html-ChGgM4RK.js" as="script"><link rel="prefetch" href="/vuepress/assets/ThreadLocalä½¿ç”¨.html-vEsvzJmw.js" as="script"><link rel="prefetch" href="/vuepress/assets/åç«¯æ¥æ”¶å‰ç«¯æ•°æ®8ç§æ–¹å¼.html-DaXvABUV.js" as="script"><link rel="prefetch" href="/vuepress/assets/å°ç¨‹åºæœåŠ¡å™¨åŸŸåé…ç½®.html-aW0-3Lnm.js" as="script"><link rel="prefetch" href="/vuepress/assets/æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½å®ç°.html-C1Qy9Tua.js" as="script"><link rel="prefetch" href="/vuepress/assets/ç­–ç•¥æ¨¡å¼å®ç°å¤šç§æ”¯ä»˜.html-B7SaBilb.js" as="script"><link rel="prefetch" href="/vuepress/assets/ç­–ç•¥æ¨¡å¼å®ç°æ–‡ä»¶ä¸Šä¼ .html-CRlSp5pV.js" as="script"><link rel="prefetch" href="/vuepress/assets/Dubboå­¦ä¹ æ–‡æ¡£.html-Do7Nla_Z.js" as="script"><link rel="prefetch" href="/vuepress/assets/SpringCloudå­¦ä¹ æ–‡æ¡£.html-Cw8Qot4U.js" as="script"><link rel="prefetch" href="/vuepress/assets/å¾®æœåŠ¡å®æˆ˜.html-BK1WeNCp.js" as="script"><link rel="prefetch" href="/vuepress/assets/23ç§è®¾è®¡æ¨¡å¼.html-BcOn0MUr.js" as="script"><link rel="prefetch" href="/vuepress/assets/404.html-B_dWUVIg.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-yLVbmqMp.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CcDK1Ec8.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BnpS-jpq.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CGfCgpZC.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DUvzGeEZ.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-gejGukXt.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DSRHK4DG.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BVhX8wF3.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DgIJsRip.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-Bb0Nc1xj.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CV1i66Fe.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DlZbXpcS.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-C_tZ9cLZ.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-COG3uxWq.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DQTo4GHo.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BD8uWXGy.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CrT-qS91.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BLV0-k-N.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-B4TVtn5N.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-0kWfj1k2.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-44EWLleu.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-0P9hlCWh.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DBn9hdnX.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-B95EohmE.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-C9cnLvMC.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-Bq4BxwMA.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-z1FdoOVL.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-ftvOvAyQ.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-ohzKMY-q.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-_0q54lcB.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DXpUpAA8.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BWJl7dpW.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-TD04Z89Q.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BudzjuTM.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-M0U0zy8G.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DGT3-3z0.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DGR6rJIp.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-k4EtxdOw.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-X3DLkbz6.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-C553O-Il.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BfQVLAwi.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DA54PAvA.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CuahllQK.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-x2Zs4poh.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-bvol1HlH.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DG-g5E3z.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BBN_0_UK.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-C0ys_qKZ.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BXvsxJoZ.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CFwsRk0z.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CTy07rXF.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DpV04Uja.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CKul5orG.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-ClJuGREE.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-QboxWV1v.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-C2gCDZ_Z.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BVeaV0gT.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DHWZT1W8.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-Fq9RtBlA.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CxtJGhFq.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CsktppB-.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CW_dVb_0.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BBN_0_UK.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DmcGm7no.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-9utkDQmq.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-8dgC-F9d.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DLmbJEua.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-Bqba-M9O.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-C3B0BaCb.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-4gjSdVa8.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-sJNVG2XF.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-DxkVLTis.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-BN-o957o.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CxrQxH4V.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CChWGf4W.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-Cr11QkXt.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-CPq408YQ.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-jX5vewY7.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-D731Dil8.js" as="script"><link rel="prefetch" href="/vuepress/assets/index.html-B4tNDnDn.js" as="script"><link rel="prefetch" href="/vuepress/assets/index-uOBkQLRT.js" as="script"><link rel="prefetch" href="/vuepress/assets/vue-repl-BWcdYVWt.js" as="script"><link rel="prefetch" href="/vuepress/assets/codemirror-editor-Cu4g1W4e.js" as="script"><link rel="prefetch" href="/vuepress/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/vuepress/"><img class="vp-nav-logo" src="https://ice.frostsky.com/2024/03/08/489cfd2f11f7cf3e05ed10800e0dcb06.jpeg" alt><!----><span class="vp-site-name hide-in-pad">æ–‡å­¦åšå®¢</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/vuepress/" aria-label="ä¸»é¡µ"><span class="font-icon icon iconfont icon-home" style=""></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link active" href="/vuepress/posts/" aria-label="æŠ€æœ¯ä¸“æ "><span class="font-icon icon iconfont icon-java" style=""></span>æŠ€æœ¯ä¸“æ <!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/vuepress/about/" aria-label="å…³äº"><span class="font-icon icon iconfont icon-people" style=""></span>å…³äº<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/swx08" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-java" style=""></span><span class="vp-sidebar-title">åç«¯</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-html" style=""></span><span class="vp-sidebar-title">å‰ç«¯</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-article" style=""></span><span class="vp-sidebar-title">é¡¹ç›®æ–‡æ¡£</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-nginx" style=""></span><span class="vp-sidebar-title">è¿ç»´</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon iconfont icon-hot" style=""></span><span class="vp-sidebar-title">ä¸­é—´ä»¶</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Git</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">MQ</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/vuepress/posts/%E4%B8%AD%E9%97%B4%E4%BB%B6/MQ/RabbitMQ%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97.html" aria-label="RabbitMQæ¶ˆæ¯é˜Ÿåˆ—"><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>RabbitMQæ¶ˆæ¯é˜Ÿåˆ—<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-launch" style=""></span><span class="vp-sidebar-title">HarmonyOS</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon iconfont icon-linux" style=""></span><span class="vp-sidebar-title">Linux</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon iconfont icon-pen-to-square" style=""></span>RabbitMQæ¶ˆæ¯é˜Ÿåˆ—</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://swx08.github.io" target="_blank" rel="noopener noreferrer">sixkey</a></span><span property="author" content="sixkey"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-01-12T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 80 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT80M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category5 clickable" role="navigation">ä¸­é—´ä»¶</span><span class="page-category-item category8 clickable" role="navigation">æ¶ˆæ¯é˜Ÿåˆ—</span><!--]--><meta property="articleSection" content="ä¸­é—´ä»¶,æ¶ˆæ¯é˜Ÿåˆ—"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag0 clickable" role="navigation">RabbitMQ</span><!--]--><meta property="keywords" content="RabbitMQ"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!--[--><!----><!--]--><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_1-1-mq-çš„ç›¸å…³æ¦‚å¿µ">1.1 MQ çš„ç›¸å…³æ¦‚å¿µ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-1-1-ä»€ä¹ˆæ˜¯-mq">1.1.1. ä»€ä¹ˆæ˜¯ MQï¼Ÿ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-1-2-ä¸ºä»€ä¹ˆè¦ç”¨-mq">1.1.2. ä¸ºä»€ä¹ˆè¦ç”¨ MQ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-1-3-mq-çš„é€‰æ‹©">1.1.3. MQ çš„é€‰æ‹©</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_1-2-rabbitmq-ä»‹ç»">1.2. RabbitMQï¼ˆä»‹ç»ï¼‰</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-2-1-rabbitmq-çš„æ¦‚å¿µ">1.2.1. RabbitMQ çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-2-2-å››å¤§æ ¸å¿ƒæ¦‚å¿µ">1.2.2. å››å¤§æ ¸å¿ƒæ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-2-3-rabbitmq-æ ¸å¿ƒéƒ¨åˆ†">1.2.3. RabbitMQ æ ¸å¿ƒéƒ¨åˆ†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-2-4-å„ä¸ªåè¯ä»‹ç»">1.2.4. å„ä¸ªåè¯ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_1-2-5-å®‰è£…">1.2.5. å®‰è£…</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_2ã€hello-world-å…¥é—¨">2ã€Hello Worldï¼ˆå…¥é—¨ï¼‰</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_2-1-ä¾èµ–">2.1. ä¾èµ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_2-2-æ¶ˆæ¯ç”Ÿäº§è€…">2.2. æ¶ˆæ¯ç”Ÿäº§è€…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_2-3-æ¶ˆæ¯æ¶ˆè´¹è€…">2.3. æ¶ˆæ¯æ¶ˆè´¹è€…</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_3ã€work-queues-å·¥ä½œé˜Ÿåˆ—">3ã€Work Queuesï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_3-1-è½®è¯¢åˆ†å‘æ¶ˆæ¯">3.1. è½®è¯¢åˆ†å‘æ¶ˆæ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-1-1-æŠ½å–å·¥å…·ç±»">3.1.1. æŠ½å–å·¥å…·ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-1-2-å¯åŠ¨ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹">3.1.2. å¯åŠ¨ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-1-3-å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹">3.1.3. å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_3-2-æ¶ˆæ¯åº”ç­”">3.2. æ¶ˆæ¯åº”ç­”</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-2-1-æ¦‚å¿µ">3.2.1. æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-2-2-è‡ªåŠ¨åº”ç­”">3.2.2. è‡ªåŠ¨åº”ç­”</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-2-3-æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•">**3.2.3. æ¶ˆæ¯åº”ç­”çš„æ–¹æ³• **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-2-4-multiple-çš„è§£é‡Š">3.2.4. Multiple çš„è§£é‡Š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-2-5-æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ">**3.2.5. æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-2-6-æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç ">**3.2.6. æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç  **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-2-7-æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º">3.2.7. æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_3-3-rabbitmq-æŒä¹…åŒ–">3.3. RabbitMQ æŒä¹…åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-3-1-æ¦‚å¿µ">**3.3.1. æ¦‚å¿µ  **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-3-2-é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–">**3.3.2. é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–  **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-3-3-æ¶ˆæ¯å®ç°æŒä¹…åŒ–">3.3.3. æ¶ˆæ¯å®ç°æŒä¹…åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-3-4-ä¸å…¬å¹³åˆ†å‘">**3.3.4. ä¸å…¬å¹³åˆ†å‘ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_3-3-5-é¢„å–å€¼">3.3.5. é¢„å–å€¼</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_4ã€å‘å¸ƒç¡®è®¤">4ã€å‘å¸ƒç¡®è®¤</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_4-1-å‘å¸ƒç¡®è®¤åŸç†">4.1. å‘å¸ƒç¡®è®¤åŸç†</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_4-2-å‘å¸ƒç¡®è®¤çš„ç­–ç•¥">4.2. å‘å¸ƒç¡®è®¤çš„ç­–ç•¥</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_4-2-1-å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•">4.2.1. å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_4-2-2-å•ä¸ªç¡®è®¤å‘å¸ƒ-è€—æ—¶100296ms">4.2.2. å•ä¸ªç¡®è®¤å‘å¸ƒï¼ˆè€—æ—¶100296msï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_4-2-3-æ‰¹é‡ç¡®è®¤å‘å¸ƒ-285ms">4.2.3. æ‰¹é‡ç¡®è®¤å‘å¸ƒï¼ˆ285msï¼‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_4-2-4-å¼‚æ­¥ç¡®è®¤å‘å¸ƒ">4.2.4. å¼‚æ­¥ç¡®è®¤å‘å¸ƒ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_4-2-5-å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯">4.2.5. å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_4-2-6-ä»¥ä¸Š-3-ç§å‘å¸ƒç¡®è®¤é€Ÿåº¦å¯¹æ¯”">4.2.6. ä»¥ä¸Š 3 ç§å‘å¸ƒç¡®è®¤é€Ÿåº¦å¯¹æ¯”</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_5ã€äº¤æ¢æœº">5ã€äº¤æ¢æœº</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_5-1-exchanges">5.1. Exchanges</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-1-1-exchanges-æ¦‚å¿µ">5.1.1. Exchanges æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-1-2-exchanges-çš„ç±»å‹">5.1.2. Exchanges çš„ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-1-3-æ— å-exchange">5.1.3. æ— å exchange</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_5-2-ä¸´æ—¶é˜Ÿåˆ—">5.2. ä¸´æ—¶é˜Ÿåˆ—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_5-3-ç»‘å®š-bindings">5.3. ç»‘å®š(bindings)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_5-4-fanoutäº¤æ¢æœº">5.4. Fanoutäº¤æ¢æœº</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-4-1-fanout-ä»‹ç»">5.4.1. Fanout ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-4-2-fanout-å®æˆ˜">5.4.2. Fanout å®æˆ˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_5-5-direct-äº¤æ¢æœº">5.5. Direct äº¤æ¢æœº</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-5-1-å›é¡¾">5.5.1. å›é¡¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-5-2-direct-exchange-ä»‹ç»">5.5.2. Direct exchange ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-5-3-å¤šé‡ç»‘å®š">5.5.3. å¤šé‡ç»‘å®š</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-5-4-å®æˆ˜">5.5.4. å®æˆ˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_5-6-topics">5.6. Topics</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-6-1-ä¹‹å‰ç±»å‹çš„é—®é¢˜">5.6.1. ä¹‹å‰ç±»å‹çš„é—®é¢˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-6-2-topic-çš„è¦æ±‚">5.6.2. Topic çš„è¦æ±‚</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-6-3-topic-åŒ¹é…æ¡ˆä¾‹">5.6.3. Topic åŒ¹é…æ¡ˆä¾‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_5-6-4-å®æˆ˜">5.6.4. å®æˆ˜</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_6ã€æ­»ä¿¡é˜Ÿåˆ—">6ã€æ­»ä¿¡é˜Ÿåˆ—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_6-1-æ­»ä¿¡çš„æ¦‚å¿µ">6.1. æ­»ä¿¡çš„æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_6-2-æ­»ä¿¡çš„æ¥æº">6.2. æ­»ä¿¡çš„æ¥æº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_6-3-æ­»ä¿¡å®æˆ˜">6.3. æ­»ä¿¡å®æˆ˜</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_6-3-1-ä»£ç æ¶æ„å›¾">6.3.1. ä»£ç æ¶æ„å›¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_6-3-2-æ¶ˆæ¯-ttl-è¿‡æœŸ">**6.3.2. æ¶ˆæ¯ TTL è¿‡æœŸ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_6-3-3-é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦">6.3.3. é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_6-3-4-æ¶ˆæ¯è¢«æ‹’">6.3.4. æ¶ˆæ¯è¢«æ‹’</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_7ã€å»¶è¿Ÿé˜Ÿåˆ—">7ã€å»¶è¿Ÿé˜Ÿåˆ—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-1-å»¶è¿Ÿé˜Ÿåˆ—æ¦‚å¿µ">7.1. å»¶è¿Ÿé˜Ÿåˆ—æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-2-å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯">7.2. å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-3-rabbitmq-ä¸­çš„-ttl">7.3. RabbitMQ ä¸­çš„ TTL</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-3-1-æ¶ˆæ¯è®¾ç½®-ttl">**7.3.1. æ¶ˆæ¯è®¾ç½® TTL **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-3-2-é˜Ÿåˆ—è®¾ç½®-ttl">**7.3.2. é˜Ÿåˆ—è®¾ç½® TTL **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-3-3-ä¸¤è€…çš„åŒºåˆ«">7.3.3. ä¸¤è€…çš„åŒºåˆ«</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-4-æ•´åˆ-springboot">7.4. æ•´åˆ springboot</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-5-é˜Ÿåˆ—-ttl">7.5. é˜Ÿåˆ— TTL</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-5-1-ä»£ç æ¶æ„å›¾">7.5.1. ä»£ç æ¶æ„å›¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-5-2-é…ç½®æ–‡ä»¶ç±»ä»£ç ">**7.5.2. é…ç½®æ–‡ä»¶ç±»ä»£ç  **</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-6-å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–">7.6. å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-6-1-ä»£ç æ¶æ„å›¾">7.6.1. ä»£ç æ¶æ„å›¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-6-2-é…ç½®æ–‡ä»¶ç±»ä»£ç ">**7.6.2. é…ç½®æ–‡ä»¶ç±»ä»£ç  **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-6-3-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç ">7.6.3. æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-7-rabbitmq-æ’ä»¶å¼¥è¡¥å»¶è¿Ÿé˜Ÿåˆ—éœ€è¦æ’é˜Ÿç¼ºç‚¹">7.7. Rabbitmq æ’ä»¶å¼¥è¡¥å»¶è¿Ÿé˜Ÿåˆ—éœ€è¦æ’é˜Ÿç¼ºç‚¹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-7-1-å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶">7.7.1. å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-7-2-ä»£ç æ¶æ„å›¾">7.7.2. ä»£ç æ¶æ„å›¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-7-3-é…ç½®æ–‡ä»¶ç±»ä»£ç ">7.7.3. é…ç½®æ–‡ä»¶ç±»ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-7-4-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç ">7.7.4. æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_7-7-5-æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç ">7.7.5. æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç </a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_7-8-æ€»ç»“">7.8. æ€»ç»“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_8ã€å‘å¸ƒç¡®è®¤é«˜çº§">8ã€å‘å¸ƒç¡®è®¤é«˜çº§</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_8-1-å‘å¸ƒç¡®è®¤-springboot-ç‰ˆæœ¬">8.1. å‘å¸ƒç¡®è®¤ springboot ç‰ˆæœ¬</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-1-ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ">8.1.1. ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-2-ä»£ç æ¶æ„å›¾">**8.1.2. ä»£ç æ¶æ„å›¾ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-3-é…ç½®æ–‡ä»¶">8.1.3. é…ç½®æ–‡ä»¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-4-æ·»åŠ é…ç½®ç±»">8.1.4. æ·»åŠ é…ç½®ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-5-æ¶ˆæ¯ç”Ÿäº§è€…">8.1.5. æ¶ˆæ¯ç”Ÿäº§è€…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-6-å›è°ƒæ¥å£">8.1.6. å›è°ƒæ¥å£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-7-æ¶ˆæ¯æ¶ˆè´¹è€…">8.1.7. æ¶ˆæ¯æ¶ˆè´¹è€…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-1-8-ç»“æœåˆ†æ">8.1.8. ç»“æœåˆ†æ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_8-2-å›é€€æ¶ˆæ¯">8.2. å›é€€æ¶ˆæ¯</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-2-1-mandatory-å‚æ•°">8.2.1. Mandatory å‚æ•°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-2-2-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç ">8.2.2. æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-2-3-å›è°ƒæ¥å£">**8.2.3. å›è°ƒæ¥å£ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-2-4-ç»“æœåˆ†æ">8.2.4. ç»“æœåˆ†æ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_8-3-å¤‡ä»½äº¤æ¢æœº">8.3. å¤‡ä»½äº¤æ¢æœº</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-3-1-ä»£ç æ¶æ„å›¾">8.3.1. ä»£ç æ¶æ„å›¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-3-2-ä¿®æ”¹é…ç½®ç±»">8.3.2. ä¿®æ”¹é…ç½®ç±»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-3-3-æŠ¥è­¦æ¶ˆè´¹è€…">8.3.3. æŠ¥è­¦æ¶ˆè´¹è€…</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-3-4-æµ‹è¯•æ³¨æ„äº‹é¡¹">8.3.4. æµ‹è¯•æ³¨æ„äº‹é¡¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_8-3-5-ç»“æœåˆ†æ">8.3.5. ç»“æœåˆ†æ</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_9ã€-rabbitmq-å…¶ä»–çŸ¥è¯†ç‚¹">9ã€ RabbitMQ å…¶ä»–çŸ¥è¯†ç‚¹</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_9-1-å¹‚ç­‰æ€§">9.1. å¹‚ç­‰æ€§</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-1-1-æ¦‚å¿µ">9.1.1. æ¦‚å¿µ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-1-2-æ¶ˆæ¯é‡å¤æ¶ˆè´¹">9.1.2. æ¶ˆæ¯é‡å¤æ¶ˆè´¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-1-3-è§£å†³æ€è·¯">9.1.3. è§£å†³æ€è·¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-1-4-æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ">9.1.4. æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-1-5-å”¯ä¸€-id-æŒ‡çº¹ç æœºåˆ¶">9.1.5. å”¯ä¸€ ID+æŒ‡çº¹ç æœºåˆ¶</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-1-6-redis-åŸå­æ€§">9.1.6. Redis åŸå­æ€§</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_9-2-ä¼˜å…ˆçº§é˜Ÿåˆ—">9.2. ä¼˜å…ˆçº§é˜Ÿåˆ—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-2-1-ä½¿ç”¨åœºæ™¯">9.2.1. ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-2-2-å¦‚ä½•æ·»åŠ ">9.2.2. å¦‚ä½•æ·»åŠ </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-2-3-å®æˆ˜">9.2.3. å®æˆ˜</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_9-3-æƒ°æ€§é˜Ÿåˆ—">9.3. æƒ°æ€§é˜Ÿåˆ—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-3-1-ä½¿ç”¨åœºæ™¯">9.3.1. ä½¿ç”¨åœºæ™¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-3-2-ä¸¤ç§æ¨¡å¼">**9.3.2. ä¸¤ç§æ¨¡å¼ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_9-3-3-å†…å­˜å¼€é”€å¯¹æ¯”">9.3.3. å†…å­˜å¼€é”€å¯¹æ¯”</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="/vuepress/#_10ã€rabbitmq-é›†ç¾¤">10ã€RabbitMQ é›†ç¾¤</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_10-1-clustering">10.1. clustering</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-1-1-ä½¿ç”¨é›†ç¾¤çš„åŸå› ">10.1.1. ä½¿ç”¨é›†ç¾¤çš„åŸå› </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-1-2-æ­å»ºæ­¥éª¤">10.1.2. æ­å»ºæ­¥éª¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_10-2-é•œåƒé˜Ÿåˆ—">10.2. é•œåƒé˜Ÿåˆ—</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-2-1-ä½¿ç”¨é•œåƒçš„åŸå› ">10.2.1. ä½¿ç”¨é•œåƒçš„åŸå› </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-2-2-æ­å»ºæ­¥éª¤">10.2.2. æ­å»ºæ­¥éª¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_10-3-haproxy-keepalive-å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡">10.3. Haproxy+Keepalive å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-3-1-æ•´ä½“æ¶æ„å›¾">10.3.1. æ•´ä½“æ¶æ„å›¾</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-3-2-haproxy-å®ç°è´Ÿè½½å‡è¡¡">**10.3.2. Haproxy å®ç°è´Ÿè½½å‡è¡¡ **</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-3-3-æ­å»ºæ­¥éª¤">10.3.3. æ­å»ºæ­¥éª¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-3-4-keepalived-å®ç°åŒæœº-ä¸»å¤‡-çƒ­å¤‡">10.3.4. Keepalived å®ç°åŒæœº(ä¸»å¤‡)çƒ­å¤‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-3-5-æ­å»ºæ­¥éª¤">10.3.5. æ­å»ºæ­¥éª¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_10-4-federation-exchange">10.4. Federation Exchange</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-4-1-ä½¿ç”¨å®ƒçš„åŸå› ">10.4.1. ä½¿ç”¨å®ƒçš„åŸå› </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-4-2-æ­å»ºæ­¥éª¤">10.4.2. æ­å»ºæ­¥éª¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_10-5-federation-queue">10.5. Federation Queue</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-5-1-ä½¿ç”¨å®ƒçš„åŸå› ">10.5.1. ä½¿ç”¨å®ƒçš„åŸå› </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-5-2-æ­å»ºæ­¥éª¤">10.5.2. æ­å»ºæ­¥éª¤</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="/vuepress/#_10-6-shovel">10.6. Shovel</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-6-1-ä½¿ç”¨å®ƒçš„åŸå› ">10.6.1. ä½¿ç”¨å®ƒçš„åŸå› </a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="/vuepress/#_10-6-2-æ­å»ºæ­¥éª¤">10.6.2. æ­å»ºæ­¥éª¤</a></li><!----><!--]--></ul></li><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="rabbitmqæ¶ˆæ¯é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#rabbitmqæ¶ˆæ¯é˜Ÿåˆ—"><span>RabbitMQæ¶ˆæ¯é˜Ÿåˆ—</span></a></h1><h3 id="_1-1-mq-çš„ç›¸å…³æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-1-mq-çš„ç›¸å…³æ¦‚å¿µ"><span>1.1 MQ çš„ç›¸å…³æ¦‚å¿µ</span></a></h3><h4 id="_1-1-1-ä»€ä¹ˆæ˜¯-mq" tabindex="-1"><a class="header-anchor" href="#_1-1-1-ä»€ä¹ˆæ˜¯-mq"><span>1.1.1. ä»€ä¹ˆæ˜¯ MQï¼Ÿ</span></a></h4><p>MQ(message queue)ï¼Œä»å­—é¢æ„æ€ä¸Šçœ‹ï¼Œæœ¬è´¨æ˜¯ä¸ªé˜Ÿåˆ—ï¼ŒFIFO å…ˆå…¥å…ˆå‡ºï¼Œåªä¸è¿‡é˜Ÿåˆ—ä¸­å­˜æ”¾çš„å†…å®¹æ˜¯ message è€Œå·²ï¼Œè¿˜æ˜¯ä¸€ç§è·¨è¿›ç¨‹çš„é€šä¿¡æœºåˆ¶ï¼Œç”¨äºä¸Šä¸‹æ¸¸ä¼ é€’æ¶ˆæ¯ã€‚åœ¨äº’è”ç½‘æ¶æ„ä¸­ï¼ŒMQ æ˜¯ä¸€ç§éå¸¸å¸¸ è§çš„ä¸Šä¸‹æ¸¸â€œé€»è¾‘è§£è€¦+ç‰©ç†è§£è€¦â€çš„æ¶ˆæ¯é€šä¿¡æœåŠ¡ã€‚ä½¿ç”¨äº† MQ ä¹‹åï¼Œæ¶ˆæ¯å‘é€ä¸Šæ¸¸åªéœ€è¦ä¾èµ– MQï¼Œä¸ ç”¨ä¾èµ–å…¶ä»–æœåŠ¡ã€‚</p><h4 id="_1-1-2-ä¸ºä»€ä¹ˆè¦ç”¨-mq" tabindex="-1"><a class="header-anchor" href="#_1-1-2-ä¸ºä»€ä¹ˆè¦ç”¨-mq"><span>1.1.2. ä¸ºä»€ä¹ˆè¦ç”¨ MQ</span></a></h4><p>**1.æµé‡æ¶ˆå³° **</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè®¢å•ç³»ç»Ÿæœ€å¤šèƒ½å¤„ç†ä¸€ä¸‡æ¬¡è®¢å•ï¼Œè¿™ä¸ªå¤„ç†èƒ½åŠ›åº”ä»˜æ­£å¸¸æ—¶æ®µçš„ä¸‹å•æ—¶ç»°ç»°æœ‰ä½™ï¼Œæ­£ å¸¸æ—¶æ®µæˆ‘ä»¬ä¸‹å•ä¸€ç§’åå°±èƒ½è¿”å›ç»“æœã€‚ä½†æ˜¯åœ¨é«˜å³°æœŸï¼Œå¦‚æœæœ‰ä¸¤ä¸‡æ¬¡ä¸‹å•æ“ä½œç³»ç»Ÿæ˜¯å¤„ç†ä¸äº†çš„ï¼Œåªèƒ½é™ åˆ¶è®¢å•è¶…è¿‡ä¸€ä¸‡åä¸å…è®¸ç”¨æˆ·ä¸‹å•ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšç¼“å†²ï¼Œæˆ‘ä»¬å¯ä»¥å–æ¶ˆè¿™ä¸ªé™åˆ¶ï¼ŒæŠŠä¸€ç§’å†…ä¸‹çš„è®¢å•åˆ† æ•£æˆä¸€æ®µæ—¶é—´æ¥å¤„ç†ï¼Œè¿™æ—¶æœ‰äº›ç”¨æˆ·å¯èƒ½åœ¨ä¸‹å•åå‡ ç§’åæ‰èƒ½æ”¶åˆ°ä¸‹å•æˆåŠŸçš„æ“ä½œï¼Œä½†æ˜¯æ¯”ä¸èƒ½ä¸‹å•çš„ä½“ éªŒè¦å¥½ã€‚</p><p>**2.åº”ç”¨è§£è€¦ **</p><p>ä»¥ç”µå•†åº”ç”¨ä¸ºä¾‹ï¼Œåº”ç”¨ä¸­æœ‰è®¢å•ç³»ç»Ÿã€åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿã€‚ç”¨æˆ·åˆ›å»ºè®¢å•åï¼Œå¦‚æœè€¦åˆ è°ƒç”¨åº“å­˜ç³»ç»Ÿã€ç‰©æµç³»ç»Ÿã€æ”¯ä»˜ç³»ç»Ÿï¼Œä»»ä½•ä¸€ä¸ªå­ç³»ç»Ÿå‡ºäº†æ•…éšœï¼Œéƒ½ä¼šé€ æˆä¸‹å•æ“ä½œå¼‚å¸¸ã€‚å½“è½¬å˜æˆåŸºäº æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼åï¼Œç³»ç»Ÿé—´è°ƒç”¨çš„é—®é¢˜ä¼šå‡å°‘å¾ˆå¤šï¼Œæ¯”å¦‚ç‰©æµç³»ç»Ÿå› ä¸ºå‘ç”Ÿæ•…éšœï¼Œéœ€è¦å‡ åˆ†é’Ÿæ¥ä¿®å¤ã€‚åœ¨ è¿™å‡ åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œç‰©æµç³»ç»Ÿè¦å¤„ç†çš„å†…å­˜è¢«ç¼“å­˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·çš„ä¸‹å•æ“ä½œå¯ä»¥æ­£å¸¸å®Œæˆã€‚å½“ç‰©æµ ç³»ç»Ÿæ¢å¤åï¼Œç»§ç»­å¤„ç†è®¢å•ä¿¡æ¯å³å¯ï¼Œä¸­å•ç”¨æˆ·æ„Ÿå—ä¸åˆ°ç‰©æµç³»ç»Ÿçš„æ•…éšœï¼Œæå‡ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</p><figure><a href="https://imgse.com/i/pCSt7qS" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSt7qS.jpg" alt="pCSt7qS.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSt7qS.jpg</figcaption></figure><p>**3.å¼‚æ­¥å¤„ç† **</p><p>æœ‰äº›æœåŠ¡é—´è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¾‹å¦‚ A è°ƒç”¨ Bï¼ŒB éœ€è¦èŠ±è´¹å¾ˆé•¿æ—¶é—´æ‰§è¡Œï¼Œä½†æ˜¯ A éœ€è¦çŸ¥é“ B ä»€ä¹ˆæ—¶å€™å¯ ä»¥æ‰§è¡Œå®Œï¼Œä»¥å‰ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼ŒA è¿‡ä¸€æ®µæ—¶é—´å»è°ƒç”¨ B çš„æŸ¥è¯¢ api æŸ¥è¯¢ã€‚æˆ–è€… A æä¾›ä¸€ä¸ª callback apiï¼Œ B æ‰§è¡Œå®Œä¹‹åè°ƒç”¨ api é€šçŸ¥ A æœåŠ¡ã€‚è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œä½¿ç”¨æ¶ˆæ¯æ€»çº¿ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ A è°ƒç”¨ B æœåŠ¡åï¼Œåªéœ€è¦ç›‘å¬ B å¤„ç†å®Œæˆçš„æ¶ˆæ¯ï¼Œå½“ B å¤„ç†å®Œæˆåï¼Œä¼šå‘é€ä¸€æ¡æ¶ˆæ¯ç»™ MQï¼ŒMQ ä¼šå°†æ­¤ æ¶ˆæ¯è½¬å‘ç»™ A æœåŠ¡ã€‚è¿™æ · A æœåŠ¡æ—¢ä¸ç”¨å¾ªç¯è°ƒç”¨ B çš„æŸ¥è¯¢ apiï¼Œä¹Ÿä¸ç”¨æä¾› callback apiã€‚åŒæ · B æœåŠ¡ä¹Ÿä¸ ç”¨åšè¿™äº›æ“ä½œã€‚A æœåŠ¡è¿˜èƒ½åŠæ—¶çš„å¾—åˆ°å¼‚æ­¥å¤„ç†æˆåŠŸçš„æ¶ˆæ¯ã€‚</p><figure><a href="https://imgse.com/i/pCStTr8" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCStTr8.jpg" alt="pCStTr8.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCStTr8.jpg</figcaption></figure><h4 id="_1-1-3-mq-çš„é€‰æ‹©" tabindex="-1"><a class="header-anchor" href="#_1-1-3-mq-çš„é€‰æ‹©"><span>1.1.3. MQ çš„é€‰æ‹©</span></a></h4><p>**1.Kafka **</p><p>Kafka ä¸»è¦ç‰¹ç‚¹æ˜¯åŸºäº Pull çš„æ¨¡å¼æ¥å¤„ç†æ¶ˆæ¯æ¶ˆè´¹ï¼Œè¿½æ±‚é«˜ååé‡ï¼Œä¸€å¼€å§‹çš„ç›®çš„å°±æ˜¯ç”¨äºæ—¥å¿—æ”¶é›† å’Œä¼ è¾“ï¼Œé€‚åˆäº§ç”Ÿå¤§é‡æ•°æ®çš„äº’è”ç½‘æœåŠ¡çš„æ•°æ®æ”¶é›†ä¸šåŠ¡ã€‚å¤§å‹å…¬å¸å»ºè®®å¯ä»¥é€‰ç”¨ï¼Œå¦‚æœæœ‰æ—¥å¿—é‡‡é›†åŠŸèƒ½ï¼Œ è‚¯å®šæ˜¯é¦–é€‰ kafka äº†ã€‚å°šç¡…è°·å®˜ç½‘ kafka è§†é¢‘è¿æ¥ http://www.gulixueyuan.com/course/330/tasks</p><p>**2.RocketMQ **</p><p>å¤©ç”Ÿä¸ºé‡‘èäº’è”ç½‘é¢†åŸŸè€Œç”Ÿï¼Œå¯¹äºå¯é æ€§è¦æ±‚å¾ˆé«˜çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯ç”µå•†é‡Œé¢çš„è®¢å•æ‰£æ¬¾ï¼Œä»¥åŠä¸šåŠ¡å‰Š å³°ï¼Œåœ¨å¤§é‡äº¤æ˜“æ¶Œå…¥æ—¶ï¼Œåç«¯å¯èƒ½æ— æ³•åŠæ—¶å¤„ç†çš„æƒ…å†µã€‚RoketMQ åœ¨ç¨³å®šæ€§ä¸Šå¯èƒ½æ›´å€¼å¾—ä¿¡èµ–ï¼Œè¿™äº›ä¸šåŠ¡ åœºæ™¯åœ¨é˜¿é‡ŒåŒ 11 å·²ç»ç»å†äº†å¤šæ¬¡è€ƒéªŒï¼Œå¦‚æœä½ çš„ä¸šåŠ¡æœ‰ä¸Šè¿°å¹¶å‘åœºæ™¯ï¼Œå»ºè®®å¯ä»¥é€‰æ‹© RocketMQã€‚</p><p>**3.RabbitMQ **</p><p>ç»“åˆ erlang è¯­è¨€æœ¬èº«çš„å¹¶å‘ä¼˜åŠ¿ï¼Œæ€§èƒ½å¥½æ—¶æ•ˆæ€§å¾®ç§’çº§ï¼Œç¤¾åŒºæ´»è·ƒåº¦ä¹Ÿæ¯”è¾ƒé«˜ï¼Œç®¡ç†ç•Œé¢ç”¨èµ·æ¥ååˆ† æ–¹ä¾¿ï¼Œå¦‚æœä½ çš„æ•°æ®é‡æ²¡æœ‰é‚£ä¹ˆå¤§ï¼Œä¸­å°å‹å…¬å¸ä¼˜å…ˆé€‰æ‹©åŠŸèƒ½æ¯”è¾ƒå®Œå¤‡çš„ RabbitMQã€‚</p><h3 id="_1-2-rabbitmq-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-2-rabbitmq-ä»‹ç»"><span>1.2. RabbitMQï¼ˆä»‹ç»ï¼‰</span></a></h3><h4 id="_1-2-1-rabbitmq-çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-2-1-rabbitmq-çš„æ¦‚å¿µ"><span>1.2.1. RabbitMQ çš„æ¦‚å¿µ</span></a></h4><p><strong>RabbitMQ æ˜¯ä¸€ä¸ªæ¶ˆæ¯ä¸­é—´ä»¶ï¼š</strong></p><p>å®ƒæ¥å—å¹¶è½¬å‘æ¶ˆæ¯ã€‚ä½ å¯ä»¥æŠŠå®ƒå½“åšä¸€ä¸ªå¿«é€’ç«™ç‚¹ï¼Œå½“ä½ è¦å‘é€ä¸€ä¸ªåŒ… è£¹æ—¶ï¼Œä½ æŠŠä½ çš„åŒ…è£¹æ”¾åˆ°å¿«é€’ç«™ï¼Œå¿«é€’å‘˜æœ€ç»ˆä¼šæŠŠä½ çš„å¿«é€’é€åˆ°æ”¶ä»¶äººé‚£é‡Œï¼ŒæŒ‰ç…§è¿™ç§é€»è¾‘ RabbitMQ æ˜¯ ä¸€ä¸ªå¿«é€’ç«™ï¼Œä¸€ä¸ªå¿«é€’å‘˜å¸®ä½ ä¼ é€’å¿«ä»¶ã€‚RabbitMQ ä¸å¿«é€’ç«™çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä¸å¤„ç†å¿«ä»¶è€Œæ˜¯æ¥æ”¶ï¼Œ å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯æ•°æ®ã€‚</p><h4 id="_1-2-2-å››å¤§æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-2-2-å››å¤§æ ¸å¿ƒæ¦‚å¿µ"><span>1.2.2. å››å¤§æ ¸å¿ƒæ¦‚å¿µ</span></a></h4><blockquote><p><strong>ç”Ÿäº§è€…</strong></p></blockquote><p>äº§ç”Ÿæ•°æ®å‘é€æ¶ˆæ¯çš„ç¨‹åºæ˜¯ç”Ÿäº§è€…</p><blockquote><p>**äº¤æ¢æœº **</p></blockquote><p>äº¤æ¢æœºæ˜¯ RabbitMQ éå¸¸é‡è¦çš„ä¸€ä¸ªéƒ¨ä»¶ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å®ƒå°†æ¶ˆæ¯ æ¨é€åˆ°é˜Ÿåˆ—ä¸­ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†å®ƒæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œæ˜¯å°†è¿™äº›æ¶ˆæ¯æ¨é€åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯æ¨ é€åˆ°å¤šä¸ªé˜Ÿåˆ—ï¼Œäº¦æˆ–è€…æ˜¯æŠŠæ¶ˆæ¯ä¸¢å¼ƒï¼Œè¿™ä¸ªå¾—æœ‰äº¤æ¢æœºç±»å‹å†³å®š</p><blockquote><p><strong>é˜Ÿåˆ—</strong></p></blockquote><p>é˜Ÿåˆ—æ˜¯ RabbitMQ å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ•°æ®ç»“æ„ï¼Œå°½ç®¡æ¶ˆæ¯æµç» RabbitMQ å’Œåº”ç”¨ç¨‹åºï¼Œä½†å®ƒä»¬åªèƒ½å­˜ å‚¨åœ¨é˜Ÿåˆ—ä¸­ã€‚é˜Ÿåˆ—ä»…å—ä¸»æœºçš„å†…å­˜å’Œç£ç›˜é™åˆ¶çš„çº¦æŸï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå¤§çš„æ¶ˆæ¯ç¼“å†²åŒºã€‚è®¸å¤šç”Ÿäº§è€…å¯ ä»¥å°†æ¶ˆæ¯å‘é€åˆ°ä¸€ä¸ªé˜Ÿåˆ—ï¼Œè®¸å¤šæ¶ˆè´¹è€…å¯ä»¥å°è¯•ä»ä¸€ä¸ªé˜Ÿåˆ—æ¥æ”¶æ•°æ®ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨é˜Ÿåˆ—çš„æ–¹å¼</p><blockquote><p>**æ¶ˆè´¹è€… **</p></blockquote><p>æ¶ˆè´¹ä¸æ¥æ”¶å…·æœ‰ç›¸ä¼¼çš„å«ä¹‰ã€‚æ¶ˆè´¹è€…å¤§å¤šæ—¶å€™æ˜¯ä¸€ä¸ªç­‰å¾…æ¥æ”¶æ¶ˆæ¯çš„ç¨‹åºã€‚è¯·æ³¨æ„ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹ è€…å’Œæ¶ˆæ¯ä¸­é—´ä»¶å¾ˆå¤šæ—¶å€™å¹¶ä¸åœ¨åŒä¸€æœºå™¨ä¸Šã€‚åŒä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¢å¯ä»¥æ˜¯ç”Ÿäº§è€…åˆæ˜¯å¯ä»¥æ˜¯æ¶ˆè´¹è€…ã€‚</p><h4 id="_1-2-3-rabbitmq-æ ¸å¿ƒéƒ¨åˆ†" tabindex="-1"><a class="header-anchor" href="#_1-2-3-rabbitmq-æ ¸å¿ƒéƒ¨åˆ†"><span>1.2.3. RabbitMQ æ ¸å¿ƒéƒ¨åˆ†</span></a></h4><figure><a href="https://imgse.com/i/pCSUM60" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSUM60.jpg" alt="pCSUM60.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSUM60.jpg</figcaption></figure><h4 id="_1-2-4-å„ä¸ªåè¯ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_1-2-4-å„ä¸ªåè¯ä»‹ç»"><span>1.2.4. å„ä¸ªåè¯ä»‹ç»</span></a></h4><figure><a href="https://imgse.com/i/pCSUKlq" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSUKlq.jpg" alt="pCSUKlq.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSUKlq.jpg</figcaption></figure><p>**Brokerï¼š**æ¥æ”¶å’Œåˆ†å‘æ¶ˆæ¯çš„åº”ç”¨ï¼ŒRabbitMQ Server å°±æ˜¯ Message Broker</p><p>**Virtual hostï¼š**å‡ºäºå¤šç§Ÿæˆ·å’Œå®‰å…¨å› ç´ è®¾è®¡çš„ï¼ŒæŠŠ AMQP çš„åŸºæœ¬ç»„ä»¶åˆ’åˆ†åˆ°ä¸€ä¸ªè™šæ‹Ÿçš„åˆ†ç»„ä¸­ï¼Œç±»ä¼¼ äºç½‘ç»œä¸­çš„ namespace æ¦‚å¿µã€‚å½“å¤šä¸ªä¸åŒçš„ç”¨æˆ·ä½¿ç”¨åŒä¸€ä¸ª RabbitMQ server æä¾›çš„æœåŠ¡æ—¶ï¼Œå¯ä»¥åˆ’åˆ†å‡º å¤šä¸ª vhostï¼Œæ¯ä¸ªç”¨æˆ·åœ¨è‡ªå·±çš„ vhost åˆ›å»º exchangeï¼queue ç­‰</p><p>**Connectionï¼š**publisherï¼consumer å’Œ broker ä¹‹é—´çš„ TCP è¿æ¥</p><p>**Channelï¼š**å¦‚æœæ¯ä¸€æ¬¡è®¿é—® RabbitMQ éƒ½å»ºç«‹ä¸€ä¸ª Connectionï¼Œåœ¨æ¶ˆæ¯é‡å¤§çš„æ—¶å€™å»ºç«‹ TCP Connection çš„å¼€é”€å°†æ˜¯å·¨å¤§çš„ï¼Œæ•ˆç‡ä¹Ÿè¾ƒä½ã€‚Channel æ˜¯åœ¨ connection å†…éƒ¨å»ºç«‹çš„é€»è¾‘è¿æ¥ï¼Œå¦‚æœåº”ç”¨ç¨‹ åºæ”¯æŒå¤šçº¿ç¨‹ï¼Œé€šå¸¸æ¯ä¸ª thread åˆ›å»ºå•ç‹¬çš„ channel è¿›è¡Œé€šè®¯ï¼ŒAMQP method åŒ…å«äº† channel id å¸®åŠ©å®¢ æˆ·ç«¯å’Œ message broker è¯†åˆ« channelï¼Œæ‰€ä»¥ channel ä¹‹é—´æ˜¯å®Œå…¨éš”ç¦»çš„ã€‚Channel ä½œä¸ºè½»é‡çº§çš„ Connection æå¤§å‡å°‘äº†æ“ä½œç³»ç»Ÿå»ºç«‹ TCP connection çš„å¼€é”€</p><p>**Exchangeï¼š**message åˆ°è¾¾ broker çš„ç¬¬ä¸€ç«™ï¼Œæ ¹æ®åˆ†å‘è§„åˆ™ï¼ŒåŒ¹é…æŸ¥è¯¢è¡¨ä¸­çš„ routing keyï¼Œåˆ†å‘ æ¶ˆæ¯åˆ° queue ä¸­å»ã€‚å¸¸ç”¨çš„ç±»å‹æœ‰ï¼šdirect (point-to-point), topic (publish-subscribe) and fanout (multicast)</p><p>**Queueï¼š**æ¶ˆæ¯æœ€ç»ˆè¢«é€åˆ°è¿™é‡Œç­‰å¾… consumer å–èµ°</p><p>**Bindingï¼š**exchange å’Œ queue ä¹‹é—´çš„è™šæ‹Ÿè¿æ¥ï¼Œbinding ä¸­å¯ä»¥åŒ…å« routing keyï¼ŒBinding ä¿¡æ¯è¢«ä¿ å­˜åˆ° exchange ä¸­çš„æŸ¥è¯¢è¡¨ä¸­ï¼Œç”¨äº message çš„åˆ†å‘ä¾æ®</p><h4 id="_1-2-5-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_1-2-5-å®‰è£…"><span>1.2.5. å®‰è£…</span></a></h4><p><strong>1.å®˜ç½‘åœ°å€</strong></p><p>https://www.rabbitmq.com/download.html</p><p>**2.æ–‡ä»¶ä¸Šä¼  **</p><ul><li>ä¸Šä¼ åˆ°/usr/local/software ç›®å½•ä¸‹(å¦‚æœæ²¡æœ‰ software éœ€è¦è‡ªå·±åˆ›å»º)</li></ul><figure><a href="https://imgse.com/i/pCSBVRH" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSBVRH.jpg" alt="pCSBVRH.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSBVRH.jpg</figcaption></figure><p>**3.å®‰è£…æ–‡ä»¶(åˆ†åˆ«æŒ‰ç…§ä»¥ä¸‹é¡ºåºå®‰è£…) **</p><ul><li><p>rpm -ivh erlang-21.3-1.el7.x86_64.rpm</p></li><li><p>yum install socat -y</p></li><li><p>rpm -ivh rabbitmq-server-3.8.8-1.el7.noarch.rpm</p></li></ul><p>**3.å¸¸ç”¨å‘½ä»¤(æŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰§è¡Œ) **</p><p>**æ·»åŠ å¼€æœºå¯åŠ¨ RabbitMQ æœåŠ¡ **</p><ul><li>chkconfig rabbitmq-server on</li></ul><p>**å¯åŠ¨æœåŠ¡ **</p><ul><li>/sbin/service rabbitmq-server start</li></ul><p>**æŸ¥çœ‹æœåŠ¡çŠ¶æ€ **</p><ul><li>/sbin/service rabbitmq-server status</li></ul><figure><a href="https://imgse.com/i/pCSBJzj" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSBJzj.jpg" alt="pCSBJzj.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSBJzj.jpg</figcaption></figure><p>**åœæ­¢æœåŠ¡(é€‰æ‹©æ‰§è¡Œ) **</p><ul><li>/sbin/service rabbitmq-server stop</li></ul><p>**å¼€å¯ web ç®¡ç†æ’ä»¶ **</p><ul><li>rabbitmq-plugins enable rabbitmq_management</li></ul><p><strong>å¯åŠ¨æœåŠ¡</strong></p><ul><li>/sbin/service rabbitmq-server start</li></ul><p><strong>ç”¨é»˜è®¤è´¦å·å¯†ç (guest)è®¿é—®åœ°å€ï¼š</strong> http://82.157.234.124:15672/å‡ºç°æƒé™é—®é¢˜</p><p><strong>ç™»å½•è´¦å·å’Œå¯†ç éƒ½æ˜¯ï¼šguest guest</strong></p><p><strong>ç¬¬ä¸€æ¬¡æ— æ³•ç™»å½•</strong></p><figure><a href="https://imgse.com/i/pCSrjJS" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSrjJS.jpg" alt="pCSrjJS.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSrjJS.jpg</figcaption></figure><p>**4.æ·»åŠ ä¸€ä¸ªæ–°çš„ç”¨æˆ· **</p><p>**åˆ›å»ºè´¦å· **</p><ul><li>rabbitmqctl add_user admin 123</li></ul><p>**è®¾ç½®ç”¨æˆ·è§’è‰² **</p><ul><li>rabbitmqctl set_user_tags admin administrator</li></ul><p>**è®¾ç½®ç”¨æˆ·æƒé™ **</p><ul><li>rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.<em>&quot; &quot;.</em>&quot; &quot;.*&quot;</li></ul><p>ç”¨æˆ· user_admin å…·æœ‰/vhost1 è¿™ä¸ª virtual host ä¸­æ‰€æœ‰èµ„æºçš„é…ç½®ã€å†™ã€è¯»æƒé™ å½“å‰ç”¨æˆ·å’Œè§’è‰²</p><ul><li>rabbitmqctl list_users</li></ul><p><strong>5.å†æ¬¡åˆ©ç”¨ admin ç”¨æˆ·ç™»å½•</strong></p><p><strong>ç™»å½•é¡µé¢</strong></p><figure><a href="https://imgse.com/i/pCSyc4K" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSyc4K.jpg" alt="pCSyc4K.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSyc4K.jpg</figcaption></figure><h3 id="_2ã€hello-world-å…¥é—¨" tabindex="-1"><a class="header-anchor" href="#_2ã€hello-world-å…¥é—¨"><span>2ã€Hello Worldï¼ˆå…¥é—¨ï¼‰</span></a></h3><p>åœ¨æœ¬æ•™ç¨‹çš„è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ Java ç¼–å†™ä¸¤ä¸ªç¨‹åºã€‚å‘é€å•ä¸ªæ¶ˆæ¯çš„ç”Ÿäº§è€…å’Œæ¥æ”¶æ¶ˆæ¯å¹¶æ‰“å° å‡ºæ¥çš„æ¶ˆè´¹è€…ã€‚æˆ‘ä»¬å°†ä»‹ç» Java API ä¸­çš„ä¸€äº›ç»†èŠ‚ã€‚</p><p>åœ¨ä¸‹å›¾ä¸­ï¼Œâ€œ Pâ€æ˜¯æˆ‘ä»¬çš„ç”Ÿäº§è€…ï¼Œâ€œ Câ€æ˜¯æˆ‘ä»¬çš„æ¶ˆè´¹è€…ã€‚ä¸­é—´çš„æ¡†æ˜¯ä¸€ä¸ªé˜Ÿåˆ—-RabbitMQ ä»£ è¡¨ä½¿ç”¨è€…ä¿ç•™çš„æ¶ˆæ¯ç¼“å†²åŒº</p><figure><a href="https://imgse.com/i/pCScuLj" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCScuLj.jpg" alt="pCScuLj.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCScuLj.jpg</figcaption></figure><figure><a href="https://imgse.com/i/pCS45DO" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCS45DO.jpg" alt="pCS45DO.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCS45DO.jpg</figcaption></figure><h4 id="_2-1-ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#_2-1-ä¾èµ–"><span>2.1. ä¾èµ–</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>æŒ‡å®š jdk ç¼–è¯‘ç‰ˆæœ¬<span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>build<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>plugins<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>plugin<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>maven<span class="token punctuation">.</span>plugins<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>maven<span class="token operator">-</span>compiler<span class="token operator">-</span>plugin<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>configuration<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>source<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>source<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>target<span class="token punctuation">&gt;</span></span><span class="token number">8</span><span class="token operator">&lt;</span><span class="token operator">/</span>target<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>configuration<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>plugin<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>plugins<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>build<span class="token operator">&gt;</span>
<span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>rabbitmq ä¾èµ–å®¢æˆ·ç«¯<span class="token operator">--</span><span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>rabbitmq<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>amqp<span class="token operator">-</span>client<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">5.8</span><span class="token number">.0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>æ“ä½œæ–‡ä»¶æµçš„ä¸€ä¸ªä¾èµ–<span class="token operator">--</span><span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>commons<span class="token operator">-</span>io<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>commons<span class="token operator">-</span>io<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.6</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-2-æ¶ˆæ¯ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#_2-2-æ¶ˆæ¯ç”Ÿäº§è€…"><span>2.2. æ¶ˆæ¯ç”Ÿäº§è€…</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>

    <span class="token comment">//é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿æ¥ä¸»æœº</span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;82.157.234.124&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®è´¦å·ï¼Œå¯†ç </span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//åˆ›å»ºè¿æ¥</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * å£°æ˜é˜Ÿåˆ—
         * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—
         * 1.é˜Ÿåˆ—åç§°
         * 2.é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ– é»˜è®¤æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­
         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ æ˜¯å¦è¿›è¡Œå…±äº« true å¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹
         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ æœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€è¿æ¥ä»¥å è¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ true è‡ªåŠ¨åˆ é™¤
         * 5.å…¶ä»–å‚æ•°
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®æ¶ˆæ¯</span>
        <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * å‘é€ä¸€ä¸ªæ¶ˆæ¯
         * 1.å‘é€åˆ°é‚£ä¸ªäº¤æ¢æœº
         * 2.è·¯ç”±çš„ key æ˜¯å“ªä¸ª
         * 3.å…¶ä»–çš„å‚æ•°ä¿¡æ¯
         * 4.å‘é€æ¶ˆæ¯çš„æ¶ˆæ¯ä½“
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘å¸ƒæˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>RabbitMQæ§åˆ¶å°</strong></p><figure><a href="https://imgse.com/i/pCShQw4" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCShQw4.jpg" alt="pCShQw4.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCShQw4.jpg</figcaption></figure><h4 id="_2-3-æ¶ˆæ¯æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#_2-3-æ¶ˆæ¯æ¶ˆè´¹è€…"><span>2.3. æ¶ˆæ¯æ¶ˆè´¹è€…</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 *æ¶ˆæ¯æ¶ˆè´¹è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span>

    <span class="token comment">//åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿æ¥ä¸»æœº</span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;82.157.234.124&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®è´¦å·å¯†ç </span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//åˆ›å»ºè¿æ¥</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒ(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span>delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">CancelCallback</span> cancelCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å–æ¶ˆæ¶ˆè´¹æ¶ˆæ¯ï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯
         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—
         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­” true ä»£è¡¨è‡ªåŠ¨åº”ç­” false æ‰‹åŠ¨åº”ç­”
         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>deliverCallback<span class="token punctuation">,</span>cancelCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ§åˆ¶å°è¾“å‡º</strong></p><figure><a href="https://imgse.com/i/pCSTaoF" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSTaoF.jpg" alt="pCSTaoF.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSTaoF.jpg</figcaption></figure><p><strong>RabbitMQæ§åˆ¶å°</strong></p><figure><a href="https://imgse.com/i/pCSTKIg" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSTKIg.jpg" alt="pCSTKIg.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSTKIg.jpg</figcaption></figure><h3 id="_3ã€work-queues-å·¥ä½œé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_3ã€work-queues-å·¥ä½œé˜Ÿåˆ—"><span>3ã€Work Queuesï¼ˆå·¥ä½œé˜Ÿåˆ—ï¼‰</span></a></h3><p><strong>äº¤æ¢æœºä¹‹å‰</strong></p><figure><a href="https://imgse.com/i/pCpc7xU" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/03/pCpc7xU.jpg" alt="pCpc7xU.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpc7xU.jpg</figcaption></figure><p>å·¥ä½œé˜Ÿåˆ—(åˆç§°ä»»åŠ¡é˜Ÿåˆ—)çš„ä¸»è¦æ€æƒ³æ˜¯é¿å…ç«‹å³æ‰§è¡Œèµ„æºå¯†é›†å‹ä»»åŠ¡ï¼Œè€Œä¸å¾—ä¸ç­‰å¾…å®ƒå®Œæˆã€‚ ç›¸åæˆ‘ä»¬å®‰æ’ä»»åŠ¡åœ¨ä¹‹åæ‰§è¡Œã€‚æˆ‘ä»¬æŠŠä»»åŠ¡å°è£…ä¸ºæ¶ˆæ¯å¹¶å°†å…¶å‘é€åˆ°é˜Ÿåˆ—ã€‚åœ¨åå°è¿è¡Œçš„å·¥ä½œè¿› ç¨‹å°†å¼¹å‡ºä»»åŠ¡å¹¶æœ€ç»ˆæ‰§è¡Œä½œä¸šã€‚å½“æœ‰å¤šä¸ªå·¥ä½œçº¿ç¨‹æ—¶ï¼Œè¿™äº›å·¥ä½œçº¿ç¨‹å°†ä¸€èµ·å¤„ç†è¿™äº›ä»»åŠ¡ã€‚</p><h4 id="_3-1-è½®è¯¢åˆ†å‘æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_3-1-è½®è¯¢åˆ†å‘æ¶ˆæ¯"><span>3.1. è½®è¯¢åˆ†å‘æ¶ˆæ¯</span></a></h4><p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­æˆ‘ä»¬ä¼šå¯åŠ¨ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œä¸€ä¸ªæ¶ˆæ¯å‘é€çº¿ç¨‹ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»–ä»¬ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹ æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><figure><a href="https://imgse.com/i/pCS7lTO" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCS7lTO.jpg" alt="pCS7lTO.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCS7lTO.jpg</figcaption></figure><h5 id="_3-1-1-æŠ½å–å·¥å…·ç±»" tabindex="-1"><a class="header-anchor" href="#_3-1-1-æŠ½å–å·¥å…·ç±»"><span>3.1.1. æŠ½å–å·¥å…·ç±»</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * è¿æ¥RabbitMQåˆ›å»ºä¿¡é“çš„å·¥å…·ç±»
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConnectionUtils</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Channel</span> <span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//åˆ›å»ºä¸€ä¸ªè¿æ¥å·¥å‚</span>
        <span class="token class-name">ConnectionFactory</span> connectionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è¿æ¥ä¸»æœº</span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">&quot;82.157.234.124&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®è´¦å·å¯†ç </span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;admin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connectionFactory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//åˆ›å»ºè¿æ¥</span>
        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> connectionFactory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> channel<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-1-2-å¯åŠ¨ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-1-2-å¯åŠ¨ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹"><span>3.1.2. å¯åŠ¨ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å·¥ä½œçº¿ç¨‹
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WorkThread</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒ(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">CancelCallback</span> cancelCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¶ˆæ¯æ¥å£å›è°ƒé€»è¾‘&quot;</span> <span class="token operator">+</span> consumerTag<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯
         * 1.æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—
         * 2.æ¶ˆè´¹æˆåŠŸä¹‹åæ˜¯å¦è¦è‡ªåŠ¨åº”ç­” true ä»£è¡¨è‡ªåŠ¨åº”ç­” false æ‰‹åŠ¨åº”ç­”
         * 3.æ¶ˆè´¹è€…æœªæˆåŠŸæ¶ˆè´¹çš„å›è°ƒ
         */</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å·¥ä½œçº¿ç¨‹2ç­‰å¾…æ¥æ”¶æ¶ˆæ¯...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>deliverCallback<span class="token punctuation">,</span>cancelCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>IDEAéœ€è¦è®¾ç½®å…è®¸è¿è¡Œå¤šä¸ªçº¿ç¨‹</strong></p><figure><a href="https://imgse.com/i/pCSbAz9" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSbAz9.jpg" alt="pCSbAz9.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSbAz9.jpg</figcaption></figure><figure><a href="https://imgse.com/i/pCSbeqx" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSbeqx.jpg" alt="pCSbeqx.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSbeqx.jpg</figcaption></figure><h5 id="_3-1-3-å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹" tabindex="-1"><a class="header-anchor" href="#_3-1-3-å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹"><span>3.1.3. å¯åŠ¨ä¸€ä¸ªå‘é€çº¿ç¨‹</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ç”Ÿäº§è€… å‘å¸ƒå¤§é‡çš„æ¶ˆæ¯
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SendThread</span> <span class="token punctuation">{</span>

    <span class="token comment">//é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * å£°æ˜é˜Ÿåˆ—
         * ç”Ÿæˆä¸€ä¸ªé˜Ÿåˆ—
         * 1.é˜Ÿåˆ—åç§°
         * 2.é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯æ˜¯å¦æŒä¹…åŒ– é»˜è®¤æ¶ˆæ¯å­˜å‚¨åœ¨å†…å­˜ä¸­
         * 3.è¯¥é˜Ÿåˆ—æ˜¯å¦åªä¾›ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹ æ˜¯å¦è¿›è¡Œå…±äº« true å¯ä»¥å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹
         * 4.æ˜¯å¦è‡ªåŠ¨åˆ é™¤ æœ€åä¸€ä¸ªæ¶ˆè´¹è€…ç«¯å¼€è¿æ¥ä»¥å è¯¥é˜Ÿåˆ—æ˜¯å¦è‡ªåŠ¨åˆ é™¤ true è‡ªåŠ¨åˆ é™¤
         * 5.å…¶ä»–å‚æ•°
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//é€šè¿‡æ§åˆ¶å°è¾“å…¥æ¶ˆæ¯</span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å‘å¸ƒæ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘å¸ƒçš„æ¶ˆæ¯æ˜¯ï¼š&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç»“æœç¬¦åˆè½®è¯¢æœºåˆ¶</strong></p><figure><a href="https://imgse.com/i/pCSqepQ" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSqepQ.jpg" alt="pCSqepQ.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSqepQ.jpg</figcaption></figure><figure><a href="https://imgse.com/i/pCSqmlj" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSqmlj.jpg" alt="pCSqmlj.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSqmlj.jpg</figcaption></figure><figure><a href="https://imgse.com/i/pCSqVfg" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCSqVfg.jpg" alt="pCSqVfg.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCSqVfg.jpg</figcaption></figure><h4 id="_3-2-æ¶ˆæ¯åº”ç­”" tabindex="-1"><a class="header-anchor" href="#_3-2-æ¶ˆæ¯åº”ç­”"><span>3.2. æ¶ˆæ¯åº”ç­”</span></a></h4><h5 id="_3-2-1-æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_3-2-1-æ¦‚å¿µ"><span><strong>3.2.1. æ¦‚å¿µ</strong></span></a></h5><p>æ¶ˆè´¹è€…å®Œæˆä¸€ä¸ªä»»åŠ¡å¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ä¸€ä¸ªé•¿çš„ä»»åŠ¡å¹¶ä»…åªå®Œæˆ äº†éƒ¨åˆ†çªç„¶å®ƒæŒ‚æ‰äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚RabbitMQ ä¸€æ—¦å‘æ¶ˆè´¹è€…ä¼ é€’äº†ä¸€æ¡æ¶ˆæ¯ï¼Œä¾¿ç«‹å³å°†è¯¥æ¶ˆ æ¯æ ‡è®°ä¸ºåˆ é™¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçªç„¶æœ‰ä¸ªæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°†ä¸¢å¤±æ­£åœ¨å¤„ç†çš„æ¶ˆæ¯ã€‚ä»¥åŠåç»­ å‘é€ç»™è¯¥æ¶ˆè´¹è¿™çš„æ¶ˆæ¯ï¼Œå› ä¸ºå®ƒæ— æ³•æ¥æ”¶åˆ°ã€‚</p><p>ä¸ºäº†ä¿è¯æ¶ˆæ¯åœ¨å‘é€è¿‡ç¨‹ä¸­ä¸ä¸¢å¤±ï¼Œrabbitmq å¼•å…¥æ¶ˆæ¯åº”ç­”æœºåˆ¶ï¼Œæ¶ˆæ¯åº”ç­”å°±æ˜¯:**æ¶ˆè´¹è€…åœ¨æ¥ æ”¶åˆ°æ¶ˆæ¯å¹¶ä¸”å¤„ç†è¯¥æ¶ˆæ¯ä¹‹åï¼Œå‘Šè¯‰ rabbitmq å®ƒå·²ç»å¤„ç†äº†ï¼Œrabbitmq å¯ä»¥æŠŠè¯¥æ¶ˆæ¯åˆ é™¤äº†ã€‚ **</p><h5 id="_3-2-2-è‡ªåŠ¨åº”ç­”" tabindex="-1"><a class="header-anchor" href="#_3-2-2-è‡ªåŠ¨åº”ç­”"><span><strong>3.2.2. è‡ªåŠ¨åº”ç­”</strong></span></a></h5><p>æ¶ˆæ¯å‘é€åç«‹å³è¢«è®¤ä¸ºå·²ç»ä¼ é€æˆåŠŸï¼Œè¿™ç§æ¨¡å¼éœ€è¦åœ¨<strong>é«˜ååé‡å’Œæ•°æ®ä¼ è¾“å®‰å…¨æ€§æ–¹é¢åšæƒ è¡¡</strong>,å› ä¸ºè¿™ç§æ¨¡å¼å¦‚æœæ¶ˆæ¯åœ¨æ¥æ”¶åˆ°ä¹‹å‰ï¼Œæ¶ˆè´¹è€…é‚£è¾¹å‡ºç°è¿æ¥æˆ–è€… channel å…³é—­ï¼Œé‚£ä¹ˆæ¶ˆæ¯å°±ä¸¢ å¤±äº†,å½“ç„¶å¦ä¸€æ–¹é¢è¿™ç§æ¨¡å¼æ¶ˆè´¹è€…é‚£è¾¹å¯ä»¥ä¼ é€’è¿‡è½½çš„æ¶ˆæ¯ï¼Œ<strong>æ²¡æœ‰å¯¹ä¼ é€’çš„æ¶ˆæ¯æ•°é‡è¿›è¡Œé™åˆ¶</strong>ï¼Œ å½“ç„¶è¿™æ ·æœ‰å¯èƒ½ä½¿å¾—æ¶ˆè´¹è€…è¿™è¾¹ç”±äºæ¥æ”¶å¤ªå¤šè¿˜æ¥ä¸åŠå¤„ç†çš„æ¶ˆæ¯ï¼Œå¯¼è‡´è¿™äº›æ¶ˆæ¯çš„ç§¯å‹ï¼Œæœ€ç»ˆ ä½¿å¾—å†…å­˜è€—å°½ï¼Œæœ€ç»ˆè¿™äº›æ¶ˆè´¹è€…çº¿ç¨‹è¢«æ“ä½œç³»ç»Ÿæ€æ­»ï¼Œ<strong>æ‰€ä»¥è¿™ç§æ¨¡å¼ä»…é€‚ç”¨åœ¨æ¶ˆè´¹è€…å¯ä»¥é«˜æ•ˆå¹¶ ä»¥æŸç§é€Ÿç‡èƒ½å¤Ÿå¤„ç†è¿™äº›æ¶ˆæ¯çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</strong></p><h5 id="_3-2-3-æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_3-2-3-æ¶ˆæ¯åº”ç­”çš„æ–¹æ³•"><span>**3.2.3. æ¶ˆæ¯åº”ç­”çš„æ–¹æ³• **</span></a></h5><blockquote><p><strong>A</strong>.**Channel.basicAck(ç”¨äºè‚¯å®šç¡®è®¤) **</p><p>â€‹ RabbitMQ å·²çŸ¥é“è¯¥æ¶ˆæ¯å¹¶ä¸”æˆåŠŸçš„å¤„ç†æ¶ˆæ¯ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†</p><p><strong>B.Channel.basicNack(ç”¨äºå¦å®šç¡®è®¤)</strong></p><p>**C.Channel.basicReject(ç”¨äºå¦å®šç¡®è®¤) **</p><p>â€‹ ä¸ Channel.basicNack ç›¸æ¯”å°‘ä¸€ä¸ªå‚æ•°</p><p>â€‹ ä¸å¤„ç†è¯¥æ¶ˆæ¯äº†ç›´æ¥æ‹’ç»ï¼Œå¯ä»¥å°†å…¶ä¸¢å¼ƒäº†</p></blockquote><h5 id="_3-2-4-multiple-çš„è§£é‡Š" tabindex="-1"><a class="header-anchor" href="#_3-2-4-multiple-çš„è§£é‡Š"><span><strong>3.2.4. Multiple çš„è§£é‡Š</strong></span></a></h5><p>â€‹ æ‰‹åŠ¨åº”ç­”çš„å¥½å¤„æ˜¯å¯ä»¥æ‰¹é‡åº”ç­”å¹¶ä¸”å‡å°‘ç½‘ç»œæ‹¥å µ</p><figure><a href="https://imgse.com/i/pCpiyZD" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCpiyZD.jpg" alt="pCpiyZD.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpiyZD.jpg</figcaption></figure><p>multiple çš„ true å’Œ false ä»£è¡¨ä¸åŒæ„æ€</p><p>â€‹ true ä»£è¡¨æ‰¹é‡åº”ç­” channel ä¸Šæœªåº”ç­”çš„æ¶ˆæ¯</p><p>â€‹ æ¯”å¦‚è¯´ channel ä¸Šæœ‰ä¼ é€ tag çš„æ¶ˆæ¯ 5,6,7,8 å½“å‰ tag æ˜¯ 8 é‚£ä¹ˆæ­¤æ—¶</p><p>â€‹ 5-8 çš„è¿™äº›è¿˜æœªåº”ç­”çš„æ¶ˆæ¯éƒ½ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</p><p>â€‹ false åŒä¸Šé¢ç›¸æ¯”</p><p>â€‹ åªä¼šåº”ç­” tag=8 çš„æ¶ˆæ¯ 5,6,7 è¿™ä¸‰ä¸ªæ¶ˆæ¯ä¾ç„¶ä¸ä¼šè¢«ç¡®è®¤æ”¶åˆ°æ¶ˆæ¯åº”ç­”</p><figure><a href="https://imgse.com/i/pCpi6de" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCpi6de.jpg" alt="pCpi6de.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpi6de.jpg</figcaption></figure><h5 id="_3-2-5-æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ" tabindex="-1"><a class="header-anchor" href="#_3-2-5-æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ"><span>**3.2.5. æ¶ˆæ¯è‡ªåŠ¨é‡æ–°å…¥é˜Ÿ **</span></a></h5><p>å¦‚æœæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› å¤±å»è¿æ¥(å…¶é€šé“å·²å…³é—­ï¼Œè¿æ¥å·²å…³é—­æˆ– TCP è¿æ¥ä¸¢å¤±)ï¼Œå¯¼è‡´æ¶ˆæ¯ æœªå‘é€ ACK ç¡®è®¤ï¼ŒRabbitMQ å°†äº†è§£åˆ°æ¶ˆæ¯æœªå®Œå…¨å¤„ç†ï¼Œå¹¶å°†å¯¹å…¶é‡æ–°æ’é˜Ÿã€‚å¦‚æœæ­¤æ—¶å…¶ä»–æ¶ˆè´¹è€… å¯ä»¥å¤„ç†ï¼Œå®ƒå°†å¾ˆå¿«å°†å…¶é‡æ–°åˆ†å‘ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚è¿™æ ·ï¼Œå³ä½¿æŸä¸ªæ¶ˆè´¹è€…å¶å°”æ­»äº¡ï¼Œä¹Ÿå¯ä»¥ç¡® ä¿ä¸ä¼šä¸¢å¤±ä»»ä½•æ¶ˆæ¯ã€‚</p><figure><a href="https://imgse.com/i/pCpiIL8" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/02/pCpiIL8.jpg" alt="pCpiIL8.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpiIL8.jpg</figcaption></figure><h5 id="_3-2-6-æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç " tabindex="-1"><a class="header-anchor" href="#_3-2-6-æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç "><span>**3.2.6. æ¶ˆæ¯æ‰‹åŠ¨åº”ç­”ä»£ç  **</span></a></h5><p><strong>æ¶ˆæ¯ç”Ÿäº§è€…</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯åœ¨æ‰‹åŠ¨åº”ç­”æ—¶æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œæ”¾å›é˜Ÿåˆ—ä¸­é‡æ–°å…¥é˜Ÿ
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandleResponseProducer</span> <span class="token punctuation">{</span>

    <span class="token comment">//é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TASK_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;task_queue&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//å£°æ˜é˜Ÿåˆ—</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">TASK_QUEUE_NAME</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//ä»æ§åˆ¶å°è¾“å…¥æ¶ˆæ¯</span>
        <span class="token class-name">Scanner</span> scanner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>scanner<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token constant">TASK_QUEUE_NAME</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆè´¹è€… 01</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ‰‹åŠ¨åº”ç­”æ¶ˆæ¯è€…01
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskConsumer</span> <span class="token punctuation">{</span>

    <span class="token comment">//é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TASK_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;task_queue&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;C1 ç­‰å¾…æ¥æ”¶æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒçŸ­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒ(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span>delivery<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ç¡1S</span>
            <span class="token class-name">SleepUtils</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token doc-comment comment">/**
             * 1.æ¶ˆæ¯æ ‡è®° tag
             * 2.æ˜¯å¦æ‰¹é‡åº”ç­”æœªåº”ç­”æ¶ˆæ¯
             */</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">CancelCallback</span> cancelCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>consumerTag<span class="token operator">+</span><span class="token string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¥æ”¶æ¶ˆæ¯</span>
        <span class="token keyword">boolean</span> autoAck <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">TASK_QUEUE_NAME</span><span class="token punctuation">,</span>autoAck<span class="token punctuation">,</span>deliverCallback<span class="token punctuation">,</span>cancelCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆè´¹è€… 02</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ‰‹åŠ¨åº”ç­”æ¶ˆæ¯è€…02
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TaskConsumer02</span> <span class="token punctuation">{</span>

    <span class="token comment">//é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">TASK_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;task_queue&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;C2 ç­‰å¾…æ¥æ”¶æ¶ˆæ¯å¤„ç†æ—¶é—´è¾ƒé•¿&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¨é€çš„æ¶ˆæ¯å¦‚ä½•è¿›è¡Œæ¶ˆè´¹çš„æ¥å£å›è°ƒ(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span>delivery<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//ç¡30S</span>
            <span class="token class-name">SleepUtils</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ï¼š&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token doc-comment comment">/**
             * 1.æ¶ˆæ¯æ ‡è®° tag
             * 2.æ˜¯å¦æ‰¹é‡åº”ç­”æœªåº”ç­”æ¶ˆæ¯
             */</span>
            channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//å–æ¶ˆæ¶ˆè´¹çš„ä¸€ä¸ªå›è°ƒæ¥å£ å¦‚åœ¨æ¶ˆè´¹çš„æ—¶å€™é˜Ÿåˆ—è¢«åˆ é™¤æ‰äº†(è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç›´æ¥ç”¨lamdaè¡¨è¾¾å¼ç¼–å†™)</span>
        <span class="token class-name">CancelCallback</span> cancelCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>consumerTag<span class="token operator">+</span><span class="token string">&quot;æ¶ˆè´¹è€…å–æ¶ˆæ¶ˆè´¹æ¥å£å›è°ƒé€»è¾‘&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¥æ”¶æ¶ˆæ¯</span>
        <span class="token keyword">boolean</span> autoAck <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">TASK_QUEUE_NAME</span><span class="token punctuation">,</span>autoAck<span class="token punctuation">,</span>deliverCallback<span class="token punctuation">,</span>cancelCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç¡çœ å·¥å…·ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * ç¡çœ å·¥å…·ç±»
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SleepUtils</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">int</span> second<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> second<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-2-7-æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#_3-2-7-æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º"><span><strong>3.2.7. æ‰‹åŠ¨åº”ç­”æ•ˆæœæ¼”ç¤º</strong></span></a></h5><p>æ­£å¸¸æƒ…å†µä¸‹æ¶ˆæ¯å‘é€æ–¹å‘é€ä¸¤ä¸ªæ¶ˆæ¯ C1 å’Œ C2 åˆ†åˆ«æ¥æ”¶åˆ°æ¶ˆæ¯å¹¶è¿›è¡Œå¤„ç†</p><p>![](C:\Users\çŸ³æ–‡å­¦\OneDrive\å›¾ç‰‡\iTop Screenshot\rm23.jpeg)</p><p>åœ¨å‘é€è€…å‘é€æ¶ˆæ¯ ddï¼Œå‘å‡ºæ¶ˆæ¯ä¹‹åçš„æŠŠ C2 æ¶ˆè´¹è€…åœæ‰ï¼ŒæŒ‰ç†è¯´è¯¥ C2 æ¥å¤„ç†è¯¥æ¶ˆæ¯ï¼Œä½†æ˜¯ ç”±äºå®ƒå¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œåœ¨è¿˜æœªå¤„ç†å®Œï¼Œä¹Ÿå°±æ˜¯è¯´ C2 è¿˜æ²¡æœ‰æ‰§è¡Œ ack ä»£ç çš„æ—¶å€™ï¼ŒC2 è¢«åœæ‰äº†ï¼Œ æ­¤æ—¶ä¼šçœ‹åˆ°æ¶ˆæ¯è¢« C1 æ¥æ”¶åˆ°äº†ï¼Œè¯´æ˜æ¶ˆæ¯ dd è¢«é‡æ–°å…¥é˜Ÿï¼Œç„¶ååˆ†é…ç»™èƒ½å¤„ç†æ¶ˆæ¯çš„ C1 å¤„ç†äº†</p><p>![](C:\Users\çŸ³æ–‡å­¦\OneDrive\å›¾ç‰‡\iTop Screenshot\rm24.jpeg)</p><p>![](C:\Users\çŸ³æ–‡å­¦\OneDrive\å›¾ç‰‡\iTop Screenshot\rm25.jpeg)</p><h4 id="_3-3-rabbitmq-æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-3-rabbitmq-æŒä¹…åŒ–"><span>3.3. RabbitMQ æŒä¹…åŒ–</span></a></h4><h5 id="_3-3-1-æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_3-3-1-æ¦‚å¿µ"><span>**3.3.1. æ¦‚å¿µ **</span></a></h5><p>åˆšåˆšæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†å¦‚ä½•å¤„ç†ä»»åŠ¡ä¸ä¸¢å¤±çš„æƒ…å†µï¼Œä½†æ˜¯å¦‚ä½•ä¿éšœå½“ RabbitMQ æœåŠ¡åœæ‰ä»¥åæ¶ˆ æ¯ç”Ÿäº§è€…å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚é»˜è®¤æƒ…å†µä¸‹ RabbitMQ é€€å‡ºæˆ–ç”±äºæŸç§åŸå› å´©æºƒæ—¶ï¼Œå®ƒå¿½è§†é˜Ÿåˆ— å’Œæ¶ˆæ¯ï¼Œé™¤éå‘ŠçŸ¥å®ƒä¸è¦è¿™æ ·åšã€‚ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±éœ€è¦åšä¸¤ä»¶äº‹ï¼šæˆ‘ä»¬éœ€è¦å°†é˜Ÿåˆ—å’Œæ¶ˆæ¯éƒ½æ ‡ è®°ä¸ºæŒä¹…åŒ–ã€‚</p><h5 id="_3-3-2-é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-3-2-é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ–"><span>**3.3.2. é˜Ÿåˆ—å¦‚ä½•å®ç°æŒä¹…åŒ– **</span></a></h5><p>ä¹‹å‰æˆ‘ä»¬åˆ›å»ºçš„é˜Ÿåˆ—éƒ½æ˜¯éæŒä¹…åŒ–çš„ï¼Œrabbitmq å¦‚æœé‡å¯çš„åŒ–ï¼Œè¯¥é˜Ÿåˆ—å°±ä¼šè¢«åˆ é™¤æ‰ï¼Œå¦‚æœ è¦é˜Ÿåˆ—å®ç°æŒä¹…åŒ– éœ€è¦åœ¨å£°æ˜é˜Ÿåˆ—çš„æ—¶å€™æŠŠ durable å‚æ•°è®¾ç½®ä¸ºæŒä¹…åŒ–</p><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//é˜Ÿåˆ—æŒä¹…åŒ–</span>
<span class="token keyword">boolean</span> durable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> durable<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä½†æ˜¯éœ€è¦æ³¨æ„çš„å°±æ˜¯å¦‚æœä¹‹å‰å£°æ˜çš„é˜Ÿåˆ—ä¸æ˜¯æŒä¹…åŒ–çš„ï¼Œéœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—å…ˆåˆ é™¤ï¼Œæˆ–è€…é‡æ–° åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–çš„é˜Ÿåˆ—ï¼Œä¸ç„¶å°±ä¼šå‡ºç°é”™è¯¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>rabbitmq<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>ShutdownSignalException</span><span class="token operator">:</span> channel error<span class="token punctuation">;</span> protocol method<span class="token operator">:</span> #method<span class="token generics"><span class="token punctuation">&lt;</span>channel<span class="token punctuation">.</span>close<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>reply<span class="token operator">-</span>code<span class="token operator">=</span><span class="token number">406</span><span class="token punctuation">,</span> reply<span class="token operator">-</span>text<span class="token operator">=</span><span class="token constant">PRECONDITION_FAILED</span> <span class="token operator">-</span> inequivalent arg &#39;durable&#39; <span class="token keyword">for</span> queue &#39;task_queue&#39; in vhost <span class="token char">&#39;/&#39;</span><span class="token operator">:</span> received <span class="token char">&#39;true&#39;</span> but current is <span class="token char">&#39;false&#39;</span><span class="token punctuation">,</span> <span class="token keyword">class</span><span class="token operator">-</span>id<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> method<span class="token operator">-</span>id<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä»¥ä¸‹ä¸ºæ§åˆ¶å°ä¸­æŒä¹…åŒ–ä¸éæŒä¹…åŒ–é˜Ÿåˆ—çš„ UI æ˜¾ç¤ºåŒºã€</p><p>[<img src="https://s1.ax1x.com/2023/06/03/pCpNXVS.jpg" alt="pCpNXVS.jpg" loading="lazy"><a href="https://imgse.com/i/pCpNXVS" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/03/pCpNXVS.jpg" alt="pCpNXVS.jpg" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>è¿™ä¸ªæ—¶å€™å³ä½¿é‡å¯ rabbitmq é˜Ÿåˆ—ä¹Ÿä¾ç„¶å­˜åœ¨</strong></p><h5 id="_3-3-3-æ¶ˆæ¯å®ç°æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-3-3-æ¶ˆæ¯å®ç°æŒä¹…åŒ–"><span><strong>3.3.3. æ¶ˆæ¯å®ç°æŒä¹…åŒ–</strong></span></a></h5><p>è¦æƒ³è®©æ¶ˆæ¯å®ç°æŒä¹…åŒ–éœ€è¦åœ¨æ¶ˆæ¯ç”Ÿäº§è€…ä¿®æ”¹ä»£ç ï¼ŒMessageProperties.PERSISTENT_TEXT_PLAIN æ·» åŠ è¿™ä¸ªå±æ€§ã€‚</p><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//è®¾ç½®æ¶ˆæ¯æŒä¹…åŒ–</span>
channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token constant">TASK_QUEUE_NAME</span><span class="token punctuation">,</span><span class="token class-name">MessageProperties</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT_TEXT_PLAIN</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†æ¶ˆæ¯æ ‡è®°ä¸ºæŒä¹…åŒ–å¹¶ä¸èƒ½å®Œå…¨ä¿è¯ä¸ä¼šä¸¢å¤±æ¶ˆæ¯ã€‚å°½ç®¡å®ƒå‘Šè¯‰ RabbitMQ å°†æ¶ˆæ¯ä¿å­˜åˆ°ç£ç›˜ï¼Œä½†æ˜¯ è¿™é‡Œä¾ç„¶å­˜åœ¨å½“æ¶ˆæ¯åˆšå‡†å¤‡å­˜å‚¨åœ¨ç£ç›˜çš„æ—¶å€™ ä½†æ˜¯è¿˜æ²¡æœ‰å­˜å‚¨å®Œï¼Œæ¶ˆæ¯è¿˜åœ¨ç¼“å­˜çš„ä¸€ä¸ªé—´éš”ç‚¹ã€‚æ­¤æ—¶å¹¶æ²¡ æœ‰çœŸæ­£å†™å…¥ç£ç›˜ã€‚æŒä¹…æ€§ä¿è¯å¹¶ä¸å¼ºï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„ç®€å•ä»»åŠ¡é˜Ÿåˆ—è€Œè¨€ï¼Œè¿™å·²ç»ç»°ç»°æœ‰ä½™äº†ã€‚å¦‚æœéœ€è¦ æ›´å¼ºæœ‰åŠ›çš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå‚è€ƒåè¾¹è¯¾ä»¶å‘å¸ƒç¡®è®¤ç« èŠ‚ã€‚</p><h5 id="_3-3-4-ä¸å…¬å¹³åˆ†å‘" tabindex="-1"><a class="header-anchor" href="#_3-3-4-ä¸å…¬å¹³åˆ†å‘"><span>**3.3.4. ä¸å…¬å¹³åˆ†å‘ **</span></a></h5><p>åœ¨æœ€å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å­¦ä¹ åˆ° RabbitMQ åˆ†å‘æ¶ˆæ¯é‡‡ç”¨çš„è½®è®­åˆ†å‘ï¼Œä½†æ˜¯åœ¨æŸç§åœºæ™¯ä¸‹è¿™ç§ç­–ç•¥å¹¶ä¸æ˜¯ å¾ˆå¥½ï¼Œæ¯”æ–¹è¯´æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…åœ¨å¤„ç†ä»»åŠ¡ï¼Œå…¶ä¸­æœ‰ä¸ªæ¶ˆè´¹è€… 1 å¤„ç†ä»»åŠ¡çš„é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œå¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€… 2 å¤„ç†é€Ÿåº¦å´å¾ˆæ…¢ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨è½®è®­åˆ†å‘çš„åŒ–å°±ä¼šåˆ°è¿™å¤„ç†é€Ÿåº¦å¿«çš„è¿™ä¸ªæ¶ˆè´¹è€…å¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´ å¤„äºç©ºé—²çŠ¶æ€ï¼Œè€Œå¤„ç†æ…¢çš„é‚£ä¸ªæ¶ˆè´¹è€…ä¸€ç›´åœ¨å¹²æ´»ï¼Œè¿™ç§åˆ†é…æ–¹å¼åœ¨è¿™ç§æƒ…å†µä¸‹å…¶å®å°±ä¸å¤ªå¥½ï¼Œä½†æ˜¯ RabbitMQ å¹¶ä¸çŸ¥é“è¿™ç§æƒ…å†µå®ƒä¾ç„¶å¾ˆå…¬å¹³çš„è¿›è¡Œåˆ†å‘ã€‚</p><p><strong>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å‚æ•° channel.basicQos(1);</strong></p><p><strong>æ¶ˆè´¹è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//è®¾ç½®ä¸å…¬å¹³åˆ†å‘</span>
<span class="token keyword">int</span> prefetchCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span>prefetchCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><a href="https://imgse.com/i/pCpUNRA" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/03/pCpUNRA.jpg" alt="pCpUNRA.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpUNRA.jpg</figcaption></figure><p>æ„æ€å°±æ˜¯å¦‚æœè¿™ä¸ªä»»åŠ¡æˆ‘è¿˜æ²¡æœ‰å¤„ç†å®Œæˆ–è€…æˆ‘è¿˜æ²¡æœ‰åº”ç­”ä½ ï¼Œä½ å…ˆåˆ«åˆ†é…ç»™æˆ‘ï¼Œæˆ‘ç›®å‰åªèƒ½å¤„ç†ä¸€ä¸ª ä»»åŠ¡ï¼Œç„¶å rabbitmq å°±ä¼šæŠŠè¯¥ä»»åŠ¡åˆ†é…ç»™æ²¡æœ‰é‚£ä¹ˆå¿™çš„é‚£ä¸ªç©ºé—²æ¶ˆè´¹è€…ï¼Œå½“ç„¶å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½æ²¡æœ‰å®Œ æˆæ‰‹ä¸Šä»»åŠ¡ï¼Œé˜Ÿåˆ—è¿˜åœ¨ä¸åœçš„æ·»åŠ æ–°ä»»åŠ¡ï¼Œé˜Ÿåˆ—æœ‰å¯èƒ½å°±ä¼šé‡åˆ°é˜Ÿåˆ—è¢«æ’‘æ»¡çš„æƒ…å†µï¼Œè¿™ä¸ªæ—¶å€™å°±åªèƒ½æ·»åŠ  æ–°çš„ worker æˆ–è€…æ”¹å˜å…¶ä»–å­˜å‚¨ä»»åŠ¡çš„ç­–ç•¥ã€‚</p><h5 id="_3-3-5-é¢„å–å€¼" tabindex="-1"><a class="header-anchor" href="#_3-3-5-é¢„å–å€¼"><span><strong>3.3.5. é¢„å–å€¼</strong></span></a></h5><figure><a href="https://imgse.com/i/pCpauFg" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/03/pCpauFg.jpg" alt="pCpauFg.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpauFg.jpg</figcaption></figure><p>æœ¬èº«æ¶ˆæ¯çš„å‘é€å°±æ˜¯å¼‚æ­¥å‘é€çš„ï¼Œæ‰€ä»¥åœ¨ä»»ä½•æ—¶å€™ï¼Œchannel ä¸Šè‚¯å®šä¸æ­¢åªæœ‰ä¸€ä¸ªæ¶ˆæ¯å¦å¤–æ¥è‡ªæ¶ˆè´¹ è€…çš„æ‰‹åŠ¨ç¡®è®¤æœ¬è´¨ä¸Šä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚å› æ­¤è¿™é‡Œå°±å­˜åœ¨ä¸€ä¸ªæœªç¡®è®¤çš„æ¶ˆæ¯ç¼“å†²åŒºï¼Œå› æ­¤å¸Œæœ›å¼€å‘äººå‘˜èƒ½==<strong>é™åˆ¶æ­¤ ç¼“å†²åŒºçš„å¤§å°</strong>==ï¼Œ<strong>ä»¥é¿å…ç¼“å†²åŒºé‡Œé¢æ— é™åˆ¶çš„æœªç¡®è®¤æ¶ˆæ¯é—®é¢˜</strong>ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ basic.qos æ–¹æ³•è®¾ ç½®â€œé¢„å–è®¡æ•°â€å€¼æ¥å®Œæˆçš„ã€‚<strong>è¯¥å€¼å®šä¹‰é€šé“ä¸Šå…è®¸çš„æœªç¡®è®¤æ¶ˆæ¯çš„æœ€å¤§æ•°é‡</strong>ã€‚ä¸€æ—¦æ•°é‡è¾¾åˆ°é…ç½®çš„æ•°é‡ï¼Œ RabbitMQ å°†åœæ­¢åœ¨é€šé“ä¸Šä¼ é€’æ›´å¤šæ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªå¤„ç†çš„æ¶ˆæ¯è¢«ç¡®è®¤ï¼Œä¾‹å¦‚ï¼Œå‡è®¾åœ¨é€šé“ä¸Šæœ‰ æœªç¡®è®¤çš„æ¶ˆæ¯ 5ã€6ã€7ï¼Œ8ï¼Œå¹¶ä¸”é€šé“çš„é¢„å–è®¡æ•°è®¾ç½®ä¸º 4ï¼Œæ­¤æ—¶ RabbitMQ å°†ä¸ä¼šåœ¨è¯¥é€šé“ä¸Šå†ä¼ é€’ä»»ä½• æ¶ˆæ¯ï¼Œé™¤éè‡³å°‘æœ‰ä¸€ä¸ªæœªåº”ç­”çš„æ¶ˆæ¯è¢« ackã€‚æ¯”æ–¹è¯´ tag=6 è¿™ä¸ªæ¶ˆæ¯åˆšåˆšè¢«ç¡®è®¤ ACKï¼ŒRabbitMQ å°†ä¼šæ„ŸçŸ¥ è¿™ä¸ªæƒ…å†µåˆ°å¹¶å†å‘é€ä¸€æ¡æ¶ˆæ¯ã€‚æ¶ˆæ¯åº”ç­”å’Œ QoS é¢„å–å€¼å¯¹ç”¨æˆ·ååé‡æœ‰é‡å¤§å½±å“ã€‚é€šå¸¸ï¼Œå¢åŠ é¢„å–å°†æé«˜ å‘æ¶ˆè´¹è€…ä¼ é€’æ¶ˆæ¯çš„é€Ÿåº¦ã€‚<strong>è™½ç„¶è‡ªåŠ¨åº”ç­”ä¼ è¾“æ¶ˆæ¯é€Ÿç‡æ˜¯æœ€ä½³çš„ï¼Œä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å·²ä¼ é€’ä½†å°šæœªå¤„ç†çš„æ¶ˆæ¯çš„æ•°é‡ä¹Ÿä¼šå¢åŠ ï¼Œä»è€Œå¢åŠ äº†æ¶ˆè´¹è€…çš„ RAM æ¶ˆè€—</strong>(éšæœºå­˜å–å­˜å‚¨å™¨)åº”è¯¥å°å¿ƒä½¿ç”¨å…·æœ‰æ— é™é¢„å¤„ç† çš„è‡ªåŠ¨ç¡®è®¤æ¨¡å¼æˆ–æ‰‹åŠ¨ç¡®è®¤æ¨¡å¼ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹äº†å¤§é‡çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰ç¡®è®¤çš„è¯ï¼Œä¼šå¯¼è‡´æ¶ˆè´¹è€…è¿æ¥èŠ‚ç‚¹çš„ å†…å­˜æ¶ˆè€—å˜å¤§ï¼Œæ‰€ä»¥æ‰¾åˆ°åˆé€‚çš„é¢„å–å€¼æ˜¯ä¸€ä¸ªåå¤è¯•éªŒçš„è¿‡ç¨‹ï¼Œä¸åŒçš„è´Ÿè½½è¯¥å€¼å–å€¼ä¹Ÿä¸åŒ 100 åˆ° 300 èŒƒ å›´å†…çš„å€¼é€šå¸¸å¯æä¾›æœ€ä½³çš„ååé‡ï¼Œå¹¶ä¸”ä¸ä¼šç»™æ¶ˆè´¹è€…å¸¦æ¥å¤ªå¤§çš„é£é™©ã€‚é¢„å–å€¼ä¸º 1 æ˜¯æœ€ä¿å®ˆçš„ã€‚å½“ç„¶è¿™ å°†ä½¿ååé‡å˜å¾—å¾ˆä½ï¼Œç‰¹åˆ«æ˜¯æ¶ˆè´¹è€…è¿æ¥å»¶è¿Ÿå¾ˆä¸¥é‡çš„æƒ…å†µä¸‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶ˆè´¹è€…è¿æ¥ç­‰å¾…æ—¶é—´è¾ƒé•¿çš„ç¯å¢ƒ ä¸­ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œç¨å¾®é«˜ä¸€ç‚¹çš„å€¼å°†æ˜¯æœ€ä½³çš„ã€‚</p><p><strong>æ¶ˆè´¹è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//è®¾ç½®é¢„å–å€¼ä¸º5</span>
<span class="token keyword">int</span> prefetchCount <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span>prefetchCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ã€å‘å¸ƒç¡®è®¤" tabindex="-1"><a class="header-anchor" href="#_4ã€å‘å¸ƒç¡®è®¤"><span><strong>4ã€å‘å¸ƒç¡®è®¤</strong></span></a></h3><h4 id="_4-1-å‘å¸ƒç¡®è®¤åŸç†" tabindex="-1"><a class="header-anchor" href="#_4-1-å‘å¸ƒç¡®è®¤åŸç†"><span><strong>4.1. å‘å¸ƒç¡®è®¤åŸç†</strong></span></a></h4><figure><a href="https://imgse.com/i/pCpwlq0" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/03/pCpwlq0.jpg" alt="pCpwlq0.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpwlq0.jpg</figcaption></figure><p>ç”Ÿäº§è€…å°†ä¿¡é“è®¾ç½®æˆ confirm æ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥ confirm æ¨¡å¼ï¼Œ<strong>æ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„ æ¶ˆæ¯éƒ½å°†ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„ ID</strong>(ä» 1 å¼€å§‹)ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œbroker å°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™ç”Ÿäº§è€…(åŒ…å«æ¶ˆæ¯çš„å”¯ä¸€ ID)ï¼Œè¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿ åˆ—äº†ï¼Œå¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šåœ¨å°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºï¼Œbroker å›ä¼  ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­ delivery-tag åŸŸåŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºåˆ—å·ï¼Œæ­¤å¤– broker ä¹Ÿå¯ä»¥è®¾ç½® basic.ack çš„ multiple åŸŸï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»å¾—åˆ°äº†å¤„ç†ã€‚</p><p>confirm æ¨¡å¼æœ€å¤§çš„å¥½å¤„åœ¨äºä»–æ˜¯å¼‚æ­¥çš„ï¼Œä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡ é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒ æ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœ RabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack æ¶ˆ æ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack æ¶ˆæ¯ã€‚</p><h4 id="_4-2-å‘å¸ƒç¡®è®¤çš„ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#_4-2-å‘å¸ƒç¡®è®¤çš„ç­–ç•¥"><span><strong>4.2. å‘å¸ƒç¡®è®¤çš„ç­–ç•¥</strong></span></a></h4><h5 id="_4-2-1-å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_4-2-1-å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•"><span><strong>4.2.1. å¼€å¯å‘å¸ƒç¡®è®¤çš„æ–¹æ³•</strong></span></a></h5><p>å‘å¸ƒç¡®è®¤é»˜è®¤æ˜¯æ²¡æœ‰å¼€å¯çš„ï¼Œå¦‚æœè¦å¼€å¯éœ€è¦è°ƒç”¨æ–¹æ³• confirmSelectï¼Œæ¯å½“ä½ è¦æƒ³ä½¿ç”¨å‘å¸ƒ ç¡®è®¤ï¼Œéƒ½éœ€è¦åœ¨ channel ä¸Šè°ƒç”¨è¯¥æ–¹æ³•</p><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//å¼€å¯å•ä¸ªç¡®è®¤å‘å¸ƒæ¨¡å¼</span>
channel<span class="token punctuation">.</span><span class="token function">confirmSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-2-å•ä¸ªç¡®è®¤å‘å¸ƒ-è€—æ—¶100296ms" tabindex="-1"><a class="header-anchor" href="#_4-2-2-å•ä¸ªç¡®è®¤å‘å¸ƒ-è€—æ—¶100296ms"><span><strong>4.2.2. å•ä¸ªç¡®è®¤å‘å¸ƒ</strong>ï¼ˆè€—æ—¶100296msï¼‰</span></a></h5><p>è¿™æ˜¯ä¸€ç§ç®€å•çš„ç¡®è®¤æ–¹å¼ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åŒæ­¥ç¡®è®¤å‘å¸ƒ</strong>çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ä¹‹ååªæœ‰å®ƒ è¢«ç¡®è®¤å‘å¸ƒï¼Œåç»­çš„æ¶ˆæ¯æ‰èƒ½ç»§ç»­å‘å¸ƒ,waitForConfirmsOrDie(long)è¿™ä¸ªæ–¹æ³•åªæœ‰åœ¨æ¶ˆæ¯è¢«ç¡®è®¤ çš„æ—¶å€™æ‰è¿”å›ï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…è¿™ä¸ªæ¶ˆæ¯æ²¡æœ‰è¢«ç¡®è®¤é‚£ä¹ˆå®ƒå°†æŠ›å‡ºå¼‚å¸¸ã€‚</p><p>è¿™ç§ç¡®è®¤æ–¹å¼æœ‰ä¸€ä¸ªæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯:<strong>å‘å¸ƒé€Ÿåº¦ç‰¹åˆ«çš„æ…¢</strong>ï¼Œå› ä¸ºå¦‚æœæ²¡æœ‰ç¡®è®¤å‘å¸ƒçš„æ¶ˆæ¯å°±ä¼š é˜»å¡æ‰€æœ‰åç»­æ¶ˆæ¯çš„å‘å¸ƒï¼Œè¿™ç§æ–¹å¼æœ€å¤šæä¾›æ¯ç§’ä¸è¶…è¿‡æ•°ç™¾æ¡å‘å¸ƒæ¶ˆæ¯çš„ååé‡ã€‚å½“ç„¶å¯¹äºæŸ äº›åº”ç”¨ç¨‹åºæ¥è¯´è¿™å¯èƒ½å·²ç»è¶³å¤Ÿäº†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* å•ä¸ªç¡®è®¤
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">publishMessageSingle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é˜Ÿåˆ—åç§°ï¼Œä½¿ç”¨UUIDéšæœºç”Ÿæˆ</span>
        <span class="token class-name">String</span> queue_name <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜é˜Ÿåˆ—</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue_name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¼€å¯å•ä¸ªç¡®è®¤å‘å¸ƒæ¨¡å¼</span>
        channel<span class="token punctuation">.</span><span class="token function">confirmSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¡æ—¶</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‰¹é‡å‘å¸ƒæ¶ˆæ¯ï¼š1000æ¡æ¶ˆæ¯ å•ä¸ªç¡®è®¤å‘å¸ƒæ¶ˆæ¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">MESSAGE_COUNT</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">//å‘å¸ƒæ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>queue_name<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å•ä¸ªæ¶ˆæ¯å°±é©¬ä¸Šå°±è¡Œå‘å¸ƒç¡®è®¤</span>
            <span class="token keyword">boolean</span> flag <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">waitForConfirms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘å¸ƒæˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç»“æŸæ—¶é—´</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å•ä¸ªç¡®è®¤å‘å¸ƒ&quot;</span> <span class="token operator">+</span> <span class="token constant">MESSAGE_COUNT</span> <span class="token operator">+</span> <span class="token string">&quot;æ¶ˆæ¯ï¼Œè€—æ—¶ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-3-æ‰¹é‡ç¡®è®¤å‘å¸ƒ-285ms" tabindex="-1"><a class="header-anchor" href="#_4-2-3-æ‰¹é‡ç¡®è®¤å‘å¸ƒ-285ms"><span><strong>4.2.3. æ‰¹é‡ç¡®è®¤å‘</strong>å¸ƒï¼ˆ285msï¼‰</span></a></h5><p>ä¸Šé¢é‚£ç§æ–¹å¼éå¸¸æ…¢ï¼Œä¸å•ä¸ªç­‰å¾…ç¡®è®¤æ¶ˆæ¯ç›¸æ¯”ï¼Œå…ˆå‘å¸ƒä¸€æ‰¹æ¶ˆæ¯ç„¶åä¸€èµ·ç¡®è®¤å¯ä»¥æå¤§åœ° æé«˜ååé‡ï¼Œå½“ç„¶è¿™ç§æ–¹å¼çš„ç¼ºç‚¹å°±æ˜¯:å½“å‘ç”Ÿæ•…éšœå¯¼è‡´å‘å¸ƒå‡ºç°é—®é¢˜æ—¶ï¼Œä¸çŸ¥é“æ˜¯å“ªä¸ªæ¶ˆæ¯å‡ºç° é—®é¢˜äº†ï¼Œæˆ‘ä»¬å¿…é¡»å°†æ•´ä¸ªæ‰¹å¤„ç†ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥è®°å½•é‡è¦çš„ä¿¡æ¯è€Œåé‡æ–°å‘å¸ƒæ¶ˆæ¯ã€‚å½“ç„¶è¿™ç§ æ–¹æ¡ˆä»ç„¶æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿä¸€æ ·é˜»å¡æ¶ˆæ¯çš„å‘å¸ƒã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* æ‰¹é‡ç¡®è®¤
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">publishMessageBatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é˜Ÿåˆ—åç§°ï¼Œä½¿ç”¨UUIDéšæœºç”Ÿæˆ</span>
        <span class="token class-name">String</span> queue_name <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜é˜Ÿåˆ—</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue_name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¼€å¯æ‰¹é‡ç¡®è®¤å‘å¸ƒæ¨¡å¼</span>
        channel<span class="token punctuation">.</span><span class="token function">confirmSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‰¹é‡ç¡®è®¤æ¶ˆæ¯å¤§å°</span>
        <span class="token keyword">int</span> batchSize <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token comment">//å¼€å§‹æ—¶é—´</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‰¹é‡å‘å¸ƒæ¶ˆæ¯ï¼š1000æ¡æ¶ˆæ¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token constant">MESSAGE_COUNT</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">//å‘å¸ƒæ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>queue_name<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//æ¯å‘100æ¡æ¶ˆæ¯å°±é©¬ä¸Šå°±è¡Œå‘å¸ƒç¡®è®¤</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> batchSize <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯å‘å¸ƒæˆåŠŸï¼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç»“æŸæ—¶é—´</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ‰¹é‡ç¡®è®¤å‘å¸ƒ&quot;</span> <span class="token operator">+</span> <span class="token constant">MESSAGE_COUNT</span> <span class="token operator">+</span> <span class="token string">&quot;æ¶ˆæ¯ï¼Œè€—æ—¶ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-4-å¼‚æ­¥ç¡®è®¤å‘å¸ƒ" tabindex="-1"><a class="header-anchor" href="#_4-2-4-å¼‚æ­¥ç¡®è®¤å‘å¸ƒ"><span><strong>4.2.4. å¼‚æ­¥ç¡®è®¤å‘å¸ƒ</strong></span></a></h5><p>å¼‚æ­¥ç¡®è®¤è™½ç„¶ç¼–ç¨‹é€»è¾‘æ¯”ä¸Šä¸¤ä¸ªè¦å¤æ‚ï¼Œä½†æ˜¯æ€§ä»·æ¯”æœ€é«˜ï¼Œæ— è®ºæ˜¯å¯é æ€§è¿˜æ˜¯æ•ˆç‡éƒ½æ²¡å¾—è¯´ï¼Œ ä»–æ˜¯åˆ©ç”¨å›è°ƒå‡½æ•°æ¥è¾¾åˆ°æ¶ˆæ¯å¯é æ€§ä¼ é€’çš„ï¼Œè¿™ä¸ªä¸­é—´ä»¶ä¹Ÿæ˜¯é€šè¿‡å‡½æ•°å›è°ƒæ¥ä¿è¯æ˜¯å¦æŠ•é€’æˆåŠŸï¼Œ ä¸‹é¢å°±è®©æˆ‘ä»¬æ¥è¯¦ç»†è®²è§£å¼‚æ­¥ç¡®è®¤æ˜¯æ€ä¹ˆå®ç°çš„ã€‚</p><figure><a href="https://imgse.com/i/pCpysot" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/03/pCpysot.jpg" alt="pCpysot.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpysot.jpg</figcaption></figure><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* å¼‚æ­¥æ‰¹é‡ç¡®è®¤
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">publishMessageAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é˜Ÿåˆ—åç§°ï¼Œä½¿ç”¨UUIDéšæœºç”Ÿæˆ</span>
        <span class="token class-name">String</span> queue_name <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜é˜Ÿåˆ—</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue_name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¼€å¯å•ä¸ªç¡®è®¤å‘å¸ƒæ¨¡å¼</span>
        channel<span class="token punctuation">.</span><span class="token function">confirmSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¡æ—¶</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¶ˆæ¯ç¡®è®¤æˆåŠŸæ¥å£å›è°ƒå‡½æ•°</span>
        <span class="token class-name">ConfirmCallback</span> ackCallback <span class="token operator">=</span> <span class="token punctuation">(</span>deliveryTay<span class="token punctuation">,</span>multiple<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯ç¡®è®¤æˆåŠŸçš„ç¼–å·ï¼š&quot;</span> <span class="token operator">+</span> deliveryTay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**æ¶ˆæ¯ç¡®è®¤å¤±è´¥æ¥å£å›è°ƒå‡½æ•°
         * 1ã€æ¶ˆæ¯ç¡®è®¤æ ‡è®°
         * 2ã€æ˜¯å¦æ˜¯æ‰¹é‡ç¡®è®¤
         */</span>
        <span class="token class-name">ConfirmCallback</span> nckCallback <span class="token operator">=</span> <span class="token punctuation">(</span>deliveryTay<span class="token punctuation">,</span>multiple<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯ç¡®è®¤å¤±è´¥çš„ç¼–å·ï¼š&quot;</span> <span class="token operator">+</span> deliveryTay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**å‡†å¤‡æ¶ˆæ¯çš„ç›‘å¬å™¨ï¼Œç›‘å¬å“ªäº›æ¶ˆæ¯ç¡®è®¤æˆåŠŸäº†ï¼Œå“ªäº›æ¶ˆæ¯ç¡®è®¤å¤±è´¥äº†
         * 1ã€ç›‘å¬å“ªäº›æ¶ˆæ¯ç¡®è®¤æˆåŠŸ
         * 2ã€ç›‘å¬å“ªäº›æ¶ˆæ¯ç¡®è®¤å¤±è´¥
         * å¼‚æ­¥é€šçŸ¥
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">addConfirmListener</span><span class="token punctuation">(</span>ackCallback<span class="token punctuation">,</span>nckCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ‰¹é‡å‘å¸ƒæ¶ˆæ¯ï¼š1000æ¡æ¶ˆæ¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">MESSAGE_COUNT</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token comment">//å‘å¸ƒæ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>queue_name<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç»“æŸæ—¶é—´</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥æ‰¹é‡ç¡®è®¤å‘å¸ƒ&quot;</span> <span class="token operator">+</span> <span class="token constant">MESSAGE_COUNT</span> <span class="token operator">+</span> <span class="token string">&quot;æ¶ˆæ¯ï¼Œè€—æ—¶ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-5-å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_4-2-5-å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯"><span><strong>4.2.5. å¦‚ä½•å¤„ç†å¼‚æ­¥æœªç¡®è®¤æ¶ˆæ¯</strong></span></a></h5><p>æœ€å¥½çš„è§£å†³çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠæœªç¡®è®¤çš„æ¶ˆæ¯æ”¾åˆ°ä¸€ä¸ªåŸºäºå†…å­˜çš„èƒ½è¢«å‘å¸ƒçº¿ç¨‹è®¿é—®çš„é˜Ÿåˆ—ï¼Œ æ¯”å¦‚è¯´ç”¨ ConcurrentSkipListMap è¿™ä¸ªé˜Ÿåˆ—åœ¨ confirm callbacks ä¸å‘å¸ƒçº¿ç¨‹ä¹‹é—´è¿›è¡Œæ¶ˆæ¯çš„ä¼  é€’ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
* å¼‚æ­¥æ‰¹é‡ç¡®è®¤
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">publishMessageAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//é˜Ÿåˆ—åç§°ï¼Œä½¿ç”¨UUIDéšæœºç”Ÿæˆ</span>
        <span class="token class-name">String</span> queue_name <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜é˜Ÿåˆ—</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queue_name<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å¼€å¯å•ä¸ªç¡®è®¤å‘å¸ƒæ¨¡å¼</span>
        channel<span class="token punctuation">.</span><span class="token function">confirmSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * çº¿ç¨‹å®‰å…¨æœ‰åºçš„ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œé€‚ç”¨äºé«˜å¹¶å‘çš„æƒ…å†µ
         * 1.è½»æ¾çš„å°†åºå·ä¸æ¶ˆæ¯è¿›è¡Œå…³è”
         * 2.è½»æ¾æ‰¹é‡åˆ é™¤æ¡ç›® åªè¦ç»™åˆ°åºåˆ—å·
         * 3.æ”¯æŒå¹¶å‘è®¿é—®
         */</span>
        <span class="token class-name">ConcurrentSkipListMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> outstandingConfirms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentSkipListMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//æ¶ˆæ¯ç¡®è®¤æˆåŠŸæ¥å£å›è°ƒå‡½æ•°</span>
        <span class="token class-name">ConfirmCallback</span> ackCallback <span class="token operator">=</span> <span class="token punctuation">(</span>deliveryTay<span class="token punctuation">,</span>multiple<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>multiple<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//è¿”å›çš„æ˜¯å°äºç­‰äºå½“å‰åºåˆ—å·çš„æœªç¡®è®¤æ¶ˆæ¯ æ˜¯ä¸€ä¸ª map</span>
                <span class="token class-name">ConcurrentNavigableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> confirmed <span class="token operator">=</span>
                        outstandingConfirms<span class="token punctuation">.</span><span class="token function">headMap</span><span class="token punctuation">(</span>deliveryTay<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//æ¸…é™¤è¯¥éƒ¨åˆ†æœªç¡®è®¤æ¶ˆæ¯</span>
                confirmed<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">//åªæ¸…é™¤å½“å‰åºåˆ—å·çš„æ¶ˆæ¯</span>
                outstandingConfirms<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>deliveryTay<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**æ¶ˆæ¯ç¡®è®¤å¤±è´¥æ¥å£å›è°ƒå‡½æ•°
         * 1ã€æ¶ˆæ¯ç¡®è®¤æ ‡è®°
         * 2ã€æ˜¯å¦æ˜¯æ‰¹é‡ç¡®è®¤
         */</span>
        <span class="token class-name">ConfirmCallback</span> nckCallback <span class="token operator">=</span> <span class="token punctuation">(</span>deliveryTay<span class="token punctuation">,</span>multiple<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> outstandingConfirms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>deliveryTay<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘å¸ƒçš„æ¶ˆæ¯&quot;</span><span class="token operator">+</span>message<span class="token operator">+</span><span class="token string">&quot;æœªè¢«ç¡®è®¤ï¼Œåºåˆ—å·&quot;</span><span class="token operator">+</span>deliveryTay<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**å‡†å¤‡æ¶ˆæ¯çš„ç›‘å¬å™¨ï¼Œç›‘å¬å“ªäº›æ¶ˆæ¯ç¡®è®¤æˆåŠŸäº†ï¼Œå“ªäº›æ¶ˆæ¯ç¡®è®¤å¤±è´¥äº†
         * 1ã€ç›‘å¬å“ªäº›æ¶ˆæ¯ç¡®è®¤æˆåŠŸ
         * 2ã€ç›‘å¬å“ªäº›æ¶ˆæ¯ç¡®è®¤å¤±è´¥
         * å¼‚æ­¥é€šçŸ¥
         */</span>
        channel<span class="token punctuation">.</span><span class="token function">addConfirmListener</span><span class="token punctuation">(</span>ackCallback<span class="token punctuation">,</span>nckCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//è®¡æ—¶</span>
        <span class="token keyword">long</span> begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ‰¹é‡å‘å¸ƒæ¶ˆæ¯ï¼š1000æ¡æ¶ˆæ¯</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token constant">MESSAGE_COUNT</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token doc-comment comment">/**
             * channel.getNextPublishSeqNo()è·å–ä¸‹ä¸€ä¸ªæ¶ˆæ¯çš„åºåˆ—å·
             * é€šè¿‡åºåˆ—å·ä¸æ¶ˆæ¯ä½“è¿›è¡Œä¸€ä¸ªå…³è”
             * å…¨éƒ¨éƒ½æ˜¯æœªç¡®è®¤çš„æ¶ˆæ¯ä½“
             */</span>
            outstandingConfirms<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">getNextPublishSeqNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å‘å¸ƒæ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>queue_name<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//ç»“æŸæ—¶é—´</span>
        <span class="token keyword">long</span> end <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥æ‰¹é‡ç¡®è®¤å‘å¸ƒ&quot;</span> <span class="token operator">+</span> <span class="token constant">MESSAGE_COUNT</span> <span class="token operator">+</span> <span class="token string">&quot;æ¶ˆæ¯ï¼Œè€—æ—¶ï¼š&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>end <span class="token operator">-</span> begin<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token string">&quot;ms&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-6-ä»¥ä¸Š-3-ç§å‘å¸ƒç¡®è®¤é€Ÿåº¦å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_4-2-6-ä»¥ä¸Š-3-ç§å‘å¸ƒç¡®è®¤é€Ÿåº¦å¯¹æ¯”"><span><strong>4.2.6. ä»¥ä¸Š 3 ç§å‘å¸ƒç¡®è®¤é€Ÿåº¦å¯¹æ¯”</strong></span></a></h5><p><strong>å•ç‹¬å‘å¸ƒæ¶ˆæ¯</strong></p><ul><li>åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œä½†ååé‡éå¸¸æœ‰é™ã€‚</li></ul><p><strong>æ‰¹é‡å‘å¸ƒæ¶ˆæ¯</strong></p><ul><li>æ‰¹é‡åŒæ­¥ç­‰å¾…ç¡®è®¤ï¼Œç®€å•ï¼Œåˆç†çš„ååé‡ï¼Œä¸€æ—¦å‡ºç°é—®é¢˜ä½†å¾ˆéš¾æ¨æ–­å‡ºæ˜¯é‚£æ¡æ¶ˆæ¯å‡ºç°äº†é—®é¢˜ã€‚</li></ul><p><strong>å¼‚æ­¥å¤„ç†ï¼š</strong></p><ul><li>æœ€ä½³æ€§èƒ½å’Œèµ„æºä½¿ç”¨ï¼Œåœ¨å‡ºç°é”™è¯¯çš„æƒ…å†µä¸‹å¯ä»¥å¾ˆå¥½åœ°æ§åˆ¶ï¼Œä½†æ˜¯å®ç°èµ·æ¥ç¨å¾®éš¾äº›</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å‘å¸ƒç¡®è®¤æ¨¡å¼
 *    ä½¿ç”¨çš„æ—¶é—´ï¼Œæ¯”è¾ƒå“ªç§ç¡®è®¤æ–¹å¼æ˜¯æœ€å¥½çš„
 *       1ã€å•ä¸ªç¡®è®¤       è€—æ—¶100296ms
 *       2ã€æ‰¹é‡ç¡®è®¤       è€—æ—¶285ms
 *       3ã€å¼‚æ­¥æ‰¹é‡ç¡®è®¤    è€—æ—¶238ms
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5ã€äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_5ã€äº¤æ¢æœº"><span><strong>5ã€äº¤æ¢æœº</strong></span></a></h3><figure><img src="https://pic.imgdb.cn/item/647ad3abf024cca173b620be.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå·¥ä½œé˜Ÿåˆ—ã€‚æˆ‘ä»¬å‡è®¾çš„æ˜¯å·¥ä½œé˜Ÿåˆ—èƒŒåï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ°å¥½äº¤ä»˜ç»™ä¸€ä¸ªæ¶ˆ è´¹è€…(å·¥ä½œè¿›ç¨‹)ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†åšä¸€äº›å®Œå…¨ä¸åŒçš„äº‹æƒ…-æˆ‘ä»¬å°†æ¶ˆæ¯ä¼ è¾¾ç»™å¤šä¸ªæ¶ˆè´¹è€…ã€‚è¿™ç§æ¨¡å¼ ç§°ä¸º â€å‘å¸ƒ/è®¢é˜…â€. ä¸ºäº†è¯´æ˜è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—ç³»ç»Ÿã€‚å®ƒå°†ç”±ä¸¤ä¸ªç¨‹åºç»„æˆ:ç¬¬ä¸€ä¸ªç¨‹åºå°†å‘å‡ºæ—¥å¿—æ¶ˆ æ¯ï¼Œç¬¬äºŒä¸ªç¨‹åºæ˜¯æ¶ˆè´¹è€…ã€‚å…¶ä¸­æˆ‘ä»¬ä¼šå¯åŠ¨ä¸¤ä¸ªæ¶ˆè´¹è€…ï¼Œå…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæŠŠæ—¥å¿—å­˜å‚¨åœ¨ç£ç›˜ï¼Œ</p><p>å¦å¤–ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åæŠŠæ¶ˆæ¯æ‰“å°åœ¨å±å¹•ä¸Šï¼Œäº‹å®ä¸Šç¬¬ä¸€ä¸ªç¨‹åºå‘å‡ºçš„æ—¥å¿—æ¶ˆæ¯å°†å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹ è€…è€…</p><h4 id="_5-1-exchanges" tabindex="-1"><a class="header-anchor" href="#_5-1-exchanges"><span><strong>5.1. Exchanges</strong></span></a></h4><h5 id="_5-1-1-exchanges-æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_5-1-1-exchanges-æ¦‚å¿µ"><span><strong>5.1.1. Exchanges æ¦‚å¿µ</strong></span></a></h5><p>RabbitMQ æ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯: <strong>ç”Ÿäº§è€…ç”Ÿäº§çš„æ¶ˆæ¯ä»ä¸ä¼šç›´æ¥å‘é€åˆ°é˜Ÿåˆ—</strong>ã€‚å®é™…ä¸Šï¼Œé€šå¸¸ç”Ÿäº§ è€…ç”šè‡³éƒ½ä¸çŸ¥é“è¿™äº›æ¶ˆæ¯ä¼ é€’ä¼ é€’åˆ°äº†å“ªäº›é˜Ÿåˆ—ä¸­ã€‚</p><p>ç›¸åï¼Œ<strong>ç”Ÿäº§è€…åªèƒ½å°†æ¶ˆæ¯å‘é€åˆ°äº¤æ¢æœº(exchange)</strong>ï¼Œäº¤æ¢æœºå·¥ä½œçš„å†…å®¹éå¸¸ç®€å•ï¼Œä¸€æ–¹é¢å®ƒæ¥æ”¶æ¥ è‡ªç”Ÿäº§è€…çš„æ¶ˆæ¯ï¼Œå¦ä¸€æ–¹é¢å°†å®ƒä»¬æ¨å…¥é˜Ÿåˆ—ã€‚äº¤æ¢æœºå¿…é¡»ç¡®åˆ‡çŸ¥é“å¦‚ä½•å¤„ç†æ”¶åˆ°çš„æ¶ˆæ¯ã€‚æ˜¯åº”è¯¥æŠŠè¿™äº›æ¶ˆ æ¯æ”¾åˆ°ç‰¹å®šé˜Ÿåˆ—è¿˜æ˜¯è¯´æŠŠä»–ä»¬åˆ°è®¸å¤šé˜Ÿåˆ—ä¸­è¿˜æ˜¯è¯´åº”è¯¥ä¸¢å¼ƒå®ƒä»¬ã€‚è¿™å°±çš„ç”±äº¤æ¢æœºçš„ç±»å‹æ¥å†³å®šã€‚</p><figure><a href="https://imgse.com/i/pCpcrPP" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/03/pCpcrPP.jpg" alt="pCpcrPP.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCpcrPP.jpg</figcaption></figure><h5 id="_5-1-2-exchanges-çš„ç±»å‹" tabindex="-1"><a class="header-anchor" href="#_5-1-2-exchanges-çš„ç±»å‹"><span><strong>5.1.2. Exchanges çš„ç±»å‹</strong></span></a></h5><p>æ€»å…±æœ‰ä»¥ä¸‹ç±»å‹ï¼š</p><p><strong>ç›´æ¥(direct), ä¸»é¢˜(topic) ,æ ‡é¢˜(headers) , æ‰‡å‡º(fanout)</strong></p><h5 id="_5-1-3-æ— å-exchange" tabindex="-1"><a class="header-anchor" href="#_5-1-3-æ— å-exchange"><span><strong>5.1.3. æ— å exchange</strong></span></a></h5><p>åœ¨æœ¬æ•™ç¨‹çš„å‰é¢éƒ¨åˆ†æˆ‘ä»¬å¯¹ exchange ä¸€æ— æ‰€çŸ¥ï¼Œä½†ä»ç„¶èƒ½å¤Ÿå°†æ¶ˆæ¯å‘é€åˆ°é˜Ÿåˆ—ã€‚ä¹‹å‰èƒ½å®ç°çš„ åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯é»˜è®¤äº¤æ¢ï¼Œæˆ‘ä»¬é€šè¿‡ç©ºå­—ç¬¦ä¸²(â€œâ€)è¿›è¡Œæ ‡è¯†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//å‘å¸ƒæ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>queue_name<span class="token punctuation">,</span><span class="token keyword">null</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº¤æ¢æœºçš„åç§°ã€‚ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºé»˜è®¤æˆ–æ— åç§°äº¤æ¢æœºï¼šæ¶ˆæ¯èƒ½è·¯ç”±å‘é€åˆ°é˜Ÿåˆ—ä¸­å…¶å® æ˜¯ç”± routingKey(bindingkey)ç»‘å®š key æŒ‡å®šçš„ï¼Œå¦‚æœå®ƒå­˜åœ¨çš„è¯</p><h4 id="_5-2-ä¸´æ—¶é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_5-2-ä¸´æ—¶é˜Ÿåˆ—"><span><strong>5.2. ä¸´æ—¶é˜Ÿåˆ—</strong></span></a></h4><p>ä¹‹å‰çš„ç« èŠ‚æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å…·æœ‰ç‰¹å®šåç§°çš„é˜Ÿåˆ—(è¿˜è®°å¾— hello å’Œ ack_queue å—ï¼Ÿ)ã€‚é˜Ÿåˆ—çš„åç§°æˆ‘ä»¬ æ¥è¯´è‡³å…³é‡è¦-æˆ‘ä»¬éœ€è¦æŒ‡å®šæˆ‘ä»¬çš„æ¶ˆè´¹è€…å»æ¶ˆè´¹å“ªä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ã€‚</p><p>æ¯å½“æˆ‘ä»¬è¿æ¥åˆ° Rabbit æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€ä¸ªå…¨æ–°çš„ç©ºé˜Ÿåˆ—ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå…·æœ‰<strong>éšæœºåç§° çš„é˜Ÿåˆ—</strong>ï¼Œæˆ–è€…èƒ½è®©æœåŠ¡å™¨ä¸ºæˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªéšæœºé˜Ÿåˆ—åç§°é‚£å°±æ›´å¥½äº†ã€‚å…¶æ¬¡<strong>ä¸€æ—¦æˆ‘ä»¬æ–­å¼€äº†æ¶ˆè´¹è€…çš„è¿ æ¥ï¼Œé˜Ÿåˆ—å°†è¢«è‡ªåŠ¨åˆ é™¤ã€‚</strong></p><p><strong>åˆ›å»ºä¸´æ—¶é˜Ÿåˆ—çš„æ–¹å¼å¦‚ä¸‹:</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>åˆ›å»ºå‡ºæ¥ä¹‹åé•¿æˆè¿™æ ·:</strong></p><figure><img src="https://pic.imgdb.cn/item/647ad543f024cca173b7b63d.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_5-3-ç»‘å®š-bindings" tabindex="-1"><a class="header-anchor" href="#_5-3-ç»‘å®š-bindings"><span><strong>5.3. ç»‘å®š(bindings)</strong></span></a></h4><p>ä»€ä¹ˆæ˜¯ bingding å‘¢ï¼Œbinding å…¶å®æ˜¯ exchange å’Œ queue ä¹‹é—´çš„æ¡¥æ¢ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬ exchange å’Œé‚£ä¸ªé˜Ÿ åˆ—è¿›è¡Œäº†ç»‘å®šå…³ç³»ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™å¼ å›¾å‘Šè¯‰æˆ‘ä»¬çš„å°±æ˜¯ X ä¸ Q1 å’Œ Q2 è¿›è¡Œäº†ç»‘å®š</p><figure><img src="https://pic.imgdb.cn/item/647ad56ef024cca173b7dd3c.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_5-4-fanoutäº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_5-4-fanoutäº¤æ¢æœº"><span><strong>5.4. Fanout</strong>äº¤æ¢æœº</span></a></h4><h5 id="_5-4-1-fanout-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_5-4-1-fanout-ä»‹ç»"><span><strong>5.4.1. Fanout ä»‹ç»</strong></span></a></h5><p>Fanout è¿™ç§ç±»å‹éå¸¸ç®€å•ã€‚æ­£å¦‚ä»åç§°ä¸­çŒœåˆ°çš„é‚£æ ·ï¼Œå®ƒæ˜¯å°†æ¥æ”¶åˆ°çš„æ‰€æœ‰æ¶ˆæ¯å¹¿æ’­åˆ°å®ƒçŸ¥é“çš„ æ‰€æœ‰é˜Ÿåˆ—ä¸­ã€‚ç³»ç»Ÿä¸­é»˜è®¤æœ‰äº› exchange ç±»å‹</p><figure><img src="https://pic.imgdb.cn/item/647ad6cff024cca173b91d3f.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_5-4-2-fanout-å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_5-4-2-fanout-å®æˆ˜"><span><strong>5.4.2. Fanout å®æˆ˜</strong></span></a></h5><figure><img src="https://pic.imgdb.cn/item/647ad6cff024cca173b91d0c.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Logs å’Œä¸´æ—¶é˜Ÿåˆ—çš„ç»‘å®šå…³ç³»å¦‚ä¸‹å›¾</p><figure><img src="https://pic.imgdb.cn/item/647ad6cff024cca173b91d1c.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ReceiveLogs01 å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨æ§åˆ¶å°</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯æ¥æ”¶è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveLogs02</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„é˜Ÿåˆ— é˜Ÿåˆ—çš„åç§°æ˜¯éšæœºçš„
         * å½“æ¶ˆè´¹è€…æ–­å¼€å’Œè¯¥é˜Ÿåˆ—çš„è¿æ¥æ—¶ é˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤
         */</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æŠŠè¯¥ä¸´æ—¶é˜Ÿåˆ—ç»‘å®šæˆ‘ä»¬çš„ exchange å…¶ä¸­ routingkey(ä¹Ÿç§°ä¹‹ä¸º binding key)ä¸ºç©ºå­—ç¬¦ä¸²</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯,æŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨å±å¹•.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ§åˆ¶å°æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ReceiveLogs02 å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯å­˜å‚¨åœ¨ç£ç›˜</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯æ¥æ”¶è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveLogs02</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„é˜Ÿåˆ— é˜Ÿåˆ—çš„åç§°æ˜¯éšæœºçš„
         * å½“æ¶ˆè´¹è€…æ–­å¼€å’Œè¯¥é˜Ÿåˆ—çš„è¿æ¥æ—¶ é˜Ÿåˆ—è‡ªåŠ¨åˆ é™¤
         */</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æŠŠè¯¥ä¸´æ—¶é˜Ÿåˆ—ç»‘å®šæˆ‘ä»¬çš„ exchange å…¶ä¸­ routingkey(ä¹Ÿç§°ä¹‹ä¸º binding key)ä¸ºç©ºå­—ç¬¦ä¸²</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯,æŠŠæ¥æ”¶åˆ°çš„æ¶ˆæ¯æ‰“å°åœ¨å±å¹•.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ§åˆ¶å°æ‰“å°æ¥æ”¶åˆ°çš„æ¶ˆæ¯&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>EmitLog å‘é€æ¶ˆæ¯ç»™ä¸¤ä¸ªæ¶ˆè´¹è€…æ¥æ”¶</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å‘é€æ¶ˆæ¯è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmitLog</span> <span class="token punctuation">{</span>
    <span class="token comment">//å£°æ˜äº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;logs&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token doc-comment comment">/**
             * å£°æ˜ä¸€ä¸ª exchange
             * 1.exchange çš„åç§°
             * 2.exchange çš„ç±»å‹
             */</span>
            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;fanout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Scanner</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯·è¾“å…¥ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> message <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-5-direct-äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_5-5-direct-äº¤æ¢æœº"><span><strong>5.5. Direct äº¤æ¢æœº</strong></span></a></h4><h5 id="_5-5-1-å›é¡¾" tabindex="-1"><a class="header-anchor" href="#_5-5-1-å›é¡¾"><span><strong>5.5.1. å›é¡¾</strong></span></a></h5><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªç®€å•çš„æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚æˆ‘ä»¬èƒ½å¤Ÿå‘è®¸å¤šæ¥æ”¶è€…å¹¿æ’­æ—¥å¿—æ¶ˆæ¯ã€‚åœ¨æœ¬ èŠ‚æˆ‘ä»¬å°†å‘å…¶ä¸­æ·»åŠ ä¸€äº›ç‰¹åˆ«çš„åŠŸèƒ½-æ¯”æ–¹è¯´æˆ‘ä»¬åªè®©æŸä¸ªæ¶ˆè´¹è€…è®¢é˜…å‘å¸ƒçš„éƒ¨åˆ†æ¶ˆæ¯ã€‚ä¾‹å¦‚æˆ‘ä»¬åªæŠŠ ä¸¥é‡é”™è¯¯æ¶ˆæ¯å®šå‘å­˜å‚¨åˆ°æ—¥å¿—æ–‡ä»¶(ä»¥èŠ‚çœç£ç›˜ç©ºé—´)ï¼ŒåŒæ—¶ä»ç„¶èƒ½å¤Ÿåœ¨æ§åˆ¶å°ä¸Šæ‰“å°æ‰€æœ‰æ—¥å¿—æ¶ˆæ¯ã€‚</p><p>æˆ‘ä»¬å†æ¬¡æ¥å›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯ bindingsï¼Œç»‘å®šæ˜¯äº¤æ¢æœºå’Œé˜Ÿåˆ—ä¹‹é—´çš„æ¡¥æ¢å…³ç³»ã€‚ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼š <strong>é˜Ÿåˆ—åªå¯¹å®ƒç»‘å®šçš„äº¤æ¢æœºçš„æ¶ˆæ¯æ„Ÿå…´è¶£</strong>ã€‚ç»‘å®šç”¨å‚æ•°ï¼šroutingKey æ¥è¡¨ç¤ºä¹Ÿå¯ç§°è¯¥å‚æ•°ä¸º binding keyï¼Œ åˆ›å»ºç»‘å®šæˆ‘ä»¬ç”¨ä»£ç :channel.queueBind(queueName, EXCHANGE_NAME, &quot;routingKey&quot;);<strong>ç»‘å®šä¹‹åçš„ æ„ä¹‰ç”±å…¶äº¤æ¢ç±»å‹å†³å®šã€‚</strong></p><h5 id="_5-5-2-direct-exchange-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#_5-5-2-direct-exchange-ä»‹ç»"><span><strong>5.5.2. Direct exchange ä»‹ç»</strong></span></a></h5><p>ä¸Šä¸€èŠ‚ä¸­çš„æˆ‘ä»¬çš„æ—¥å¿—ç³»ç»Ÿå°†æ‰€æœ‰æ¶ˆæ¯å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œå¯¹æ­¤æˆ‘ä»¬æƒ³åšä¸€äº›æ”¹å˜ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸Œ æœ›å°†æ—¥å¿—æ¶ˆæ¯å†™å…¥ç£ç›˜çš„ç¨‹åºä»…æ¥æ”¶ä¸¥é‡é”™è¯¯(errros)ï¼Œè€Œä¸å­˜å‚¨å“ªäº›è­¦å‘Š(warning)æˆ–ä¿¡æ¯(info)æ—¥å¿— æ¶ˆæ¯é¿å…æµªè´¹ç£ç›˜ç©ºé—´ã€‚Fanout è¿™ç§äº¤æ¢ç±»å‹å¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¾ˆå¤§çš„çµæ´»æ€§-å®ƒåªèƒ½è¿›è¡Œæ— æ„è¯†çš„ å¹¿æ’­ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ direct è¿™ç§ç±»å‹æ¥è¿›è¡Œæ›¿æ¢ï¼Œè¿™ç§ç±»å‹çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œæ¶ˆæ¯åªå»åˆ°å®ƒç»‘å®šçš„ routingKey é˜Ÿåˆ—ä¸­å»ã€‚</p><figure><img src="https://pic.imgdb.cn/item/647adf8af024cca173c2aaad.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>åœ¨ä¸Šé¢è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° X ç»‘å®šäº†ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œç»‘å®šç±»å‹æ˜¯ directã€‚é˜Ÿåˆ— Q1 ç»‘å®šé”®ä¸º orangeï¼Œ é˜Ÿåˆ— Q2 ç»‘å®šé”®æœ‰ä¸¤ä¸ª:ä¸€ä¸ªç»‘å®šé”®ä¸º blackï¼Œå¦ä¸€ä¸ªç»‘å®šé”®ä¸º green.</p><p>åœ¨è¿™ç§ç»‘å®šæƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…å‘å¸ƒæ¶ˆæ¯åˆ° exchange ä¸Šï¼Œç»‘å®šé”®ä¸º orange çš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ— Q1ã€‚ç»‘å®šé”®ä¸º blackgreen å’Œçš„æ¶ˆæ¯ä¼šè¢«å‘å¸ƒåˆ°é˜Ÿåˆ— Q2ï¼Œå…¶ä»–æ¶ˆæ¯ç±»å‹çš„æ¶ˆæ¯å°†è¢«ä¸¢å¼ƒã€‚</p><h5 id="_5-5-3-å¤šé‡ç»‘å®š" tabindex="-1"><a class="header-anchor" href="#_5-5-3-å¤šé‡ç»‘å®š"><span><strong>5.5.3. å¤šé‡ç»‘å®š</strong></span></a></h5><figure><img src="https://pic.imgdb.cn/item/647adfb5f024cca173c2e98e.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å½“ç„¶å¦‚æœ exchange çš„ç»‘å®šç±»å‹æ˜¯ directï¼Œ<strong>ä½†æ˜¯å®ƒç»‘å®šçš„å¤šä¸ªé˜Ÿåˆ—çš„ key å¦‚æœéƒ½ç›¸åŒ</strong>ï¼Œåœ¨è¿™ç§æƒ… å†µä¸‹è™½ç„¶ç»‘å®šç±»å‹æ˜¯ direct <strong>ä½†æ˜¯å®ƒè¡¨ç°çš„å°±å’Œ fanout æœ‰ç‚¹ç±»ä¼¼äº†</strong>ï¼Œå°±è·Ÿå¹¿æ’­å·®ä¸å¤šï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p><h5 id="_5-5-4-å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_5-5-4-å®æˆ˜"><span><strong>5.5.4. å®æˆ˜</strong></span></a></h5><figure><img src="https://pic.imgdb.cn/item/647ae00af024cca173c34b17.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://pic.imgdb.cn/item/647ae00af024cca173c34b0b.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>æ¶ˆæ¯å‘é€è€…</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯å‘é€è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmitLogDirect</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;direct_logs&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//åˆ›å»ºå¤šä¸ª bindingKey</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bindingKeyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;info&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ™®é€š info ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;warning&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è­¦å‘Š warning ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;é”™è¯¯ error ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//debug æ²¡æœ‰æ¶ˆè´¹è¿™æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ æ‰€æœ‰å°±ä¸¢å¤±äº†</span>
            bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;debug&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è°ƒè¯• debug ä¿¡æ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bindingKeyEntry<span class="token operator">:</span> bindingKeyMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">String</span> bindingKey <span class="token operator">=</span> bindingKeyEntry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> message <span class="token operator">=</span> bindingKeyEntry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span>bindingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                        message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯:&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆæ¯æ¥æ”¶è€…</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯æ¥æ”¶è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveLogsDirect01</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;direct_logs&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;disk&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            message<span class="token operator">=</span><span class="token string">&quot;æ¥æ”¶ç»‘å®šé”®:&quot;</span><span class="token operator">+</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;,æ¶ˆæ¯:&quot;</span><span class="token operator">+</span>message<span class="token punctuation">;</span>
            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;D:\\RabbitMQèµ„æ–™\\work\\rabbitmq_info.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">writeStringToFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span>message<span class="token punctuation">,</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é”™è¯¯æ—¥å¿—å·²ç»æ¥æ”¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯æ¥æ”¶è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveLogsDirect02</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;direct_logs&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> queueName <span class="token operator">=</span> <span class="token string">&quot;console&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;warning&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; æ¥æ”¶ç»‘å®šé”® :&quot;</span><span class="token operator">+</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;, æ¶ˆæ¯:&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-6-topics" tabindex="-1"><a class="header-anchor" href="#_5-6-topics"><span><strong>5.6. Topics</strong></span></a></h4><h5 id="_5-6-1-ä¹‹å‰ç±»å‹çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_5-6-1-ä¹‹å‰ç±»å‹çš„é—®é¢˜"><span><strong>5.6.1. ä¹‹å‰ç±»å‹çš„é—®é¢˜</strong></span></a></h5><p>åœ¨ä¸Šä¸€ä¸ªå°èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ”¹è¿›äº†æ—¥å¿—è®°å½•ç³»ç»Ÿã€‚æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åªèƒ½è¿›è¡Œéšæ„å¹¿æ’­çš„ fanout äº¤æ¢æœºï¼Œè€Œæ˜¯ ä½¿ç”¨äº† direct äº¤æ¢æœºï¼Œä»è€Œæœ‰èƒ½å®ç°æœ‰é€‰æ‹©æ€§åœ°æ¥æ”¶æ—¥å¿—ã€‚</p><p>å°½ç®¡ä½¿ç”¨ direct äº¤æ¢æœºæ”¹è¿›äº†æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œä½†æ˜¯å®ƒä»ç„¶å­˜åœ¨å±€é™æ€§-æ¯”æ–¹è¯´æˆ‘ä»¬æƒ³æ¥æ”¶çš„æ—¥å¿—ç±»å‹æœ‰ info.base å’Œ info.advantageï¼ŒæŸä¸ªé˜Ÿåˆ—åªæƒ³ info.base çš„æ¶ˆæ¯ï¼Œé‚£è¿™ä¸ªæ—¶å€™ direct å°±åŠä¸åˆ°äº†ã€‚è¿™ä¸ªæ—¶å€™ å°±åªèƒ½ä½¿ç”¨ topic ç±»å‹</p><h5 id="_5-6-2-topic-çš„è¦æ±‚" tabindex="-1"><a class="header-anchor" href="#_5-6-2-topic-çš„è¦æ±‚"><span><strong>5.6.2. Topic çš„è¦æ±‚</strong></span></a></h5><p>å‘é€åˆ°ç±»å‹æ˜¯ topic äº¤æ¢æœºçš„æ¶ˆæ¯çš„ routing_key ä¸èƒ½éšæ„å†™ï¼Œå¿…é¡»æ»¡è¶³ä¸€å®šçš„è¦æ±‚ï¼Œ**å®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå• è¯åˆ—è¡¨ï¼Œä»¥ç‚¹å·åˆ†éš”å¼€ã€‚**è¿™äº›å•è¯å¯ä»¥æ˜¯ä»»æ„å•è¯ï¼Œæ¯”å¦‚è¯´ï¼š&quot;stock.usd.nyse&quot;, &quot;nyse.vmw&quot;, &quot;quick.orange.rabbit&quot;.è¿™ç§ç±»å‹çš„ã€‚å½“ç„¶è¿™ä¸ªå•è¯åˆ—è¡¨æœ€å¤šä¸èƒ½è¶…è¿‡ 255 ä¸ªå­—èŠ‚ã€‚</p><p><strong>åœ¨è¿™ä¸ªè§„åˆ™åˆ—è¡¨ä¸­ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ›¿æ¢ç¬¦æ˜¯å¤§å®¶éœ€è¦æ³¨æ„çš„</strong></p><blockquote><p>*<strong>(æ˜Ÿå·)å¯ä»¥ä»£æ›¿ä¸€ä¸ªå•è¯</strong></p><p><strong>#(äº•å·)å¯ä»¥æ›¿ä»£é›¶ä¸ªæˆ–å¤šä¸ªå•è¯</strong></p></blockquote><h5 id="_5-6-3-topic-åŒ¹é…æ¡ˆä¾‹" tabindex="-1"><a class="header-anchor" href="#_5-6-3-topic-åŒ¹é…æ¡ˆä¾‹"><span><strong>5.6.3. Topic åŒ¹é…æ¡ˆä¾‹</strong></span></a></h5><p>ä¸‹å›¾ç»‘å®šå…³ç³»å¦‚ä¸‹</p><p>Q1--&gt;ç»‘å®šçš„æ˜¯</p><ul><li>ä¸­é—´å¸¦ orange å¸¦ 3 ä¸ªå•è¯çš„å­—ç¬¦ä¸²(<em>.orange.</em>)</li></ul><p>Q2--&gt;ç»‘å®šçš„æ˜¯</p><ul><li><p>æœ€åä¸€ä¸ªå•è¯æ˜¯ rabbit çš„ 3 ä¸ªå•è¯(<em>.</em>.rabbit)</p></li><li><p>ç¬¬ä¸€ä¸ªå•è¯æ˜¯ lazy çš„å¤šä¸ªå•è¯(lazy.#)</p></li></ul><figure><img src="https://pic.imgdb.cn/item/647ae45ff024cca173c90a16.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä¸Šå›¾æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šå…³ç³»å›¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä»–ä»¬ä¹‹é—´æ•°æ®æ¥æ”¶æƒ…å†µæ˜¯æ€ä¹ˆæ ·çš„</p><p>quick.orange.rabbit è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ° lazy.orange.elephant è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°</p><p>quick.orange.fox è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°</p><p>lazy.brown.fox è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°</p><p>lazy.pink.rabbit è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡</p><p>quick.brown.fox ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ</p><p>quick.orange.male.rabbit æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ</p><p>lazy.orange.male.rabbit æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2</p><p><strong>å½“é˜Ÿåˆ—ç»‘å®šå…³ç³»æ˜¯ä¸‹åˆ—è¿™ç§æƒ…å†µæ—¶éœ€è¦å¼•èµ·æ³¨æ„</strong></p><blockquote><p><strong>å½“ä¸€ä¸ªé˜Ÿåˆ—ç»‘å®šé”®æ˜¯#,é‚£ä¹ˆè¿™ä¸ªé˜Ÿåˆ—å°†æ¥æ”¶æ‰€æœ‰æ•°æ®ï¼Œå°±æœ‰ç‚¹åƒ fanout äº† å¦‚æœé˜Ÿåˆ—ç»‘å®šé”®å½“ä¸­æ²¡æœ‰#å’Œ*å‡ºç°ï¼Œé‚£ä¹ˆè¯¥é˜Ÿåˆ—ç»‘å®šç±»å‹å°±æ˜¯ direct äº†</strong></p></blockquote><h5 id="_5-6-4-å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_5-6-4-å®æˆ˜"><span><strong>5.6.4. å®æˆ˜</strong></span></a></h5><figure><img src="https://pic.imgdb.cn/item/647ae45ff024cca173c90a31.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>æ¶ˆè´¹è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯æ¥æ”¶è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveLogsTopic01</span> <span class="token punctuation">{</span>
    <span class="token comment">//äº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;topic_logs&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜ Q1 é˜Ÿåˆ—ä¸ç»‘å®šå…³ç³»</span>
        <span class="token class-name">String</span> queueName<span class="token operator">=</span><span class="token string">&quot;Q1&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;*.orange.*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; æ¥æ”¶é˜Ÿåˆ— :&quot;</span><span class="token operator">+</span>queueName<span class="token operator">+</span><span class="token string">&quot; ç»‘å®šé”®:&quot;</span><span class="token operator">+</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;,æ¶ˆæ¯:&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯æ¥æ”¶è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveLogsTopic02</span> <span class="token punctuation">{</span>
    <span class="token comment">//äº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;topic_logs&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜ Q2 é˜Ÿåˆ—ä¸ç»‘å®šå…³ç³»</span>
        <span class="token class-name">String</span> queueName<span class="token operator">=</span><span class="token string">&quot;Q2&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;*.*.rabbit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;lazy.#&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; æ¥æ”¶é˜Ÿåˆ— :&quot;</span><span class="token operator">+</span>queueName<span class="token operator">+</span><span class="token string">&quot; ç»‘å®šé”®:&quot;</span><span class="token operator">+</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRoutingKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;,æ¶ˆæ¯:&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ¶ˆæ¯å‘é€è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EmitLogTopic</span> <span class="token punctuation">{</span>
    <span class="token comment">//äº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;topic_logs&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>
        <span class="token comment">//è·å–ä¿¡é“</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜äº¤æ¢æœº</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span><span class="token string">&quot;topic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token doc-comment comment">/**
         * Q1--&gt;ç»‘å®šçš„æ˜¯
         * ä¸­é—´å¸¦ orange å¸¦ 3 ä¸ªå•è¯çš„å­—ç¬¦ä¸²(*.orange.*)
         * Q2--&gt;ç»‘å®šçš„æ˜¯
         * æœ€åä¸€ä¸ªå•è¯æ˜¯ rabbit çš„ 3 ä¸ªå•è¯(*.*.rabbit)
         * ç¬¬ä¸€ä¸ªå•è¯æ˜¯ lazy çš„å¤šä¸ªå•è¯(lazy.#)
         *
         */</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bindingKeyMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;quick.orange.rabbit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lazy.orange.elephant&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è¢«é˜Ÿåˆ— Q1Q2 æ¥æ”¶åˆ°&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;quick.orange.fox&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è¢«é˜Ÿåˆ— Q1 æ¥æ”¶åˆ°&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lazy.brown.fox&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è¢«é˜Ÿåˆ— Q2 æ¥æ”¶åˆ°&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lazy.pink.rabbit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;è™½ç„¶æ»¡è¶³ä¸¤ä¸ªç»‘å®šä½†åªè¢«é˜Ÿåˆ— Q2 æ¥æ”¶ä¸€æ¬¡&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;quick.brown.fox&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¸ä¼šè¢«ä»»ä½•é˜Ÿåˆ—æ¥æ”¶åˆ°ä¼šè¢«ä¸¢å¼ƒ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;quick.orange.male.rabbit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ˜¯å››ä¸ªå•è¯ä¸åŒ¹é…ä»»ä½•ç»‘å®šä¼šè¢«ä¸¢å¼ƒ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingKeyMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;lazy.orange.male.rabbit&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;æ˜¯å››ä¸ªå•è¯ä½†åŒ¹é… Q2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//éå†å–å€¼</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> bindingRoutingKey <span class="token operator">:</span> bindingKeyMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> routingKey <span class="token operator">=</span> bindingRoutingKey<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> bindingRoutingKey<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//å‘å¸ƒæ¶ˆæ¯</span>
            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">EXCHANGE_NAME</span><span class="token punctuation">,</span>routingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                    message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘å‡ºæ¶ˆæ¯&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6ã€æ­»ä¿¡é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_6ã€æ­»ä¿¡é˜Ÿåˆ—"><span><strong>6ã€æ­»ä¿¡é˜Ÿåˆ—</strong></span></a></h3><h4 id="_6-1-æ­»ä¿¡çš„æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_6-1-æ­»ä¿¡çš„æ¦‚å¿µ"><span><strong>6.1. æ­»ä¿¡çš„æ¦‚å¿µ</strong></span></a></h4><p>å…ˆä»æ¦‚å¿µè§£é‡Šä¸Šææ¸…æ¥šè¿™ä¸ªå®šä¹‰ï¼Œæ­»ä¿¡ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œå­—é¢æ„æ€å¯ä»¥è¿™æ ·ç† è§£ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œproducer å°†æ¶ˆæ¯æŠ•é€’åˆ° broker æˆ–è€…ç›´æ¥åˆ° queue é‡Œäº†ï¼Œconsumer ä» queue å–å‡ºæ¶ˆæ¯ è¿›è¡Œæ¶ˆè´¹ï¼Œä½†æŸäº›æ—¶å€™ç”±äºç‰¹å®šçš„**åŸå› å¯¼è‡´ queue ä¸­çš„æŸäº›æ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹ï¼Œ**è¿™æ ·çš„æ¶ˆæ¯å¦‚æœæ²¡æœ‰ åç»­çš„å¤„ç†ï¼Œå°±å˜æˆäº†æ­»ä¿¡ï¼Œæœ‰æ­»ä¿¡è‡ªç„¶å°±æœ‰äº†æ­»ä¿¡é˜Ÿåˆ—ã€‚</p><p>åº”ç”¨åœºæ™¯:ä¸ºäº†ä¿è¯è®¢å•ä¸šåŠ¡çš„æ¶ˆæ¯æ•°æ®ä¸ä¸¢å¤±ï¼Œéœ€è¦ä½¿ç”¨åˆ° RabbitMQ çš„æ­»ä¿¡é˜Ÿåˆ—æœºåˆ¶ï¼Œå½“æ¶ˆæ¯ æ¶ˆè´¹å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°†æ¶ˆæ¯æŠ•å…¥æ­»ä¿¡é˜Ÿåˆ—ä¸­.è¿˜æœ‰æ¯”å¦‚è¯´: ç”¨æˆ·åœ¨å•†åŸä¸‹å•æˆåŠŸå¹¶ç‚¹å‡»å»æ”¯ä»˜ååœ¨æŒ‡å®šæ—¶ é—´æœªæ”¯ä»˜æ—¶è‡ªåŠ¨å¤±</p><h4 id="_6-2-æ­»ä¿¡çš„æ¥æº" tabindex="-1"><a class="header-anchor" href="#_6-2-æ­»ä¿¡çš„æ¥æº"><span><strong>6.2. æ­»ä¿¡çš„æ¥æº</strong></span></a></h4><ul><li><p>æ¶ˆæ¯ TTL è¿‡æœŸ</p></li><li><p>é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦(é˜Ÿåˆ—æ»¡äº†ï¼Œæ— æ³•å†æ·»åŠ æ•°æ®åˆ° mq ä¸­)</p></li><li><p>æ¶ˆæ¯è¢«æ‹’ç»(basic.reject æˆ– basic.nack)å¹¶ä¸” requeue=false.</p></li></ul><h4 id="_6-3-æ­»ä¿¡å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_6-3-æ­»ä¿¡å®æˆ˜"><span><strong>6.3. æ­»ä¿¡å®æˆ˜</strong></span></a></h4><h5 id="_6-3-1-ä»£ç æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_6-3-1-ä»£ç æ¶æ„å›¾"><span><strong>6.3.1. ä»£ç æ¶æ„å›¾</strong></span></a></h5><figure><a href="https://imgse.com/i/pC9chkR" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9chkR.jpg" alt="pC9chkR.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9chkR.jpg</figcaption></figure><h5 id="_6-3-2-æ¶ˆæ¯-ttl-è¿‡æœŸ" tabindex="-1"><a class="header-anchor" href="#_6-3-2-æ¶ˆæ¯-ttl-è¿‡æœŸ"><span>**6.3.2. æ¶ˆæ¯ TTL è¿‡æœŸ **</span></a></h5><p><strong>æ¶ˆè´¹è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ­»ä¿¡é˜Ÿåˆ—
 * æ¶ˆè´¹è€…1
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer01</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ™®é€šäº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NORMAL_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;normal_exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEAD_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;dead_exchange&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœº ç±»å‹ä¸º direct</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span>
        <span class="token class-name">String</span> deadQueue <span class="token operator">=</span> <span class="token string">&quot;dead-queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸ routingkey</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span> <span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡ routing-key å‚æ•° key æ˜¯å›ºå®šå€¼</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> normalQueue <span class="token operator">=</span> <span class="token string">&quot;normal-queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆè´¹è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ­»ä¿¡é˜Ÿåˆ— ä¹‹ æ¶ˆè´¹è€…2
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer02</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEAD_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;dead_exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> deadQueue <span class="token operator">=</span> <span class="token string">&quot;dead-queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer02 æ¥æ”¶æ­»ä¿¡é˜Ÿåˆ—çš„æ¶ˆæ¯&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ­»ä¿¡é˜Ÿåˆ— ä¹‹ ç”Ÿäº§è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ™®é€šäº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NORMAL_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;normal_exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è®¾ç½®æ¶ˆæ¯çš„ TTL æ—¶é—´</span>
            <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span>
                    <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expiration</span><span class="token punctuation">(</span><span class="token string">&quot;10000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è¯¥ä¿¡æ¯æ˜¯ç”¨ä½œæ¼”ç¤ºé˜Ÿåˆ—ä¸ªæ•°é™åˆ¶</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">11</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> message<span class="token operator">=</span><span class="token string">&quot;info&quot;</span><span class="token operator">+</span>i<span class="token punctuation">;</span>
                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> properties<span class="token punctuation">,</span>
                        message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯:&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><a href="https://imgse.com/i/pC9gS9P" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9gS9P.jpg" alt="pC9gS9P.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9gS9P.jpg</figcaption></figure><figure><a href="https://imgse.com/i/pC9gp1f" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9gp1f.jpg" alt="pC9gp1f.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9gp1f.jpg</figcaption></figure><h5 id="_6-3-3-é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦" tabindex="-1"><a class="header-anchor" href="#_6-3-3-é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦"><span><strong>6.3.3. é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦</strong></span></a></h5><ol><li>æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç å»æ‰ TTL å±æ€§</li></ol><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ­»ä¿¡é˜Ÿåˆ— ä¹‹ ç”Ÿäº§è€…
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ™®é€šäº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NORMAL_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;normal_exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//è®¾ç½®æ¶ˆæ¯çš„ TTL æ—¶é—´</span>
<span class="token comment">//            AMQP.BasicProperties properties = new</span>
<span class="token comment">//                    AMQP.BasicProperties().builder().expiration(&quot;10000&quot;).build();</span>
            <span class="token comment">//è¯¥ä¿¡æ¯æ˜¯ç”¨ä½œæ¼”ç¤ºé˜Ÿåˆ—ä¸ªæ•°é™åˆ¶</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">11</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> message<span class="token operator">=</span><span class="token string">&quot;info&quot;</span><span class="token operator">+</span>i<span class="token punctuation">;</span>
                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                        message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç”Ÿäº§è€…å‘é€æ¶ˆæ¯:&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>C1 æ¶ˆè´¹è€…ä¿®æ”¹ä»¥ä¸‹ä»£ç (å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯)</li></ol><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ­»ä¿¡é˜Ÿåˆ—
 * æ¶ˆè´¹è€…1
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer01</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ™®é€šäº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NORMAL_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;normal_exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEAD_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;dead_exchange&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœº ç±»å‹ä¸º direct</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span>
        <span class="token class-name">String</span> deadQueue <span class="token operator">=</span> <span class="token string">&quot;dead-queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸ routingkey</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span> <span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡ routing-key å‚æ•° key æ˜¯å›ºå®šå€¼</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®æ­£å¸¸é˜Ÿåˆ—é•¿åº¦çš„é™åˆ¶</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-max-length&quot;</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> normalQueue <span class="token operator">=</span> <span class="token string">&quot;normal-queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ³¨æ„æ­¤æ—¶éœ€è¦æŠŠåŸå…ˆé˜Ÿåˆ—åˆ é™¤ å› ä¸ºå‚æ•°æ”¹å˜äº†</strong></p><p><strong>3ã€C2 æ¶ˆè´¹è€…ä»£ç ä¸å˜(å¯åŠ¨ C2 æ¶ˆè´¹è€…)</strong></p><figure><a href="https://imgse.com/i/pC9gQuF" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9gQuF.jpg" alt="pC9gQuF.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9gQuF.jpg</figcaption></figure><h5 id="_6-3-4-æ¶ˆæ¯è¢«æ‹’" tabindex="-1"><a class="header-anchor" href="#_6-3-4-æ¶ˆæ¯è¢«æ‹’"><span><strong>6.3.4. æ¶ˆæ¯è¢«æ‹’</strong></span></a></h5><p>1.æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç åŒä¸Šç”Ÿäº§è€…ä¸€è‡´</p><p>2.C1 æ¶ˆè´¹è€…ä»£ç (å¯åŠ¨ä¹‹åå…³é—­è¯¥æ¶ˆè´¹è€… æ¨¡æ‹Ÿå…¶æ¥æ”¶ä¸åˆ°æ¶ˆæ¯)</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ­»ä¿¡é˜Ÿåˆ—
 * æ¶ˆè´¹è€…1
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer01</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ™®é€šäº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">NORMAL_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;normal_exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEAD_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;dead_exchange&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">ConnectionUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜æ­»ä¿¡å’Œæ™®é€šäº¤æ¢æœº ç±»å‹ä¸º direct</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span><span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span><span class="token constant">DIRECT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ—</span>
        <span class="token class-name">String</span> deadQueue <span class="token operator">=</span> <span class="token string">&quot;dead-queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­»ä¿¡é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡äº¤æ¢æœºä¸ routingkey</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>deadQueue<span class="token punctuation">,</span> <span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœº å‚æ•° key æ˜¯å›ºå®šå€¼</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span> <span class="token constant">DEAD_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ­£å¸¸é˜Ÿåˆ—è®¾ç½®æ­»ä¿¡ routing-key å‚æ•° key æ˜¯å›ºå®šå€¼</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lisi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è®¾ç½®æ­£å¸¸é˜Ÿåˆ—é•¿åº¦çš„é™åˆ¶</span>
        <span class="token comment">//params.put(&quot;x-max-length&quot;,6);</span>
        <span class="token class-name">String</span> normalQueue <span class="token operator">=</span> <span class="token string">&quot;normal-queue&quot;</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> <span class="token constant">NORMAL_EXCHANGE</span><span class="token punctuation">,</span> <span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç­‰å¾…æ¥æ”¶æ¶ˆæ¯.....&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;UTF-8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;info5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">&quot;å¹¶æ‹’ç»ç­¾æ”¶è¯¥æ¶ˆæ¯&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//requeue è®¾ç½®ä¸º false ä»£è¡¨æ‹’ç»é‡æ–°å…¥é˜Ÿ è¯¥é˜Ÿåˆ—å¦‚æœé…ç½®äº†æ­»ä¿¡äº¤æ¢æœºå°†å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­</span>
                channel<span class="token punctuation">.</span><span class="token function">basicReject</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Consumer01 æ¥æ”¶åˆ°æ¶ˆæ¯&quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
                channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> autoAck <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>normalQueue<span class="token punctuation">,</span> autoAck<span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><a href="https://imgse.com/i/pC9goUs" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9goUs.jpg" alt="pC9goUs.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9goUs.jpg</figcaption></figure><ol start="3"><li>C2 æ¶ˆè´¹è€…ä»£ç ä¸å˜</li></ol><p><strong>å¯åŠ¨æ¶ˆè´¹è€… 1 ç„¶åå†å¯åŠ¨æ¶ˆè´¹è€… 2</strong></p><figure><a href="https://imgse.com/i/pC9gT5n" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9gT5n.jpg" alt="pC9gT5n.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9gT5n.jpg</figcaption></figure><h3 id="_7ã€å»¶è¿Ÿé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_7ã€å»¶è¿Ÿé˜Ÿåˆ—"><span><strong>7ã€å»¶è¿Ÿé˜Ÿåˆ—</strong></span></a></h3><h4 id="_7-1-å»¶è¿Ÿé˜Ÿåˆ—æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_7-1-å»¶è¿Ÿé˜Ÿåˆ—æ¦‚å¿µ"><span><strong>7.1. å»¶è¿Ÿé˜Ÿåˆ—æ¦‚å¿µ</strong></span></a></h4><p>å»¶æ—¶é˜Ÿåˆ—,é˜Ÿåˆ—å†…éƒ¨æ˜¯æœ‰åºçš„ï¼Œæœ€é‡è¦çš„ç‰¹æ€§å°±ä½“ç°åœ¨å®ƒçš„å»¶æ—¶å±æ€§ä¸Šï¼Œå»¶æ—¶é˜Ÿåˆ—ä¸­çš„å…ƒç´ æ˜¯å¸Œæœ› åœ¨æŒ‡å®šæ—¶é—´åˆ°äº†ä»¥åæˆ–ä¹‹å‰å–å‡ºå’Œå¤„ç†ï¼Œç®€å•æ¥è¯´ï¼Œå»¶æ—¶é˜Ÿåˆ—å°±æ˜¯ç”¨æ¥å­˜æ”¾éœ€è¦åœ¨æŒ‡å®šæ—¶é—´è¢«å¤„ç†çš„ å…ƒç´ çš„é˜Ÿåˆ—ã€‚</p><h4 id="_7-2-å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_7-2-å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯"><span><strong>7.2. å»¶è¿Ÿé˜Ÿåˆ—ä½¿ç”¨åœºæ™¯</strong></span></a></h4><ul><li><p>1.è®¢å•åœ¨ååˆ†é’Ÿä¹‹å†…æœªæ”¯ä»˜åˆ™è‡ªåŠ¨å–æ¶ˆ</p></li><li><p>2.æ–°åˆ›å»ºçš„åº—é“ºï¼Œå¦‚æœåœ¨åå¤©å†…éƒ½æ²¡æœ‰ä¸Šä¼ è¿‡å•†å“ï¼Œåˆ™è‡ªåŠ¨å‘é€æ¶ˆæ¯æé†’ã€‚</p></li><li><p>3.ç”¨æˆ·æ³¨å†ŒæˆåŠŸåï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰ç™»é™†åˆ™è¿›è¡ŒçŸ­ä¿¡æé†’ã€‚</p></li><li><p>4.ç”¨æˆ·å‘èµ·é€€æ¬¾ï¼Œå¦‚æœä¸‰å¤©å†…æ²¡æœ‰å¾—åˆ°å¤„ç†åˆ™é€šçŸ¥ç›¸å…³è¿è¥äººå‘˜ã€‚</p></li><li><p>5.é¢„å®šä¼šè®®åï¼Œéœ€è¦åœ¨é¢„å®šçš„æ—¶é—´ç‚¹å‰ååˆ†é’Ÿé€šçŸ¥å„ä¸ªä¸ä¼šäººå‘˜å‚åŠ ä¼šè®®</p></li></ul><p>è¿™äº›åœºæ™¯éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œéœ€è¦åœ¨æŸä¸ªäº‹ä»¶å‘ç”Ÿä¹‹åæˆ–è€…ä¹‹å‰çš„æŒ‡å®šæ—¶é—´ç‚¹å®ŒæˆæŸä¸€é¡¹ä»»åŠ¡ï¼Œå¦‚ï¼š å‘ç”Ÿè®¢å•ç”Ÿæˆäº‹ä»¶ï¼Œåœ¨ååˆ†é’Ÿä¹‹åæ£€æŸ¥è¯¥è®¢å•æ”¯ä»˜çŠ¶æ€ï¼Œç„¶åå°†æœªæ”¯ä»˜çš„è®¢å•è¿›è¡Œå…³é—­ï¼›çœ‹èµ·æ¥ä¼¼ä¹ ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œä¸€ç›´è½®è¯¢æ•°æ®ï¼Œæ¯ç§’æŸ¥ä¸€æ¬¡ï¼Œå–å‡ºéœ€è¦è¢«å¤„ç†çš„æ•°æ®ï¼Œç„¶åå¤„ç†ä¸å°±å®Œäº‹äº†å—ï¼Ÿå¦‚æœ æ•°æ®é‡æ¯”è¾ƒå°‘ï¼Œç¡®å®å¯ä»¥è¿™æ ·åšï¼Œæ¯”å¦‚ï¼šå¯¹äºâ€œå¦‚æœè´¦å•ä¸€å‘¨å†…æœªæ”¯ä»˜åˆ™è¿›è¡Œè‡ªåŠ¨ç»“ç®—â€è¿™æ ·çš„éœ€æ±‚ï¼Œ å¦‚æœå¯¹äºæ—¶é—´ä¸æ˜¯ä¸¥æ ¼é™åˆ¶ï¼Œè€Œæ˜¯å®½æ¾æ„ä¹‰ä¸Šçš„ä¸€å‘¨ï¼Œé‚£ä¹ˆæ¯å¤©æ™šä¸Šè·‘ä¸ªå®šæ—¶ä»»åŠ¡æ£€æŸ¥ä¸€ä¸‹æ‰€æœ‰æœªæ”¯ ä»˜çš„è´¦å•ï¼Œç¡®å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆã€‚ä½†å¯¹äºæ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œå¹¶ä¸”æ—¶æ•ˆæ€§è¾ƒå¼ºçš„åœºæ™¯ï¼Œå¦‚ï¼šâ€œè®¢å•å åˆ†é’Ÿå†…æœªæ”¯ä»˜åˆ™å…³é—­â€œï¼ŒçŸ­æœŸå†…æœªæ”¯ä»˜çš„è®¢å•æ•°æ®å¯èƒ½ä¼šæœ‰å¾ˆå¤šï¼Œæ´»åŠ¨æœŸé—´ç”šè‡³ä¼šè¾¾åˆ°ç™¾ä¸‡ç”šè‡³åƒä¸‡ çº§åˆ«ï¼Œå¯¹è¿™ä¹ˆåºå¤§çš„æ•°æ®é‡ä»æ—§ä½¿ç”¨è½®è¯¢çš„æ–¹å¼æ˜¾ç„¶æ˜¯ä¸å¯å–çš„ï¼Œå¾ˆå¯èƒ½åœ¨ä¸€ç§’å†…æ— æ³•å®Œæˆæ‰€æœ‰è®¢å• çš„æ£€æŸ¥ï¼ŒåŒæ—¶ä¼šç»™æ•°æ®åº“å¸¦æ¥å¾ˆå¤§å‹åŠ›ï¼Œæ— æ³•æ»¡è¶³ä¸šåŠ¡è¦æ±‚è€Œä¸”æ€§èƒ½ä½ä¸‹ã€‚</p><figure><a href="https://imgse.com/i/pC9gjrF" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9gjrF.jpg" alt="pC9gjrF.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9gjrF.jpg</figcaption></figure><h4 id="_7-3-rabbitmq-ä¸­çš„-ttl" tabindex="-1"><a class="header-anchor" href="#_7-3-rabbitmq-ä¸­çš„-ttl"><span><strong>7.3. RabbitMQ ä¸­çš„ TTL</strong></span></a></h4><p>TTL æ˜¯ä»€ä¹ˆå‘¢ï¼ŸTTL æ˜¯ RabbitMQ ä¸­ä¸€ä¸ªæ¶ˆæ¯æˆ–è€…é˜Ÿåˆ—çš„å±æ€§ï¼Œè¡¨æ˜ä¸€æ¡æ¶ˆæ¯æˆ–è€…è¯¥é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ æ¶ˆæ¯çš„æœ€å¤§å­˜æ´»æ—¶é—´ï¼Œ</p><p>å•ä½æ˜¯æ¯«ç§’ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯è®¾ç½®äº† TTL å±æ€§æˆ–è€…è¿›å…¥äº†è®¾ç½® TTL å±æ€§çš„é˜Ÿåˆ—ï¼Œé‚£ä¹ˆè¿™ æ¡æ¶ˆæ¯å¦‚æœåœ¨ TTL è®¾ç½®çš„æ—¶é—´å†…æ²¡æœ‰è¢«æ¶ˆè´¹ï¼Œåˆ™ä¼šæˆä¸º&quot;æ­»ä¿¡&quot;ã€‚å¦‚æœåŒæ—¶é…ç½®äº†é˜Ÿåˆ—çš„ TTL å’Œæ¶ˆæ¯çš„ TTLï¼Œé‚£ä¹ˆè¾ƒå°çš„é‚£ä¸ªå€¼å°†ä¼šè¢«ä½¿ç”¨ï¼Œæœ‰ä¸¤ç§æ–¹å¼è®¾ç½® TTLã€‚</p><h5 id="_7-3-1-æ¶ˆæ¯è®¾ç½®-ttl" tabindex="-1"><a class="header-anchor" href="#_7-3-1-æ¶ˆæ¯è®¾ç½®-ttl"><span>**7.3.1. æ¶ˆæ¯è®¾ç½® TTL **</span></a></h5><p>å¦ä¸€ç§æ–¹å¼ä¾¿æ˜¯é’ˆå¯¹æ¯æ¡æ¶ˆæ¯è®¾ç½® TTL</p><figure><a href="https://imgse.com/i/pC9WcCR" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9WcCR.jpg" alt="pC9WcCR.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9WcCR.jpg</figcaption></figure><h5 id="_7-3-2-é˜Ÿåˆ—è®¾ç½®-ttl" tabindex="-1"><a class="header-anchor" href="#_7-3-2-é˜Ÿåˆ—è®¾ç½®-ttl"><span>**7.3.2. é˜Ÿåˆ—è®¾ç½® TTL **</span></a></h5><p>ç¬¬ä¸€ç§æ˜¯åœ¨åˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™è®¾ç½®é˜Ÿåˆ—çš„â€œx-message-ttlâ€å±æ€§</p><figure><a href="https://imgse.com/i/pC9WfKK" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9WfKK.jpg" alt="pC9WfKK.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9WfKK.jpg</figcaption></figure><h5 id="_7-3-3-ä¸¤è€…çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#_7-3-3-ä¸¤è€…çš„åŒºåˆ«"><span><strong>7.3.3. ä¸¤è€…çš„åŒºåˆ«</strong></span></a></h5><p>å¦‚æœè®¾ç½®äº†é˜Ÿåˆ—çš„ TTL å±æ€§ï¼Œé‚£ä¹ˆä¸€æ—¦æ¶ˆæ¯è¿‡æœŸï¼Œå°±ä¼šè¢«é˜Ÿåˆ—ä¸¢å¼ƒ(å¦‚æœé…ç½®äº†æ­»ä¿¡é˜Ÿåˆ—è¢«ä¸¢åˆ°æ­»ä¿¡é˜Ÿ åˆ—ä¸­)ï¼Œè€Œç¬¬äºŒç§æ–¹å¼ï¼Œæ¶ˆæ¯å³ä½¿è¿‡æœŸï¼Œä¹Ÿä¸ä¸€å®šä¼šè¢«é©¬ä¸Šä¸¢å¼ƒï¼Œå› ä¸º<strong>æ¶ˆæ¯æ˜¯å¦è¿‡æœŸæ˜¯åœ¨å³å°†æŠ•é€’åˆ°æ¶ˆè´¹è€… ä¹‹å‰åˆ¤å®šçš„</strong>ï¼Œå¦‚æœå½“å‰é˜Ÿåˆ—æœ‰ä¸¥é‡çš„æ¶ˆæ¯ç§¯å‹æƒ…å†µï¼Œåˆ™å·²è¿‡æœŸçš„æ¶ˆæ¯ä¹Ÿè®¸è¿˜èƒ½å­˜æ´»è¾ƒé•¿æ—¶é—´ï¼›å¦å¤–ï¼Œè¿˜éœ€ è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä¸è®¾ç½® TTLï¼Œè¡¨ç¤ºæ¶ˆæ¯æ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œå¦‚æœå°† TTL è®¾ç½®ä¸º 0ï¼Œåˆ™è¡¨ç¤ºé™¤éæ­¤æ—¶å¯ä»¥ ç›´æ¥æŠ•é€’è¯¥æ¶ˆæ¯åˆ°æ¶ˆè´¹è€…ï¼Œå¦åˆ™è¯¥æ¶ˆæ¯å°†ä¼šè¢«ä¸¢å¼ƒã€‚</p><p>å‰ä¸€å°èŠ‚æˆ‘ä»¬ä»‹ç»äº†æ­»ä¿¡é˜Ÿåˆ—ï¼Œåˆšåˆšåˆä»‹ç»äº† TTLï¼Œè‡³æ­¤åˆ©ç”¨ RabbitMQ å®ç°å»¶æ—¶é˜Ÿåˆ—çš„ä¸¤å¤§è¦ç´ å·² ç»é›†é½ï¼Œæ¥ä¸‹æ¥åªéœ€è¦å°†å®ƒä»¬è¿›è¡Œèåˆï¼Œå†åŠ å…¥ä¸€ç‚¹ç‚¹è°ƒå‘³æ–™ï¼Œå»¶æ—¶é˜Ÿåˆ—å°±å¯ä»¥æ–°é²œå‡ºç‚‰äº†ã€‚æƒ³æƒ³çœ‹ï¼Œå»¶ æ—¶é˜Ÿåˆ—ï¼Œä¸å°±æ˜¯æƒ³è¦æ¶ˆæ¯å»¶è¿Ÿå¤šä¹…è¢«å¤„ç†å—ï¼ŒTTL åˆ™åˆšå¥½èƒ½è®©æ¶ˆæ¯åœ¨å»¶è¿Ÿå¤šä¹…ä¹‹åæˆä¸ºæ­»ä¿¡ï¼Œå¦ä¸€æ–¹é¢ï¼Œ æˆä¸ºæ­»ä¿¡çš„æ¶ˆæ¯éƒ½ä¼šè¢«æŠ•é€’åˆ°æ­»ä¿¡é˜Ÿåˆ—é‡Œï¼Œè¿™æ ·åªéœ€è¦æ¶ˆè´¹è€…ä¸€ç›´æ¶ˆè´¹æ­»ä¿¡é˜Ÿåˆ—é‡Œçš„æ¶ˆæ¯å°±å®Œäº‹äº†ï¼Œå› ä¸º é‡Œé¢çš„æ¶ˆæ¯éƒ½æ˜¯å¸Œæœ›è¢«ç«‹å³å¤„ç†çš„æ¶ˆæ¯ã€‚</p><h4 id="_7-4-æ•´åˆ-springboot" tabindex="-1"><a class="header-anchor" href="#_7-4-æ•´åˆ-springboot"><span><strong>7.4. æ•´åˆ springboot</strong></span></a></h4><p><strong>7.4.1å¯¼å…¥ä¾èµ–</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token class-name">RabbitMQ</span> ä¾èµ–<span class="token operator">--</span><span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>amqp<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>web<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>alibaba<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>fastjson<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">1.2</span><span class="token number">.47</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>projectlombok<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>lombok<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>swagger<span class="token operator">--</span><span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>io<span class="token punctuation">.</span>springfox<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>springfox<span class="token operator">-</span>swagger2<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.9</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>io<span class="token punctuation">.</span>springfox<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>springfox<span class="token operator">-</span>swagger<span class="token operator">-</span>ui<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>version<span class="token punctuation">&gt;</span></span><span class="token number">2.9</span><span class="token number">.2</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token class-name">RabbitMQ</span> æµ‹è¯•ä¾èµ–<span class="token operator">--</span><span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
 <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>rabbit<span class="token operator">-</span>test<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
 <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>test<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7.4.2. ä¿®æ”¹é…ç½®æ–‡ä»¶</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 82.157.234.124
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7.4.3. æ·»åŠ  Swagger é…ç½®ç±»</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * swagger2é…ç½®ç±»
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableSwagger2</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Swagger2Config</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span><span class="token constant">SWAGGER_2</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">useDefaultResponseMessages</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">&quot;com.sixkey.controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">ApiInfo</span> <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;RabbitMQæ¥å£æ–‡æ¡£&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">&quot;v1.1.0&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">&quot;RabbitMQæ¥å£æ–‡æ¡£&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-5-é˜Ÿåˆ—-ttl" tabindex="-1"><a class="header-anchor" href="#_7-5-é˜Ÿåˆ—-ttl"><span><strong>7.5. é˜Ÿåˆ— TTL</strong></span></a></h4><h5 id="_7-5-1-ä»£ç æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_7-5-1-ä»£ç æ¶æ„å›¾"><span><strong>7.5.1. ä»£ç æ¶æ„å›¾</strong></span></a></h5><p>åˆ›å»ºä¸¤ä¸ªé˜Ÿåˆ— QA å’Œ QBï¼Œä¸¤è€…é˜Ÿåˆ— TTL åˆ†åˆ«è®¾ç½®ä¸º 10S å’Œ 40Sï¼Œç„¶ååœ¨åˆ›å»ºä¸€ä¸ªäº¤æ¢æœº X å’Œæ­»ä¿¡äº¤ æ¢æœº Yï¼Œå®ƒä»¬çš„ç±»å‹éƒ½æ˜¯ directï¼Œåˆ›å»ºä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ— QDï¼Œå®ƒä»¬çš„ç»‘å®šå…³ç³»å¦‚ä¸‹ï¼š</p><figure><a href="https://imgse.com/i/pC9fQR1" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9fQR1.jpg" alt="pC9fQR1.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9fQR1.jpg</figcaption></figure><h5 id="_7-5-2-é…ç½®æ–‡ä»¶ç±»ä»£ç " tabindex="-1"><a class="header-anchor" href="#_7-5-2-é…ç½®æ–‡ä»¶ç±»ä»£ç "><span>**7.5.2. é…ç½®æ–‡ä»¶ç±»ä»£ç  **</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * TTL é˜Ÿåˆ— é…ç½®ç±»
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TtlQueueConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ™®é€šäº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">X_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;X&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ™®é€šé˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_A</span> <span class="token operator">=</span> <span class="token string">&quot;QA&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ™®é€šé˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_B</span> <span class="token operator">=</span> <span class="token string">&quot;QB&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ­»ä¿¡äº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">Y_DEAD_LETTER_EXCHANGE</span> <span class="token operator">=</span> <span class="token string">&quot;Y&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//æ­»ä¿¡é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DEAD_LETTER_QUEUE</span> <span class="token operator">=</span> <span class="token string">&quot;QD&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// å£°æ˜æ™®é€šäº¤æ¢æœº xExchange</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;xExchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">xExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token constant">X_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å£°æ˜æ­»ä¿¡äº¤æ¢æœº xExchange</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;yExchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">yExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token constant">Y_DEAD_LETTER_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å£°æ˜æ™®é€šé˜Ÿåˆ— A ttl ä¸º 10s å¹¶ç»‘å®šåˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;queueA&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queueA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span> <span class="token constant">Y_DEAD_LETTER_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜é˜Ÿåˆ—çš„ TTL</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-message-ttl&quot;</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">QUEUE_A</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å£°æ˜é˜Ÿåˆ— A ç»‘å®š X äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">queueaBindingX</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;queueA&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queueA<span class="token punctuation">,</span>
                                  <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;xExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> xExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queueA<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>xExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;XA&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å£°æ˜æ™®é€šé˜Ÿåˆ— B ttl ä¸º 40s å¹¶ç»‘å®šåˆ°å¯¹åº”çš„æ­»ä¿¡äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;queueB&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queueB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span> <span class="token constant">Y_DEAD_LETTER_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜é˜Ÿåˆ—çš„ TTL</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-message-ttl&quot;</span><span class="token punctuation">,</span> <span class="token number">40000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">QUEUE_B</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å£°æ˜é˜Ÿåˆ— B ç»‘å®š X äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">queuebBindingX</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;queueB&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue1B<span class="token punctuation">,</span>
                                  <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;xExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> xExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue1B<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>xExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;XB&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ— QD</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;queueD&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queueD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token constant">DEAD_LETTER_QUEUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å£°æ˜æ­»ä¿¡é˜Ÿåˆ— QD ç»‘å®šå…³ç³»</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">deadLetterBindingQAD</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;queueD&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queueD<span class="token punctuation">,</span>
                                        <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;yExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> yExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queueD<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>yExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;YD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç”Ÿäº§è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sendMsg/{message}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰æ—¶é—´ï¼š{},å‘é€ä¸€æ¡ä¿¡æ¯ç»™ä¸¤ä¸ª TTL é˜Ÿåˆ—:{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;XA&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ¶ˆæ¯æ¥è‡ª ttl ä¸º 10S çš„é˜Ÿåˆ—: &quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;XB&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;æ¶ˆæ¯æ¥è‡ª ttl ä¸º 40S çš„é˜Ÿåˆ—: &quot;</span><span class="token operator">+</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ¶ˆè´¹è€…ç«¯</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å»¶è¿Ÿé˜Ÿåˆ—  æ¶ˆè´¹è€…
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeadLetterQueueConsumer</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token string">&quot;QD&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveD</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰æ—¶é—´ï¼š{},æ”¶åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¿¡æ¯{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>å‘èµ·ä¸€ä¸ªè¯·æ±‚ http://localhost:8080/ttl/sendMsg/å˜»å˜»å˜»</strong></p><figure><a href="https://imgse.com/i/pC94g8s" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC94g8s.jpg" alt="pC94g8s.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC94g8s.jpg</figcaption></figure><p>ç¬¬ä¸€æ¡æ¶ˆæ¯åœ¨ 10S åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œç„¶åè¢«æ¶ˆè´¹è€…æ¶ˆè´¹æ‰ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯åœ¨ 40S ä¹‹åå˜æˆäº†æ­»ä¿¡æ¶ˆæ¯ï¼Œ ç„¶åè¢«æ¶ˆè´¹æ‰ï¼Œè¿™æ ·ä¸€ä¸ªå»¶æ—¶é˜Ÿåˆ—å°±æ‰“é€ å®Œæˆäº†ã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœè¿™æ ·ä½¿ç”¨çš„è¯ï¼Œå²‚ä¸æ˜¯**æ¯å¢åŠ ä¸€ä¸ªæ–°çš„æ—¶é—´éœ€æ±‚ï¼Œå°±è¦æ–°å¢ä¸€ä¸ªé˜Ÿåˆ—ï¼Œ**è¿™é‡Œåªæœ‰ 10S å’Œ 40S ä¸¤ä¸ªæ—¶é—´é€‰é¡¹ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªå°æ—¶åå¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦å¢åŠ  TTL ä¸ºä¸€ä¸ªå°æ—¶çš„é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯é¢„å®šä¼šè®®å®¤ç„¶ åæå‰é€šçŸ¥è¿™æ ·çš„åœºæ™¯ï¼Œå²‚ä¸æ˜¯è¦å¢åŠ æ— æ•°ä¸ªé˜Ÿåˆ—æ‰èƒ½æ»¡è¶³éœ€æ±‚ï¼Ÿ</p><h4 id="_7-6-å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_7-6-å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–"><span><strong>7.6. å»¶æ—¶é˜Ÿåˆ—ä¼˜åŒ–</strong></span></a></h4><h5 id="_7-6-1-ä»£ç æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_7-6-1-ä»£ç æ¶æ„å›¾"><span><strong>7.6.1. ä»£ç æ¶æ„å›¾</strong></span></a></h5><p>åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— QC,ç»‘å®šå…³ç³»å¦‚ä¸‹,è¯¥é˜Ÿåˆ—ä¸è®¾ç½® TTL æ—¶é—´</p><figure><a href="https://imgse.com/i/pC95QRs" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC95QRs.jpg" alt="pC95QRs.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC95QRs.jpg</figcaption></figure><h5 id="_7-6-2-é…ç½®æ–‡ä»¶ç±»ä»£ç " tabindex="-1"><a class="header-anchor" href="#_7-6-2-é…ç½®æ–‡ä»¶ç±»ä»£ç "><span>**7.6.2. é…ç½®æ–‡ä»¶ç±»ä»£ç  **</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//æ­»ä¿¡é˜Ÿåˆ—ä¼˜åŒ–ï¼Œå¼•å…¥é˜Ÿåˆ—C</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_C</span> <span class="token operator">=</span> <span class="token string">&quot;QC&quot;</span><span class="token punctuation">;</span>
<span class="token comment">//ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå¼•å…¥é˜Ÿåˆ—C</span>
    <span class="token comment">//å£°æ˜é˜Ÿåˆ— C æ­»ä¿¡äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;queueC&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">queueC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜å½“å‰é˜Ÿåˆ—ç»‘å®šçš„æ­»ä¿¡äº¤æ¢æœº</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-exchange&quot;</span><span class="token punctuation">,</span> <span class="token constant">Y_DEAD_LETTER_EXCHANGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å£°æ˜å½“å‰é˜Ÿåˆ—çš„æ­»ä¿¡è·¯ç”± key</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-dead-letter-routing-key&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;YD&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//æ²¡æœ‰å£°æ˜ TTL å±æ€§</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">QUEUE_C</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withArguments</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å£°æ˜é˜Ÿåˆ— B ç»‘å®š X äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">queuecBindingX</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;queueC&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queueC<span class="token punctuation">,</span>
                                  <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;xExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> xExchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queueC<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>xExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;XC&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_7-6-3-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç " tabindex="-1"><a class="header-anchor" href="#_7-6-3-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç "><span><strong>7.6.3. æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//ä¼˜åŒ–å»¶è¿Ÿé˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sendExpirationMsg/{message}/{ttlTime}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> ttlTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;X&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;XC&quot;</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> correlationData <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token comment">//è®¾ç½®å‘é€æ¶ˆæ¯å»¶è¿Ÿæ—¶é—´</span>
            correlationData<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setExpiration</span><span class="token punctuation">(</span>ttlTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> correlationData<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰æ—¶é—´ï¼š{},å‘é€ä¸€æ¡æ—¶é•¿{}æ¯«ç§’ TTL ä¿¡æ¯ç»™é˜Ÿåˆ— C:{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>ttlTime<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘èµ·è¯·æ±‚</p><blockquote><p>â€‹ å»¶è¿Ÿ20s</p><ul><li>http://localhost:8080/ttl/sendExpirationMsg/ä½ å¥½ 1/20000</li></ul><p>å»¶è¿Ÿ2s</p><ul><li>http://localhost:8080/ttl/sendExpirationMsg/ä½ å¥½ 2/2000</li></ul></blockquote><p><strong>æ•ˆæœå›¾</strong></p><figure><a href="https://imgse.com/i/pC9oKvn" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9oKvn.jpg" alt="pC9oKvn.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9oKvn.jpg</figcaption></figure><p><strong>ç¼ºç‚¹ï¼šéœ€è¦æ’é˜Ÿ</strong></p><p>çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯åœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œå°±ä»‹ç»è¿‡å¦‚æœä½¿ç”¨åœ¨æ¶ˆæ¯å±æ€§ä¸Šè®¾ç½® TTL çš„æ–¹å¼ï¼Œæ¶ˆ æ¯å¯èƒ½å¹¶ä¸ä¼šæŒ‰æ—¶â€œæ­»äº¡â€œï¼Œå› ä¸º **RabbitMQ åªä¼šæ£€æŸ¥ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯å¦è¿‡æœŸï¼Œ**å¦‚æœè¿‡æœŸåˆ™ä¸¢åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œ <strong>å¦‚æœç¬¬ä¸€ä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆé•¿ï¼Œè€Œç¬¬äºŒä¸ªæ¶ˆæ¯çš„å»¶æ—¶æ—¶é•¿å¾ˆçŸ­ï¼Œç¬¬äºŒä¸ªæ¶ˆæ¯å¹¶ä¸ä¼šä¼˜å…ˆå¾—åˆ°æ‰§è¡Œã€‚</strong></p><h4 id="_7-7-rabbitmq-æ’ä»¶å¼¥è¡¥å»¶è¿Ÿé˜Ÿåˆ—éœ€è¦æ’é˜Ÿç¼ºç‚¹" tabindex="-1"><a class="header-anchor" href="#_7-7-rabbitmq-æ’ä»¶å¼¥è¡¥å»¶è¿Ÿé˜Ÿåˆ—éœ€è¦æ’é˜Ÿç¼ºç‚¹"><span><strong>7.7. Rabbitmq æ’ä»¶å¼¥è¡¥å»¶è¿Ÿé˜Ÿåˆ—éœ€è¦æ’é˜Ÿç¼ºç‚¹</strong></span></a></h4><p><strong>å¼¥è¡¥ç¼ºç‚¹</strong></p><p>ä¸Šæ–‡ä¸­æåˆ°çš„é—®é¢˜ï¼Œç¡®å®æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä¸èƒ½å®ç°åœ¨æ¶ˆæ¯ç²’åº¦ä¸Šçš„ TTLï¼Œå¹¶ä½¿å…¶åœ¨è®¾ç½®çš„ TTL æ—¶é—´ åŠæ—¶æ­»äº¡ï¼Œå°±æ— æ³•è®¾è®¡æˆä¸€ä¸ªé€šç”¨çš„å»¶æ—¶é˜Ÿåˆ—ã€‚é‚£å¦‚ä½•è§£å†³å‘¢ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±å»è§£å†³è¯¥é—®é¢˜ã€‚</p><h5 id="_7-7-1-å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-7-1-å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶"><span><strong>7.7.1. å®‰è£…å»¶æ—¶é˜Ÿåˆ—æ’ä»¶</strong></span></a></h5><p>åœ¨å®˜ç½‘ä¸Šä¸‹è½½ https://www.rabbitmq.com/community-plugins.htmlï¼Œä¸‹è½½ rabbitmq_delayed_message_exchange æ’ä»¶ï¼Œç„¶åè§£å‹æ”¾ç½®åˆ° RabbitMQ çš„æ’ä»¶ç›®å½•ã€‚ è¿›å…¥ RabbitMQ çš„å®‰è£…ç›®å½•ä¸‹çš„ plgins ç›®å½•ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤è®©è¯¥æ’ä»¶ç”Ÿæ•ˆï¼Œç„¶åé‡å¯ RabbitMQ</p><blockquote><p>â‘ ã€å°†ä¸‹è½½å¥½çš„æ’ä»¶ä¸Šä¼ åˆ°rabbitmqå®‰è£…ç›®å½•ä¸‹</p><p>â‘¡ã€å°†æ’ä»¶å¤åˆ¶åˆ°æ’ä»¶æ–‡ä»¶å¤¹ä¸‹</p><p>â€‹ cp rabbitmq_delayed_message_exchange-3.8.0.ez /usr/lib/rabbitmq/lib/rabbitmq_server-3.8.8/plugins</p><p>â‘¢ã€å®‰è£…æ’ä»¶</p><p>â€‹ rabbitmq-plugins enable rabbitmq_delayed_message_exchange</p><p>â‘£ã€é‡å¯rabbitmq</p><p>â€‹ systemctl restart rabbitmqâ€“server</p></blockquote><p><strong>æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆ</strong></p><figure><a href="https://imgse.com/i/pC9TVqx" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9TVqx.jpg" alt="pC9TVqx.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9TVqx.jpg</figcaption></figure><h5 id="_7-7-2-ä»£ç æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_7-7-2-ä»£ç æ¶æ„å›¾"><span><strong>7.7.2. ä»£ç æ¶æ„å›¾</strong></span></a></h5><p>åœ¨è¿™é‡Œæ–°å¢äº†ä¸€ä¸ªé˜Ÿåˆ— delayed.queue,ä¸€ä¸ªè‡ªå®šä¹‰äº¤æ¢æœº delayed.exchangeï¼Œç»‘å®šå…³ç³»å¦‚ä¸‹:</p><figure><a href="https://imgse.com/i/pC9T8sI" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9T8sI.jpg" alt="pC9T8sI.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9T8sI.jpg</figcaption></figure><figure><a href="https://imgse.com/i/pC9T3QA" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9T3QA.jpg" alt="pC9T3QA.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9T3QA.jpg</figcaption></figure><h5 id="_7-7-3-é…ç½®æ–‡ä»¶ç±»ä»£ç " tabindex="-1"><a class="header-anchor" href="#_7-7-3-é…ç½®æ–‡ä»¶ç±»ä»£ç "><span><strong>7.7.3. é…ç½®æ–‡ä»¶ç±»ä»£ç </strong></span></a></h5><p>åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„äº¤æ¢æœºä¸­ï¼Œè¿™æ˜¯ä¸€ç§æ–°çš„äº¤æ¢ç±»å‹ï¼Œè¯¥ç±»å‹æ¶ˆæ¯æ”¯æŒå»¶è¿ŸæŠ•é€’æœºåˆ¶ æ¶ˆæ¯ä¼ é€’åå¹¶ ä¸ä¼šç«‹å³æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨ mnesia(ä¸€ä¸ªåˆ†å¸ƒå¼æ•°æ®ç³»ç»Ÿ)è¡¨ä¸­ï¼Œå½“è¾¾åˆ°æŠ•é€’æ—¶é—´æ—¶ï¼Œæ‰ æŠ•é€’åˆ°ç›®æ ‡é˜Ÿåˆ—ä¸­ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åŸºäºæ’ä»¶çš„ å»¶è¿Ÿé˜Ÿåˆ—é…ç½®ï¼šé˜Ÿåˆ—ã€äº¤æ¢æœºã€routingKey
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DelayedQueueConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//å»¶è¿Ÿé˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DELAYED_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;delayed.queue&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//å»¶è¿Ÿäº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DELAYED_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;delayed.exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//å»¶è¿ŸroutingKeyåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">DELAYED_ROUTING_KEY</span> <span class="token operator">=</span> <span class="token string">&quot;delayed.routingkey&quot;</span><span class="token punctuation">;</span>
    
    <span class="token comment">//å£°æ˜å»¶è¿Ÿé˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">delayedQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token constant">DELAYED_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//è‡ªå®šä¹‰äº¤æ¢æœº æˆ‘ä»¬åœ¨è¿™é‡Œå®šä¹‰çš„æ˜¯ä¸€ä¸ªå»¶è¿Ÿäº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CustomExchange</span> <span class="token function">delayedExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//è‡ªå®šä¹‰äº¤æ¢æœºçš„ç±»å‹</span>
        args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-delayed-type&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;direct&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomExchange</span><span class="token punctuation">(</span><span class="token constant">DELAYED_EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token string">&quot;x-delayed-message&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//å°†é˜Ÿåˆ—ã€äº¤æ¢æœºã€routingKeyè¿›è¡Œç»‘å®š</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">bindingDelayedQueue</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;delayedQueue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span>
                                       <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;delayedExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">CustomExchange</span>
                                               delayedExchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span>
                <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>delayedExchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token constant">DELAYED_ROUTING_KEY</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">noargs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_7-7-4-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç " tabindex="-1"><a class="header-anchor" href="#_7-7-4-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç "><span><strong>7.7.4. æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token comment">//å‘é€æ¶ˆæ¯ï¼ŒåŸºäºæ’ä»¶çš„å»¶è¿Ÿé˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sendDelayMsg/{message}/{delayTime}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMsg</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> message<span class="token punctuation">,</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> delayTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//è®¾ç½®äº¤æ¢æœºåç§°ï¼ŒroutingKeyåç§°ï¼Œå‘é€çš„æ¶ˆæ¯</span>
        rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token class-name">DelayedQueueConfig</span><span class="token punctuation">.</span><span class="token constant">DELAYED_EXCHANGE_NAME</span><span class="token punctuation">,</span> <span class="token class-name">DelayedQueueConfig</span><span class="token punctuation">.</span><span class="token constant">DELAYED_ROUTING_KEY</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span>
                correlationData <span class="token operator">-&gt;</span><span class="token punctuation">{</span>
                    correlationData<span class="token punctuation">.</span><span class="token function">getMessageProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDelay</span><span class="token punctuation">(</span>delayTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> correlationData<span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot; å½“ å‰ æ—¶ é—´ ï¼š {}, å‘é€ä¸€æ¡å»¶è¿Ÿ {} æ¯«ç§’çš„ä¿¡æ¯ç»™é˜Ÿåˆ— delayed.queue:{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span>
                <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>delayTime<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_7-7-5-æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç " tabindex="-1"><a class="header-anchor" href="#_7-7-5-æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç "><span><strong>7.7.5. æ¶ˆæ¯æ¶ˆè´¹è€…ä»£ç </strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åŸºäºæ’ä»¶çš„ å»¶è¿Ÿé˜Ÿåˆ—  æ¶ˆè´¹è€…
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DelayedQueueConsumer</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç›‘å¬æ­»ä¿¡é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token class-name">DelayedQueueConfig</span><span class="token punctuation">.</span><span class="token constant">DELAYED_QUEUE_NAME</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveDelayedQueue</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å½“å‰æ—¶é—´ï¼š{},æ”¶åˆ°å»¶æ—¶é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼š{}&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘èµ·è¯·æ±‚ï¼š</p><blockquote><p>â€‹ å»¶è¿Ÿ20s</p><ul><li>http://localhost:8080/ttl/sendDelayMsg/come on baby1/20000</li></ul><p>å»¶è¿Ÿ2s</p><ul><li>http://localhost:8080/ttl/sendDelayMsg/come on baby2/2000</li></ul></blockquote><figure><a href="https://imgse.com/i/pC9HmCD" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9HmCD.jpg" alt="pC9HmCD.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9HmCD.jpg</figcaption></figure><p><strong>è§£å†³</strong></p><p><strong>ç¬¬äºŒä¸ªæ¶ˆæ¯è¢«å…ˆæ¶ˆè´¹æ‰äº†ï¼Œç¬¦åˆé¢„æœŸ</strong></p><h4 id="_7-8-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_7-8-æ€»ç»“"><span><strong>7.8. æ€»ç»“</strong></span></a></h4><p>å»¶æ—¶é˜Ÿåˆ—åœ¨éœ€è¦å»¶æ—¶å¤„ç†çš„åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œä½¿ç”¨ RabbitMQ æ¥å®ç°å»¶æ—¶é˜Ÿåˆ—å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨ RabbitMQ çš„ç‰¹æ€§ï¼Œå¦‚ï¼šæ¶ˆæ¯å¯é å‘é€ã€æ¶ˆæ¯å¯é æŠ•é€’ã€æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿éšœæ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡ä»¥åŠæœªè¢«æ­£ ç¡®å¤„ç†çš„æ¶ˆæ¯ä¸ä¼šè¢«ä¸¢å¼ƒã€‚å¦å¤–ï¼Œé€šè¿‡ RabbitMQ é›†ç¾¤çš„ç‰¹æ€§ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œä¸ä¼šå› ä¸º å•ä¸ªèŠ‚ç‚¹æŒ‚æ‰å¯¼è‡´å»¶æ—¶é˜Ÿåˆ—ä¸å¯ç”¨æˆ–è€…æ¶ˆæ¯ä¸¢å¤±ã€‚</p><p>å½“ç„¶ï¼Œå»¶æ—¶é˜Ÿåˆ—è¿˜æœ‰å¾ˆå¤šå…¶å®ƒé€‰æ‹©ï¼Œæ¯”å¦‚åˆ©ç”¨ Java çš„ DelayQueueï¼Œåˆ©ç”¨ Redis çš„ zsetï¼Œåˆ©ç”¨ Quartz æˆ–è€…åˆ©ç”¨ kafka çš„æ—¶é—´è½®ï¼Œè¿™äº›æ–¹å¼å„æœ‰ç‰¹ç‚¹,çœ‹éœ€è¦é€‚ç”¨çš„åœºæ™¯</p><h3 id="_8ã€å‘å¸ƒç¡®è®¤é«˜çº§" tabindex="-1"><a class="header-anchor" href="#_8ã€å‘å¸ƒç¡®è®¤é«˜çº§"><span><strong>8ã€å‘å¸ƒç¡®è®¤é«˜çº§</strong></span></a></h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç”±äºä¸€äº›ä¸æ˜åŸå› ï¼Œå¯¼è‡´ rabbitmq é‡å¯ï¼Œåœ¨ RabbitMQ é‡å¯æœŸé—´ç”Ÿäº§è€…æ¶ˆæ¯æŠ•é€’å¤±è´¥ï¼Œ å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†å’Œæ¢å¤ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬å¼€å§‹æ€è€ƒï¼Œå¦‚ä½•æ‰èƒ½è¿›è¡Œ RabbitMQ çš„æ¶ˆæ¯å¯é æŠ•é€’å‘¢ï¼Ÿ ç‰¹åˆ«æ˜¯åœ¨è¿™æ ·æ¯”è¾ƒæç«¯çš„æƒ…å†µï¼ŒRabbitMQ é›†ç¾¤ä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ— æ³•æŠ•é€’çš„æ¶ˆæ¯è¯¥å¦‚ä½•å¤„ç†å‘¢:</p><h4 id="_8-1-å‘å¸ƒç¡®è®¤-springboot-ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#_8-1-å‘å¸ƒç¡®è®¤-springboot-ç‰ˆæœ¬"><span><strong>8.1. å‘å¸ƒç¡®è®¤ springboot ç‰ˆæœ¬</strong></span></a></h4><h5 id="_8-1-1-ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_8-1-1-ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ"><span><strong>8.1.1. ç¡®è®¤æœºåˆ¶æ–¹æ¡ˆ</strong></span></a></h5><h5 id="_8-1-2-ä»£ç æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_8-1-2-ä»£ç æ¶æ„å›¾"><span>**8.1.2. ä»£ç æ¶æ„å›¾ **</span></a></h5><h5 id="_8-1-3-é…ç½®æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_8-1-3-é…ç½®æ–‡ä»¶"><span><strong>8.1.3. é…ç½®æ–‡ä»¶</strong></span></a></h5><p>åœ¨é…ç½®æ–‡ä»¶å½“ä¸­éœ€è¦æ·»åŠ </p><p><strong>spring.rabbitmq.publisher-confirm-type=correlated</strong></p><ul><li>NONE ç¦ç”¨å‘å¸ƒç¡®è®¤æ¨¡å¼ï¼Œæ˜¯é»˜è®¤å€¼</li><li>CORRELATED å‘å¸ƒæ¶ˆæ¯æˆåŠŸåˆ°äº¤æ¢å™¨åä¼šè§¦å‘å›è°ƒæ–¹æ³•</li><li>SIMPLE</li></ul><p>ç»æµ‹è¯•æœ‰ä¸¤ç§æ•ˆæœï¼Œå…¶ä¸€æ•ˆæœå’Œ CORRELATED å€¼ä¸€æ ·ä¼šè§¦å‘å›è°ƒæ–¹æ³•ï¼Œ</p><p>å…¶äºŒåœ¨å‘å¸ƒæ¶ˆæ¯æˆåŠŸåä½¿ç”¨ rabbitTemplate è°ƒç”¨ waitForConfirms æˆ– waitForConfirmsOrDie æ–¹æ³•</p><p>ç­‰å¾… broker èŠ‚ç‚¹è¿”å›å‘é€ç»“æœï¼Œæ ¹æ®è¿”å›ç»“æœæ¥åˆ¤å®šä¸‹ä¸€æ­¥çš„é€»è¾‘ï¼Œè¦æ³¨æ„çš„ç‚¹æ˜¯</p><p>waitForConfirmsOrDie æ–¹æ³•å¦‚æœè¿”å› false åˆ™ä¼šå…³é—­ channelï¼Œåˆ™æ¥ä¸‹æ¥æ— æ³•å‘é€æ¶ˆæ¯åˆ° broker</p><p><strong>é…ç½®æ–‡ä»¶</strong></p><div class="language-properties line-numbers-mode" data-ext="properties" data-title="properties"><pre class="language-properties"><code><span class="token key attr-name">spring.rabbitmq.host</span><span class="token punctuation">=</span><span class="token value attr-value">182.92.234.71</span>
<span class="token key attr-name">spring.rabbitmq.port</span><span class="token punctuation">=</span><span class="token value attr-value">5672</span>
<span class="token key attr-name">spring.rabbitmq.username</span><span class="token punctuation">=</span><span class="token value attr-value">admin</span>
<span class="token key attr-name">spring.rabbitmq.password</span><span class="token punctuation">=</span><span class="token value attr-value">123</span>
<span class="token key attr-name">spring.rabbitmq.publisher-confirm-type</span><span class="token punctuation">=</span><span class="token value attr-value">correlated</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-1-4-æ·»åŠ é…ç½®ç±»" tabindex="-1"><a class="header-anchor" href="#_8-1-4-æ·»åŠ é…ç½®ç±»"><span><strong>8.1.4. æ·»åŠ é…ç½®ç±»</strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfirmConfig</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;confirm.exchange&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;confirm.queue&quot;</span><span class="token punctuation">;</span>
 <span class="token comment">//å£°æ˜ä¸šåŠ¡ Exchange</span>
 <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;confirmExchange&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">confirmExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DirectExchange</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// å£°æ˜ç¡®è®¤é˜Ÿåˆ—</span>
 <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;confirmQueue&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">confirmQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">// å£°æ˜ç¡®è®¤é˜Ÿåˆ—ç»‘å®šå…³ç³»</span>
 <span class="token annotation punctuation">@Bean</span>
 <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">queueBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;confirmQueue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">,</span>
 <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;confirmExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> exchange<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-1-5-æ¶ˆæ¯ç”Ÿäº§è€…" tabindex="-1"><a class="header-anchor" href="#_8-1-5-æ¶ˆæ¯ç”Ÿäº§è€…"><span><strong>8.1.5. æ¶ˆæ¯ç”Ÿäº§è€…</strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/confirm&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;confirm.exchange&quot;</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">private</span> <span class="token class-name">MyCallBack</span> myCallBack<span class="token punctuation">;</span>
 <span class="token comment">//ä¾èµ–æ³¨å…¥ rabbitTemplate ä¹‹åå†è®¾ç½®å®ƒçš„å›è°ƒå¯¹è±¡</span>
 <span class="token annotation punctuation">@PostConstruct</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span>myCallBack<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sendMessage/{message}&quot;</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">//æŒ‡å®šæ¶ˆæ¯ id ä¸º 1</span>
 <span class="token class-name">CorrelationData</span> correlationData1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">String</span> routingKey<span class="token operator">=</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">;</span>
 
rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">,</span>routingKey<span class="token punctuation">,</span>message<span class="token operator">+</span>routingKey<span class="token punctuation">,</span>correl
ationData1<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">CorrelationData</span> correlationData2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 routingKey<span class="token operator">=</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">;</span>
 
rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">,</span>routingKey<span class="token punctuation">,</span>message<span class="token operator">+</span>routingKey<span class="token punctuation">,</span>correl
ationData2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ¶ˆæ¯å†…å®¹:{}&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-1-6-å›è°ƒæ¥å£" tabindex="-1"><a class="header-anchor" href="#_8-1-6-å›è°ƒæ¥å£"><span><strong>8.1.6. å›è°ƒæ¥å£</strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallBack</span> <span class="token keyword">implements</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span> <span class="token punctuation">{</span>
 <span class="token doc-comment comment">/**
 * äº¤æ¢æœºä¸ç®¡æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯çš„ä¸€ä¸ªå›è°ƒæ–¹æ³•
 * CorrelationData
 * æ¶ˆæ¯ç›¸å…³æ•°æ®
 * ack
 * äº¤æ¢æœºæ˜¯å¦æ”¶åˆ°æ¶ˆæ¯
 */</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token class-name">String</span> id<span class="token operator">=</span>correlationData<span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">?</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ° id ä¸º:{}çš„æ¶ˆæ¯&quot;</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ° id ä¸º:{}æ¶ˆæ¯,ç”±äºåŸå› :{}&quot;</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-1-7-æ¶ˆæ¯æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#_8-1-7-æ¶ˆæ¯æ¶ˆè´¹è€…"><span><strong>8.1.7. æ¶ˆæ¯æ¶ˆè´¹è€…</strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfirmConsumer</span> <span class="token punctuation">{</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;confirm.queue&quot;</span><span class="token punctuation">;</span>
 <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span><span class="token constant">CONFIRM_QUEUE_NAME</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveMsg</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token class-name">String</span> msg<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥å—åˆ°é˜Ÿåˆ— confirm.queue æ¶ˆæ¯:{}&quot;</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-1-8-ç»“æœåˆ†æ" tabindex="-1"><a class="header-anchor" href="#_8-1-8-ç»“æœåˆ†æ"><span><strong>8.1.8. ç»“æœåˆ†æ</strong></span></a></h5><figure><a href="https://imgse.com/i/pC9xT8P" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pC9xT8P.jpg" alt="pC9xT8P.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pC9xT8P.jpg</figcaption></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯çš„ RoutingKey ä¸º &quot;key1&quot;ï¼Œç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸º &quot;key2&quot;ï¼Œä¸¤æ¡æ¶ˆæ¯éƒ½æˆåŠŸè¢«äº¤æ¢æœºæ¥æ”¶ï¼Œä¹Ÿæ”¶åˆ°äº†äº¤æ¢æœºçš„ç¡®è®¤å›è°ƒï¼Œä½†æ¶ˆè´¹è€…åªæ”¶åˆ°äº†ä¸€æ¡æ¶ˆæ¯ï¼Œå› ä¸º ç¬¬äºŒæ¡æ¶ˆæ¯çš„ RoutingKey ä¸é˜Ÿåˆ—çš„ BindingKey ä¸ä¸€è‡´ï¼Œä¹Ÿæ²¡æœ‰å…¶å®ƒé˜Ÿåˆ—èƒ½æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ï¼Œæ‰€æœ‰ç¬¬äºŒæ¡ æ¶ˆæ¯è¢«ç›´æ¥ä¸¢å¼ƒäº†ã€‚</p><h4 id="_8-2-å›é€€æ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#_8-2-å›é€€æ¶ˆæ¯"><span><strong>8.2. å›é€€æ¶ˆæ¯</strong></span></a></h4><h5 id="_8-2-1-mandatory-å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_8-2-1-mandatory-å‚æ•°"><span><strong>8.2.1. Mandatory å‚æ•°</strong></span></a></h5><p>**åœ¨ä»…å¼€å¯äº†ç”Ÿäº§è€…ç¡®è®¤æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œäº¤æ¢æœºæ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œä¼šç›´æ¥ç»™æ¶ˆæ¯ç”Ÿäº§è€…å‘é€ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚ æœå‘ç°è¯¥æ¶ˆæ¯ä¸å¯è·¯ç”±ï¼Œé‚£ä¹ˆæ¶ˆæ¯ä¼šè¢«ç›´æ¥ä¸¢å¼ƒï¼Œæ­¤æ—¶ç”Ÿäº§è€…æ˜¯ä¸çŸ¥é“æ¶ˆæ¯è¢«ä¸¢å¼ƒè¿™ä¸ªäº‹ä»¶çš„ã€‚**é‚£ä¹ˆå¦‚ä½• è®©æ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯å¸®æˆ‘æƒ³åŠæ³•å¤„ç†ä¸€ä¸‹ï¼Ÿæœ€èµ·ç é€šçŸ¥æˆ‘ä¸€å£°ï¼Œæˆ‘å¥½è‡ªå·±å¤„ç†å•Šã€‚é€šè¿‡è®¾ç½® mandatory å‚ æ•°å¯ä»¥åœ¨å½“æ¶ˆæ¯ä¼ é€’è¿‡ç¨‹ä¸­ä¸å¯è¾¾ç›®çš„åœ°æ—¶å°†æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…ã€‚ <strong>æ·»åŠ é…ç½®æ–‡ä»¶</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">rabbitmq</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 82.157.234.124
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">5672</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span>
    <span class="token key atrule">publisher-confirm-type</span><span class="token punctuation">:</span> correlated
    <span class="token comment">#å¼€å¯å›é€€æ¶ˆæ¯</span>
    <span class="token key atrule">publisher-returns</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-2-2-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç " tabindex="-1"><a class="header-anchor" href="#_8-2-2-æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç "><span><strong>8.2.2. æ¶ˆæ¯ç”Ÿäº§è€…ä»£ç </strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageProducer</span> <span class="token keyword">implements</span> <span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span> <span class="token punctuation">,</span> 
<span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span> <span class="token punctuation">{</span>
 <span class="token annotation punctuation">@Autowired</span>
 <span class="token keyword">private</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>
 <span class="token comment">//rabbitTemplate æ³¨å…¥ä¹‹åå°±è®¾ç½®è¯¥å€¼</span>
 <span class="token annotation punctuation">@PostConstruct</span>
 <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 rabbitTemplate<span class="token punctuation">.</span><span class="token function">setConfirmCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token doc-comment comment">/**
 * trueï¼š
 * äº¤æ¢æœºæ— æ³•å°†æ¶ˆæ¯è¿›è¡Œè·¯ç”±æ—¶ï¼Œä¼šå°†è¯¥æ¶ˆæ¯è¿”å›ç»™ç”Ÿäº§è€…
 * falseï¼š
 * å¦‚æœå‘ç°æ¶ˆæ¯æ— æ³•è¿›è¡Œè·¯ç”±ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒ
 */</span>
 rabbitTemplate<span class="token punctuation">.</span><span class="token function">setMandatory</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è®¾ç½®å›é€€æ¶ˆæ¯äº¤ç»™è°å¤„ç†</span>
 rabbitTemplate<span class="token punctuation">.</span><span class="token function">setReturnCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;sendMessage&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">//è®©æ¶ˆæ¯ç»‘å®šä¸€ä¸ª id å€¼</span>
 <span class="token class-name">CorrelationData</span> correlationData1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;confirm.exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">,</span>correlationData1<span class="token punctuation">)</span>
<span class="token punctuation">;</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ¶ˆæ¯ id ä¸º:{}å†…å®¹ä¸º{}&quot;</span><span class="token punctuation">,</span>correlationData1<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">&quot;key1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">CorrelationData</span> correlationData2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorrelationData</span><span class="token punctuation">(</span><span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
rabbitTemplate<span class="token punctuation">.</span><span class="token function">convertAndSend</span><span class="token punctuation">(</span><span class="token string">&quot;confirm.exchange&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">,</span>correlationData2<span class="token punctuation">)</span>
<span class="token punctuation">;</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ¶ˆæ¯ id ä¸º:{}å†…å®¹ä¸º{}&quot;</span><span class="token punctuation">,</span>correlationData2<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>message<span class="token operator">+</span><span class="token string">&quot;key2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token class-name">String</span> id <span class="token operator">=</span> correlationData <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>ack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœºæ”¶åˆ°æ¶ˆæ¯ç¡®è®¤æˆåŠŸ, id:{}&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯ id:{}æœªæˆåŠŸæŠ•é€’åˆ°äº¤æ¢æœº,åŸå› æ˜¯:{}&quot;</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> 
exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆæ¯:{}è¢«æœåŠ¡å™¨é€€å›ï¼Œé€€å›åŸå› :{}, äº¤æ¢æœºæ˜¯:{}, è·¯ç”± key:{}&quot;</span><span class="token punctuation">,</span>
 <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>replyText<span class="token punctuation">,</span> exchange<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-2-3-å›è°ƒæ¥å£" tabindex="-1"><a class="header-anchor" href="#_8-2-3-å›è°ƒæ¥å£"><span>**8.2.3. å›è°ƒæ¥å£ **</span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallBack</span> <span class="token keyword">implements</span> 
<span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ConfirmCallback</span><span class="token punctuation">,</span><span class="token class-name">RabbitTemplate<span class="token punctuation">.</span>ReturnCallback</span> <span class="token punctuation">{</span>
 <span class="token doc-comment comment">/**
 * äº¤æ¢æœºä¸ç®¡æ˜¯å¦æ”¶åˆ°æ¶ˆæ¯çš„ä¸€ä¸ªå›è°ƒæ–¹æ³•
 * CorrelationData
 * æ¶ˆæ¯ç›¸å…³æ•°æ®
 * ack
 * äº¤æ¢æœºæ˜¯å¦æ”¶åˆ°æ¶ˆæ¯
 */</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">confirm</span><span class="token punctuation">(</span><span class="token class-name">CorrelationData</span> correlationData<span class="token punctuation">,</span> <span class="token keyword">boolean</span> ack<span class="token punctuation">,</span> <span class="token class-name">String</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token class-name">String</span> id<span class="token operator">=</span>correlationData<span class="token operator">!=</span><span class="token keyword">null</span><span class="token operator">?</span>correlationData<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>ack<span class="token punctuation">)</span><span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœºå·²ç»æ”¶åˆ° id ä¸º:{}çš„æ¶ˆæ¯&quot;</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;äº¤æ¢æœºè¿˜æœªæ”¶åˆ° id ä¸º:{}æ¶ˆæ¯,ç”±äºåŸå› :{}&quot;</span><span class="token punctuation">,</span>id<span class="token punctuation">,</span>cause<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token comment">//å½“æ¶ˆæ¯æ— æ³•è·¯ç”±çš„æ—¶å€™çš„å›è°ƒæ–¹æ³•</span>
 <span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">returnedMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">,</span> <span class="token keyword">int</span> replyCode<span class="token punctuation">,</span> <span class="token class-name">String</span> replyText<span class="token punctuation">,</span> <span class="token class-name">String</span> 
exchange<span class="token punctuation">,</span> <span class="token class-name">String</span> routingKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot; æ¶ˆ æ¯ {}, è¢«äº¤æ¢æœº {} é€€å›ï¼Œé€€å›åŸå›  :{}, è·¯ ç”± key:{}&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> 
<span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>exchange<span class="token punctuation">,</span>replyText<span class="token punctuation">,</span>routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-2-4-ç»“æœåˆ†æ" tabindex="-1"><a class="header-anchor" href="#_8-2-4-ç»“æœåˆ†æ"><span><strong>8.2.4. ç»“æœåˆ†æ</strong></span></a></h5><figure><a href="https://imgse.com/i/pCCPHvq" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/04/pCCPHvq.jpg" alt="pCCPHvq.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCPHvq.jpg</figcaption></figure><h4 id="_8-3-å¤‡ä»½äº¤æ¢æœº" tabindex="-1"><a class="header-anchor" href="#_8-3-å¤‡ä»½äº¤æ¢æœº"><span><strong>8.3. å¤‡ä»½äº¤æ¢æœº</strong></span></a></h4><p>æœ‰äº† mandatory å‚æ•°å’Œå›é€€æ¶ˆæ¯ï¼Œæˆ‘ä»¬è·å¾—äº†å¯¹æ— æ³•æŠ•é€’æ¶ˆæ¯çš„æ„ŸçŸ¥èƒ½åŠ›ï¼Œæœ‰æœºä¼šåœ¨ç”Ÿäº§è€…çš„æ¶ˆæ¯ æ— æ³•è¢«æŠ•é€’æ—¶å‘ç°å¹¶å¤„ç†ã€‚ä½†æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¯¥å¦‚ä½•å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯ï¼Œæœ€å¤šæ‰“ä¸ªæ—¥å¿—ï¼Œç„¶ åè§¦å‘æŠ¥è­¦ï¼Œå†æ¥æ‰‹åŠ¨å¤„ç†ã€‚è€Œé€šè¿‡æ—¥å¿—æ¥å¤„ç†è¿™äº›æ— æ³•è·¯ç”±çš„æ¶ˆæ¯æ˜¯å¾ˆä¸ä¼˜é›…çš„åšæ³•ï¼Œç‰¹åˆ«æ˜¯å½“ç”Ÿäº§è€… æ‰€åœ¨çš„æœåŠ¡æœ‰å¤šå°æœºå™¨çš„æ—¶å€™ï¼Œæ‰‹åŠ¨å¤åˆ¶æ—¥å¿—ä¼šæ›´åŠ éº»çƒ¦è€Œä¸”å®¹æ˜“å‡ºé”™ã€‚è€Œä¸”è®¾ç½® mandatory å‚æ•°ä¼šå¢ åŠ ç”Ÿäº§è€…çš„å¤æ‚æ€§ï¼Œéœ€è¦æ·»åŠ å¤„ç†è¿™äº›è¢«é€€å›çš„æ¶ˆæ¯çš„é€»è¾‘ã€‚å¦‚æœæ—¢ä¸æƒ³ä¸¢å¤±æ¶ˆæ¯ï¼Œåˆä¸æƒ³å¢åŠ ç”Ÿäº§è€…çš„ å¤æ‚æ€§ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿå‰é¢åœ¨è®¾ç½®æ­»ä¿¡é˜Ÿåˆ—çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°ï¼Œå¯ä»¥ä¸ºé˜Ÿåˆ—è®¾ç½®æ­»ä¿¡äº¤æ¢æœºæ¥å­˜å‚¨é‚£äº› å¤„ç†å¤±è´¥çš„æ¶ˆæ¯ï¼Œå¯æ˜¯è¿™äº›ä¸å¯è·¯ç”±æ¶ˆæ¯æ ¹æœ¬æ²¡æœ‰æœºä¼šè¿›å…¥åˆ°é˜Ÿåˆ—ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨æ­»ä¿¡é˜Ÿåˆ—æ¥ä¿å­˜æ¶ˆæ¯ã€‚ åœ¨ RabbitMQ ä¸­ï¼Œæœ‰ä¸€ç§å¤‡ä»½äº¤æ¢æœºçš„æœºåˆ¶å­˜åœ¨ï¼Œå¯ä»¥å¾ˆå¥½çš„åº”å¯¹è¿™ä¸ªé—®é¢˜ã€‚ä»€ä¹ˆæ˜¯å¤‡ä»½äº¤æ¢æœºå‘¢ï¼Ÿå¤‡ä»½ äº¤æ¢æœºå¯ä»¥ç†è§£ä¸º RabbitMQ ä¸­äº¤æ¢æœºçš„â€œå¤‡èƒâ€ï¼Œå½“æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªäº¤æ¢æœºå£°æ˜ä¸€ä¸ªå¯¹åº”çš„å¤‡ä»½äº¤æ¢æœºæ—¶ï¼Œ å°±æ˜¯ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå¤‡èƒï¼Œå½“äº¤æ¢æœºæ¥æ”¶åˆ°ä¸€æ¡ä¸å¯è·¯ç”±æ¶ˆæ¯æ—¶ï¼Œå°†ä¼šæŠŠè¿™æ¡æ¶ˆæ¯è½¬å‘åˆ°å¤‡ä»½äº¤æ¢æœºä¸­ï¼Œç”± å¤‡ä»½äº¤æ¢æœºæ¥è¿›è¡Œè½¬å‘å’Œå¤„ç†ï¼Œé€šå¸¸å¤‡ä»½äº¤æ¢æœºçš„ç±»å‹ä¸º Fanout ï¼Œè¿™æ ·å°±èƒ½æŠŠæ‰€æœ‰æ¶ˆæ¯éƒ½æŠ•é€’åˆ°ä¸å…¶ç»‘ å®šçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åæˆ‘ä»¬åœ¨å¤‡ä»½äº¤æ¢æœºä¸‹ç»‘å®šä¸€ä¸ªé˜Ÿåˆ—ï¼Œè¿™æ ·æ‰€æœ‰é‚£äº›åŸäº¤æ¢æœºæ— æ³•è¢«è·¯ç”±çš„æ¶ˆæ¯ï¼Œå°±ä¼šéƒ½ è¿›å…¥è¿™ä¸ªé˜Ÿåˆ—äº†ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å»ºç«‹ä¸€ä¸ªæŠ¥è­¦é˜Ÿåˆ—ï¼Œç”¨ç‹¬ç«‹çš„æ¶ˆè´¹è€…æ¥è¿›è¡Œç›‘æµ‹å’ŒæŠ¥è­¦ã€‚</p><h5 id="_8-3-1-ä»£ç æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_8-3-1-ä»£ç æ¶æ„å›¾"><span><strong>8.3.1. ä»£ç æ¶æ„å›¾</strong></span></a></h5><figure><a href="https://imgse.com/i/pCCiHFe" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCiHFe.jpg" alt="pCCiHFe.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCiHFe.jpg</figcaption></figure><h5 id="_8-3-2-ä¿®æ”¹é…ç½®ç±»" tabindex="-1"><a class="header-anchor" href="#_8-3-2-ä¿®æ”¹é…ç½®ç±»"><span><strong>8.3.2. ä¿®æ”¹é…ç½®ç±»</strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å‘å¸ƒç¡®è®¤ ï¼ˆé«˜çº§ï¼‰ é…ç½®ç±»ï¼šäº¤æ¢æœºã€é˜Ÿåˆ—ã€routingKey
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfirmConfig</span> <span class="token punctuation">{</span>
    <span class="token comment">//äº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;confirm.exchange&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;confirm.queue&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//routingKeyåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">CONFIRM_ROUTE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;key1&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//å¤‡ä»½äº¤æ¢æœºåç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BACKUP_EXCHANGE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;backup.exchange&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//å¤‡ä»½é˜Ÿåˆ—åç§°</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">BACKUP_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;backup.queue&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//æŠ¥è­¦é˜Ÿåˆ—</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">WARNING_QUEUE_NAME</span> <span class="token operator">=</span> <span class="token string">&quot;warning.queue&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//å£°æ˜å¤‡ä»½äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;backupExchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">FanoutExchange</span> <span class="token function">backupExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">FanoutExchange</span><span class="token punctuation">(</span><span class="token constant">BACKUP_EXCHANGE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å£°æ˜äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;confirmExchange&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">DirectExchange</span> <span class="token function">confirmExchange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//è®¾ç½®å°†æ¶ˆæ¯è½¬å‘åˆ°å¤‡ä»½äº¤æ¢æœºä¸Š</span>
        <span class="token keyword">return</span> <span class="token class-name">ExchangeBuilder</span><span class="token punctuation">.</span><span class="token function">directExchange</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_EXCHANGE_NAME</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">withArgument</span><span class="token punctuation">(</span><span class="token string">&quot;alternate-exchange&quot;</span><span class="token punctuation">,</span><span class="token constant">BACKUP_EXCHANGE_NAME</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å£°æ˜å¤‡ä»½é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;backupQueue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">backupQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">BACKUP_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å£°æ˜æŠ¥è­¦é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;warningQueue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">warningQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">WARNING_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//å£°æ˜é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span><span class="token string">&quot;confirmQueue&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Queue</span> <span class="token function">confirmQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">QueueBuilder</span><span class="token punctuation">.</span><span class="token function">durable</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_QUEUE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">queueExchangeBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;confirmExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">DirectExchange</span> exchange<span class="token punctuation">,</span>
                                        <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;confirmQueue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token constant">CONFIRM_ROUTE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç»‘å®šå¤‡ä»½äº¤æ¢æœºå’Œå¤‡ä»½é˜Ÿåˆ—å…³ç³»</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">backupQueueExchangeBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;backupExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">FanoutExchange</span> exchange<span class="token punctuation">,</span>
                                              <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;backupQueue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//ç»‘å®šå¤‡ä»½äº¤æ¢æœºå’ŒæŠ¥è­¦é˜Ÿåˆ—çš„å…³ç³»</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Binding</span> <span class="token function">warningQueueExchangeBinding</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;backupExchange&quot;</span><span class="token punctuation">)</span> <span class="token class-name">FanoutExchange</span> exchange<span class="token punctuation">,</span>
                                               <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">&quot;warningQueue&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Queue</span> queue<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BindingBuilder</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">to</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-3-3-æŠ¥è­¦æ¶ˆè´¹è€…" tabindex="-1"><a class="header-anchor" href="#_8-3-3-æŠ¥è­¦æ¶ˆè´¹è€…"><span><strong>8.3.3. æŠ¥è­¦æ¶ˆè´¹è€…</strong></span></a></h5><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¤‡ä»½äº¤æ¢æœº æŠ¥è­¦æ¶ˆè´¹è€…
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WarningConsumer</span> <span class="token punctuation">{</span>

    <span class="token comment">//ç›‘å¬æŠ¥è­¦é˜Ÿåˆ—</span>
    <span class="token annotation punctuation">@RabbitListener</span><span class="token punctuation">(</span>queues <span class="token operator">=</span> <span class="token class-name">ConfirmConfig</span><span class="token punctuation">.</span><span class="token constant">WARNING_QUEUE_NAME</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveWarningMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> message<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> msg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;æŠ¥è­¦å‘ç°ä¸å¯è·¯ç”±æ¶ˆæ¯ï¼š{}&quot;</span><span class="token punctuation">,</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_8-3-4-æµ‹è¯•æ³¨æ„äº‹é¡¹" tabindex="-1"><a class="header-anchor" href="#_8-3-4-æµ‹è¯•æ³¨æ„äº‹é¡¹"><span><strong>8.3.4. æµ‹è¯•æ³¨æ„äº‹é¡¹</strong></span></a></h5><p><strong>é‡æ–°å¯åŠ¨é¡¹ç›®çš„æ—¶å€™éœ€è¦æŠŠåŸæ¥çš„ confirm.exchange åˆ é™¤å› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†å…¶ç»‘å®šå±æ€§ï¼Œä¸ç„¶æŠ¥ä»¥ä¸‹é”™:</strong></p><figure><a href="https://imgse.com/i/pCCiToD" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCiToD.jpg" alt="pCCiToD.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCiToD.jpg</figcaption></figure><h5 id="_8-3-5-ç»“æœåˆ†æ" tabindex="-1"><a class="header-anchor" href="#_8-3-5-ç»“æœåˆ†æ"><span><strong>8.3.5. ç»“æœåˆ†æ</strong></span></a></h5><figure><a href="https://imgse.com/i/pCCibJH" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCibJH.jpg" alt="pCCibJH.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCibJH.jpg</figcaption></figure><p><strong>æ³¨æ„ï¼š</strong></p><p><strong>mandatory å‚æ•°ä¸å¤‡ä»½äº¤æ¢æœºå¯ä»¥ä¸€èµ·ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å¼€å¯ï¼Œæ¶ˆæ¯ç©¶ç«Ÿä½•å»ä½•ä»ï¼Ÿè°ä¼˜å…ˆ çº§é«˜ï¼Œç»è¿‡ä¸Šé¢ç»“æœæ˜¾ç¤ºç­”æ¡ˆæ˜¯å¤‡ä»½äº¤æ¢æœºä¼˜å…ˆçº§é«˜ã€‚</strong></p><h3 id="_9ã€-rabbitmq-å…¶ä»–çŸ¥è¯†ç‚¹" tabindex="-1"><a class="header-anchor" href="#_9ã€-rabbitmq-å…¶ä»–çŸ¥è¯†ç‚¹"><span><strong>9ã€ RabbitMQ å…¶ä»–çŸ¥è¯†ç‚¹</strong></span></a></h3><h4 id="_9-1-å¹‚ç­‰æ€§" tabindex="-1"><a class="header-anchor" href="#_9-1-å¹‚ç­‰æ€§"><span><strong>9.1. å¹‚ç­‰æ€§</strong></span></a></h4><h5 id="_9-1-1-æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_9-1-1-æ¦‚å¿µ"><span><strong>9.1.1. æ¦‚å¿µ</strong></span></a></h5><p>ç”¨æˆ·å¯¹äºåŒä¸€æ“ä½œå‘èµ·çš„ä¸€æ¬¡è¯·æ±‚æˆ–è€…å¤šæ¬¡è¯·æ±‚çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¸ä¼šå› ä¸ºå¤šæ¬¡ç‚¹å‡»è€Œäº§ç”Ÿäº†å‰¯ä½œç”¨ã€‚ ä¸¾ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œé‚£å°±æ˜¯æ”¯ä»˜ï¼Œç”¨æˆ·è´­ä¹°å•†å“åæ”¯ä»˜ï¼Œæ”¯ä»˜æ‰£æ¬¾æˆåŠŸï¼Œä½†æ˜¯è¿”å›ç»“æœçš„æ—¶å€™ç½‘ç»œå¼‚å¸¸ï¼Œ æ­¤æ—¶é’±å·²ç»æ‰£äº†ï¼Œç”¨æˆ·å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œæ­¤æ—¶ä¼šè¿›è¡Œç¬¬äºŒæ¬¡æ‰£æ¬¾ï¼Œè¿”å›ç»“æœæˆåŠŸï¼Œç”¨æˆ·æŸ¥è¯¢ä½™é¢å‘ç°å¤šæ‰£é’± äº†ï¼Œæµæ°´è®°å½•ä¹Ÿå˜æˆäº†ä¸¤æ¡ã€‚åœ¨ä»¥å‰çš„å•åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæ•°æ®æ“ä½œæ”¾å…¥äº‹åŠ¡ä¸­å³å¯ï¼Œå‘ç”Ÿé”™è¯¯ ç«‹å³å›æ»šï¼Œä½†æ˜¯å†å“åº”å®¢æˆ·ç«¯çš„æ—¶å€™ä¹Ÿæœ‰å¯èƒ½å‡ºç°ç½‘ç»œä¸­æ–­æˆ–è€…å¼‚å¸¸ç­‰ç­‰</p><h5 id="_9-1-2-æ¶ˆæ¯é‡å¤æ¶ˆè´¹" tabindex="-1"><a class="header-anchor" href="#_9-1-2-æ¶ˆæ¯é‡å¤æ¶ˆè´¹"><span><strong>9.1.2. æ¶ˆæ¯é‡å¤æ¶ˆè´¹</strong></span></a></h5><p>æ¶ˆè´¹è€…åœ¨æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯æ—¶ï¼ŒMQ å·²æŠŠæ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åœ¨ç»™ MQ è¿”å› ack æ—¶ç½‘ç»œä¸­æ–­ï¼Œ æ•… MQ æœªæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ï¼Œè¯¥æ¡æ¶ˆæ¯ä¼šé‡æ–°å‘ç»™å…¶ä»–çš„æ¶ˆè´¹è€…ï¼Œæˆ–è€…åœ¨ç½‘ç»œé‡è¿åå†æ¬¡å‘é€ç»™è¯¥æ¶ˆè´¹è€…ï¼Œä½† å®é™…ä¸Šè¯¥æ¶ˆè´¹è€…å·²æˆåŠŸæ¶ˆè´¹äº†è¯¥æ¡æ¶ˆæ¯ï¼Œé€ æˆæ¶ˆè´¹è€…æ¶ˆè´¹äº†é‡å¤çš„æ¶ˆæ¯ã€‚</p><h5 id="_9-1-3-è§£å†³æ€è·¯" tabindex="-1"><a class="header-anchor" href="#_9-1-3-è§£å†³æ€è·¯"><span><strong>9.1.3. è§£å†³æ€è·¯</strong></span></a></h5><p>MQ æ¶ˆè´¹è€…çš„å¹‚ç­‰æ€§çš„è§£å†³ä¸€èˆ¬ä½¿ç”¨å…¨å±€ ID æˆ–è€…å†™ä¸ªå”¯ä¸€æ ‡è¯†æ¯”å¦‚æ—¶é—´æˆ³ æˆ–è€… UUID æˆ–è€…è®¢å•æ¶ˆè´¹ è€…æ¶ˆè´¹ MQ ä¸­çš„æ¶ˆæ¯ä¹Ÿå¯åˆ©ç”¨ MQ çš„è¯¥ id æ¥åˆ¤æ–­ï¼Œæˆ–è€…å¯æŒ‰è‡ªå·±çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ idï¼Œæ¯æ¬¡æ¶ˆè´¹æ¶ˆ æ¯æ—¶ç”¨è¯¥ id å…ˆåˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦å·²æ¶ˆè´¹è¿‡ã€‚</p><h5 id="_9-1-4-æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ" tabindex="-1"><a class="header-anchor" href="#_9-1-4-æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ"><span><strong>9.1.4. æ¶ˆè´¹ç«¯çš„å¹‚ç­‰æ€§ä¿éšœ</strong></span></a></h5><p>åœ¨æµ·é‡è®¢å•ç”Ÿæˆçš„ä¸šåŠ¡é«˜å³°æœŸï¼Œç”Ÿäº§ç«¯æœ‰å¯èƒ½å°±ä¼šé‡å¤å‘ç”Ÿäº†æ¶ˆæ¯ï¼Œè¿™æ—¶å€™æ¶ˆè´¹ç«¯å°±è¦å®ç°å¹‚ç­‰æ€§ï¼Œ è¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„æ¶ˆæ¯æ°¸è¿œä¸ä¼šè¢«æ¶ˆè´¹å¤šæ¬¡ï¼Œå³ä½¿æˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ ·çš„æ¶ˆæ¯ã€‚ä¸šç•Œä¸»æµçš„å¹‚ç­‰æ€§æœ‰ä¸¤ç§æ“ä½œ:a. å”¯ä¸€ ID+æŒ‡çº¹ç æœºåˆ¶,åˆ©ç”¨æ•°æ®åº“ä¸»é”®å»é‡, b.åˆ©ç”¨ redis çš„åŸå­æ€§å»å®ç°</p><h5 id="_9-1-5-å”¯ä¸€-id-æŒ‡çº¹ç æœºåˆ¶" tabindex="-1"><a class="header-anchor" href="#_9-1-5-å”¯ä¸€-id-æŒ‡çº¹ç æœºåˆ¶"><span><strong>9.1.5. å”¯ä¸€ ID+æŒ‡çº¹ç æœºåˆ¶</strong></span></a></h5><p>æŒ‡çº¹ç :æˆ‘ä»¬çš„ä¸€äº›è§„åˆ™æˆ–è€…æ—¶é—´æˆ³åŠ åˆ«çš„æœåŠ¡ç»™åˆ°çš„å”¯ä¸€ä¿¡æ¯ç ,å®ƒå¹¶ä¸ä¸€å®šæ˜¯æˆ‘ä»¬ç³»ç»Ÿç”Ÿæˆçš„ï¼ŒåŸº æœ¬éƒ½æ˜¯ç”±æˆ‘ä»¬çš„ä¸šåŠ¡è§„åˆ™æ‹¼æ¥è€Œæ¥ï¼Œä½†æ˜¯ä¸€å®šè¦ä¿è¯å”¯ä¸€æ€§ï¼Œç„¶åå°±åˆ©ç”¨æŸ¥è¯¢è¯­å¥è¿›è¡Œåˆ¤æ–­è¿™ä¸ª id æ˜¯å¦å­˜ åœ¨æ•°æ®åº“ä¸­,ä¼˜åŠ¿å°±æ˜¯å®ç°ç®€å•å°±ä¸€ä¸ªæ‹¼æ¥ï¼Œç„¶åæŸ¥è¯¢åˆ¤æ–­æ˜¯å¦é‡å¤ï¼›åŠ£åŠ¿å°±æ˜¯åœ¨é«˜å¹¶å‘æ—¶ï¼Œå¦‚æœæ˜¯å•ä¸ªæ•° æ®åº“å°±ä¼šæœ‰å†™å…¥æ€§èƒ½ç“¶é¢ˆå½“ç„¶ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ†åº“åˆ†è¡¨æå‡æ€§èƒ½ï¼Œä½†ä¹Ÿä¸æ˜¯æˆ‘ä»¬æœ€æ¨èçš„æ–¹å¼ã€‚</p><h5 id="_9-1-6-redis-åŸå­æ€§" tabindex="-1"><a class="header-anchor" href="#_9-1-6-redis-åŸå­æ€§"><span><strong>9.1.6. Redis åŸå­æ€§</strong></span></a></h5><p><strong>åˆ©ç”¨ redis æ‰§è¡Œ setnx å‘½ä»¤ï¼Œå¤©ç„¶å…·æœ‰å¹‚ç­‰æ€§ã€‚ä»è€Œå®ç°ä¸é‡å¤æ¶ˆè´¹</strong></p><h4 id="_9-2-ä¼˜å…ˆçº§é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_9-2-ä¼˜å…ˆçº§é˜Ÿåˆ—"><span><strong>9.2. ä¼˜å…ˆçº§é˜Ÿåˆ—</strong></span></a></h4><h5 id="_9-2-1-ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_9-2-1-ä½¿ç”¨åœºæ™¯"><span><strong>9.2.1. ä½¿ç”¨åœºæ™¯</strong></span></a></h5><p>åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªè®¢å•å‚¬ä»˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„å®¢æˆ·åœ¨å¤©çŒ«ä¸‹çš„è®¢å•,æ·˜å®ä¼šåŠæ—¶å°†è®¢å•æ¨é€ç»™æˆ‘ä»¬ï¼Œå¦‚ æœåœ¨ç”¨æˆ·è®¾å®šçš„æ—¶é—´å†…æœªä»˜æ¬¾é‚£ä¹ˆå°±ä¼šç»™ç”¨æˆ·æ¨é€ä¸€æ¡çŸ­ä¿¡æé†’ï¼Œå¾ˆç®€å•çš„ä¸€ä¸ªåŠŸèƒ½å¯¹å§ï¼Œä½†æ˜¯ï¼Œtmall å•†å®¶å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œè‚¯å®šæ˜¯è¦åˆ†å¤§å®¢æˆ·å’Œå°å®¢æˆ·çš„å¯¹å§ï¼Œæ¯”å¦‚åƒè‹¹æœï¼Œå°ç±³è¿™æ ·å¤§å•†å®¶ä¸€å¹´èµ·ç èƒ½ç»™æˆ‘ä»¬åˆ› é€ å¾ˆå¤§çš„åˆ©æ¶¦ï¼Œæ‰€ä»¥ç†åº”å½“ç„¶ï¼Œä»–ä»¬çš„è®¢å•å¿…é¡»å¾—åˆ°ä¼˜å…ˆå¤„ç†ï¼Œè€Œæ›¾ç»æˆ‘ä»¬çš„åç«¯ç³»ç»Ÿæ˜¯ä½¿ç”¨ redis æ¥å­˜ æ”¾çš„å®šæ—¶è½®è¯¢ï¼Œå¤§å®¶éƒ½çŸ¥é“ redis åªèƒ½ç”¨ List åšä¸€ä¸ªç®€ç®€å•å•çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶ä¸èƒ½å®ç°ä¸€ä¸ªä¼˜å…ˆçº§çš„åœºæ™¯ï¼Œæ‰€ä»¥è®¢å•é‡å¤§äº†åé‡‡ç”¨ RabbitMQ è¿›è¡Œæ”¹é€ å’Œä¼˜åŒ–,å¦‚æœå‘ç°æ˜¯å¤§å®¢æˆ·çš„è®¢å•ç»™ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œ å¦åˆ™å°±æ˜¯é»˜è®¤ä¼˜å…ˆçº§ã€‚</p><h5 id="_9-2-2-å¦‚ä½•æ·»åŠ " tabindex="-1"><a class="header-anchor" href="#_9-2-2-å¦‚ä½•æ·»åŠ "><span><strong>9.2.2. å¦‚ä½•æ·»åŠ </strong></span></a></h5><p>a.æ§åˆ¶å°é¡µé¢æ·»åŠ </p><figure><a href="https://imgse.com/i/pCCytzT" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCytzT.jpg" alt="pCCytzT.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCytzT.jpg</figcaption></figure><p>b.é˜Ÿåˆ—ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-max-priority&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><a href="https://imgse.com/i/pCCyYWV" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCyYWV.jpg" alt="pCCyYWV.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCyYWV.jpg</figcaption></figure><p>c.æ¶ˆæ¯ä¸­ä»£ç æ·»åŠ ä¼˜å…ˆçº§</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> 
<span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">priority</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>d.æ³¨æ„äº‹é¡¹</strong></p><p>è¦è®©é˜Ÿåˆ—å®ç°ä¼˜å…ˆçº§éœ€è¦åšçš„äº‹æƒ…æœ‰å¦‚ä¸‹äº‹æƒ…:é˜Ÿåˆ—éœ€è¦è®¾ç½®ä¸ºä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Œæ¶ˆæ¯éœ€è¦è®¾ç½®æ¶ˆæ¯çš„ä¼˜å…ˆ çº§ï¼Œæ¶ˆè´¹è€…éœ€è¦ç­‰å¾…æ¶ˆæ¯å·²ç»å‘é€åˆ°é˜Ÿåˆ—ä¸­æ‰å»æ¶ˆè´¹å› ä¸ºï¼Œè¿™æ ·æ‰æœ‰æœºä¼šå¯¹æ¶ˆæ¯è¿›è¡Œæ’åº</p><h5 id="_9-2-3-å®æˆ˜" tabindex="-1"><a class="header-anchor" href="#_9-2-3-å®æˆ˜"><span><strong>9.2.3. å®æˆ˜</strong></span></a></h5><p>a.æ¶ˆæ¯ç”Ÿäº§è€…</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Producer</span> <span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span><span class="token operator">=</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
 <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">RabbitMqUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//ç»™æ¶ˆæ¯èµ‹äºˆä¸€ä¸ª priority å±æ€§</span>
 <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> 
<span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">priority</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span><span class="token number">11</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">&quot;info&quot;</span><span class="token operator">+</span>i<span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> properties<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
 channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å‘é€æ¶ˆæ¯å®Œæˆ:&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>b.æ¶ˆæ¯æ¶ˆè´¹è€…</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Consumer</span> <span class="token punctuation">{</span>
 <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">QUEUE_NAME</span><span class="token operator">=</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">;</span>
 <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
 <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token class-name">RabbitMqUtils</span><span class="token punctuation">.</span><span class="token function">getChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//è®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§ä¼˜å…ˆçº§ æœ€å¤§å¯ä»¥è®¾ç½®åˆ° 255 å®˜ç½‘æ¨è 1-10 å¦‚æœè®¾ç½®å¤ªé«˜æ¯”è¾ƒåƒå†…å­˜å’Œ CPU</span>
 <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-max-priority&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆè´¹è€…å¯åŠ¨ç­‰å¾…æ¶ˆè´¹......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">DeliverCallback</span> deliverCallback<span class="token operator">=</span><span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
 <span class="token class-name">String</span> receivedMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¥æ”¶åˆ°æ¶ˆæ¯:&quot;</span><span class="token operator">+</span>receivedMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span><span class="token constant">QUEUE_NAME</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>deliverCallback<span class="token punctuation">,</span><span class="token punctuation">(</span>consumerTag<span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
 <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ¶ˆè´¹è€…æ— æ³•æ¶ˆè´¹æ¶ˆæ¯æ—¶è°ƒç”¨ï¼Œå¦‚é˜Ÿåˆ—è¢«åˆ é™¤&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_9-3-æƒ°æ€§é˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_9-3-æƒ°æ€§é˜Ÿåˆ—"><span><strong>9.3. æƒ°æ€§é˜Ÿåˆ—</strong></span></a></h4><h5 id="_9-3-1-ä½¿ç”¨åœºæ™¯" tabindex="-1"><a class="header-anchor" href="#_9-3-1-ä½¿ç”¨åœºæ™¯"><span><strong>9.3.1. ä½¿ç”¨åœºæ™¯</strong></span></a></h5><p>RabbitMQ ä» 3.6.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥äº†æƒ°æ€§é˜Ÿåˆ—çš„æ¦‚å¿µã€‚æƒ°æ€§é˜Ÿåˆ—ä¼šå°½å¯èƒ½çš„å°†æ¶ˆæ¯å­˜å…¥ç£ç›˜ä¸­ï¼Œè€Œåœ¨æ¶ˆ è´¹è€…æ¶ˆè´¹åˆ°ç›¸åº”çš„æ¶ˆæ¯æ—¶æ‰ä¼šè¢«åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå®ƒçš„ä¸€ä¸ªé‡è¦çš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿæ”¯æŒæ›´é•¿çš„é˜Ÿåˆ—ï¼Œå³æ”¯æŒ æ›´å¤šçš„æ¶ˆæ¯å­˜å‚¨ã€‚å½“æ¶ˆè´¹è€…ç”±äºå„ç§å„æ ·çš„åŸå› (æ¯”å¦‚æ¶ˆè´¹è€…ä¸‹çº¿ã€å®•æœºäº¦æˆ–è€…æ˜¯ç”±äºç»´æŠ¤è€Œå…³é—­ç­‰)è€Œè‡´ ä½¿é•¿æ—¶é—´å†…ä¸èƒ½æ¶ˆè´¹æ¶ˆæ¯é€ æˆå †ç§¯æ—¶ï¼Œæƒ°æ€§é˜Ÿåˆ—å°±å¾ˆæœ‰å¿…è¦äº†ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° RabbitMQ çš„æ—¶å€™ï¼Œé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä¼šå°½å¯èƒ½çš„å­˜å‚¨åœ¨å†…å­˜ä¹‹ä¸­ï¼Œ è¿™æ ·å¯ä»¥æ›´åŠ å¿«é€Ÿçš„å°†æ¶ˆæ¯å‘é€ç»™æ¶ˆè´¹è€…ã€‚å³ä½¿æ˜¯æŒä¹…åŒ–çš„æ¶ˆæ¯ï¼Œåœ¨è¢«å†™å…¥ç£ç›˜çš„åŒæ—¶ä¹Ÿä¼šåœ¨å†…å­˜ä¸­é©»ç•™ ä¸€ä»½å¤‡ä»½ã€‚å½“ RabbitMQ éœ€è¦é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œä¼šå°†å†…å­˜ä¸­çš„æ¶ˆæ¯æ¢é¡µè‡³ç£ç›˜ä¸­ï¼Œè¿™ä¸ªæ“ä½œä¼šè€—è´¹è¾ƒé•¿çš„ æ—¶é—´ï¼Œä¹Ÿä¼šé˜»å¡é˜Ÿåˆ—çš„æ“ä½œï¼Œè¿›è€Œæ— æ³•æ¥æ”¶æ–°çš„æ¶ˆæ¯ã€‚è™½ç„¶ RabbitMQ çš„å¼€å‘è€…ä»¬ä¸€ç›´åœ¨å‡çº§ç›¸å…³çš„ç®—æ³•ï¼Œ ä½†æ˜¯æ•ˆæœå§‹ç»ˆä¸å¤ªç†æƒ³ï¼Œå°¤å…¶æ˜¯åœ¨æ¶ˆæ¯é‡ç‰¹åˆ«å¤§çš„æ—¶å€™ã€‚</p><h5 id="_9-3-2-ä¸¤ç§æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#_9-3-2-ä¸¤ç§æ¨¡å¼"><span>**9.3.2. ä¸¤ç§æ¨¡å¼ **</span></a></h5><p>é˜Ÿåˆ—å…·å¤‡ä¸¤ç§æ¨¡å¼ï¼šdefault å’Œ lazyã€‚é»˜è®¤çš„ä¸º default æ¨¡å¼ï¼Œåœ¨ 3.6.0 ä¹‹å‰çš„ç‰ˆæœ¬æ— éœ€åšä»»ä½•å˜æ›´ã€‚lazy æ¨¡å¼å³ä¸ºæƒ°æ€§é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ channel.queueDeclare æ–¹æ³•çš„æ—¶å€™åœ¨å‚æ•°ä¸­è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Policy çš„æ–¹å¼è®¾ç½®ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆ Policy çš„æ–¹å¼å…·å¤‡æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚ å¦‚æœè¦é€šè¿‡å£°æ˜çš„æ–¹å¼æ”¹å˜å·²æœ‰é˜Ÿåˆ—çš„æ¨¡å¼çš„è¯ï¼Œé‚£ä¹ˆåªèƒ½å…ˆåˆ é™¤é˜Ÿåˆ—ï¼Œç„¶åå†é‡æ–°å£°æ˜ä¸€ä¸ªæ–°çš„ã€‚</p><p>åœ¨é˜Ÿåˆ—å£°æ˜çš„æ—¶å€™å¯ä»¥é€šè¿‡â€œx-queue-modeâ€å‚æ•°æ¥è®¾ç½®é˜Ÿåˆ—çš„æ¨¡å¼ï¼Œå–å€¼ä¸ºâ€œdefaultâ€å’Œâ€œlazyâ€ã€‚ä¸‹é¢ç¤º ä¾‹ä¸­æ¼”ç¤ºäº†ä¸€ä¸ªæƒ°æ€§é˜Ÿåˆ—çš„å£°æ˜ç»†èŠ‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
args<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;x-queue-mode&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lazy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token string">&quot;myqueue&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_9-3-3-å†…å­˜å¼€é”€å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#_9-3-3-å†…å­˜å¼€é”€å¯¹æ¯”"><span><strong>9.3.3. å†…å­˜å¼€é”€å¯¹æ¯”</strong></span></a></h5><figure><a href="https://imgse.com/i/pCCy4wd" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCy4wd.jpg" alt="pCCy4wd.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCy4wd.jpg</figcaption></figure><p>åœ¨å‘é€ 1 ç™¾ä¸‡æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯å¤§æ¦‚å  1KB çš„æƒ…å†µä¸‹ï¼Œæ™®é€šé˜Ÿåˆ—å ç”¨å†…å­˜æ˜¯ 1.2GBï¼Œè€Œæƒ°æ€§é˜Ÿåˆ—ä»…ä»… å ç”¨ 1.5MB</p><h3 id="_10ã€rabbitmq-é›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_10ã€rabbitmq-é›†ç¾¤"><span><strong>10ã€RabbitMQ é›†ç¾¤</strong></span></a></h3><h4 id="_10-1-clustering" tabindex="-1"><a class="header-anchor" href="#_10-1-clustering"><span><strong>10.1. clustering</strong></span></a></h4><h5 id="_10-1-1-ä½¿ç”¨é›†ç¾¤çš„åŸå› " tabindex="-1"><a class="header-anchor" href="#_10-1-1-ä½¿ç”¨é›†ç¾¤çš„åŸå› "><span><strong>10.1.1. ä½¿ç”¨é›†ç¾¤çš„åŸå› </strong></span></a></h5><p>æœ€å¼€å§‹æˆ‘ä»¬ä»‹ç»äº†å¦‚ä½•å®‰è£…åŠè¿è¡Œ RabbitMQ æœåŠ¡ï¼Œä¸è¿‡è¿™äº›æ˜¯å•æœºç‰ˆçš„ï¼Œæ— æ³•æ»¡è¶³ç›®å‰çœŸå®åº”ç”¨çš„ è¦æ±‚ã€‚å¦‚æœ RabbitMQ æœåŠ¡å™¨é‡åˆ°å†…å­˜å´©æºƒã€æœºå™¨æ‰ç”µæˆ–è€…ä¸»æ¿æ•…éšœç­‰æƒ…å†µï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿå•å° RabbitMQ æœåŠ¡å™¨å¯ä»¥æ»¡è¶³æ¯ç§’ 1000 æ¡æ¶ˆæ¯çš„ååé‡ï¼Œé‚£ä¹ˆå¦‚æœåº”ç”¨éœ€è¦ RabbitMQ æœåŠ¡æ»¡è¶³æ¯ç§’ 10 ä¸‡æ¡æ¶ˆæ¯çš„ååé‡å‘¢ï¼Ÿè´­ä¹°æ˜‚è´µçš„æœåŠ¡å™¨æ¥å¢å¼ºå•æœº RabbitMQ åŠ¡çš„æ€§èƒ½æ˜¾å¾—æ‰è¥Ÿè§è‚˜ï¼Œæ­å»ºä¸€ä¸ª RabbitMQ é›†ç¾¤æ‰æ˜¯ è§£å†³å®é™…é—®é¢˜çš„å…³é”®.</p><h5 id="_10-1-2-æ­å»ºæ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_10-1-2-æ­å»ºæ­¥éª¤"><span><strong>10.1.2. æ­å»ºæ­¥éª¤</strong></span></a></h5><p><strong>1.ä¿®æ”¹ 3 å°æœºå™¨çš„ä¸»æœºåç§°</strong></p><blockquote><p><strong>vim /etc/hostname</strong></p></blockquote><p><strong>2.é…ç½®å„ä¸ªèŠ‚ç‚¹çš„ hosts æ–‡ä»¶ï¼Œè®©å„ä¸ªèŠ‚ç‚¹éƒ½èƒ½äº’ç›¸è¯†åˆ«å¯¹æ–¹</strong></p><blockquote><p><strong>vim /etc/hosts</strong></p><p>10.211.55.74 node1</p><p>10.211.55.75 node2</p><p>10.211.55.76 node3</p></blockquote><p><strong>3.ä»¥ç¡®ä¿å„ä¸ªèŠ‚ç‚¹çš„ cookie æ–‡ä»¶ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªå€¼</strong></p><blockquote><p><strong>åœ¨ node1 ä¸Šæ‰§è¡Œè¿œç¨‹æ“ä½œå‘½ä»¤</strong></p><p><strong>scp /var/lib/rabbitmq/.erlang.cookie root@node2:/var/lib/rabbitmq/.erlang.cookie</strong></p><p><strong>scp /var/lib/rabbitmq/.erlang.cookie root@node3:/var/lib/rabbitmq/.erlang.cookie</strong></p></blockquote><p><strong>4.å¯åŠ¨ RabbitMQ æœåŠ¡,é¡ºå¸¦å¯åŠ¨ Erlang è™šæ‹Ÿæœºå’Œ RbbitMQ åº”ç”¨æœåŠ¡(åœ¨ä¸‰å°èŠ‚ç‚¹ä¸Šåˆ†åˆ«æ‰§è¡Œä»¥ ä¸‹å‘½ä»¤)</strong></p><blockquote><p><strong>rabbitmq-server -detached</strong></p></blockquote><p><strong>5.åœ¨èŠ‚ç‚¹ 2 æ‰§è¡Œ</strong></p><blockquote><p><strong>rabbitmqctl stop_app</strong></p><p><strong>(rabbitmqctl stop ä¼šå°† Erlang è™šæ‹Ÿæœºå…³é—­ï¼Œrabbitmqctl stop_app åªå…³é—­ RabbitMQ æœåŠ¡)</strong></p><p><strong>rabbitmqctl reset</strong></p><p><strong>rabbitmqctl join_cluster rabbit@node1</strong></p><p><strong>rabbitmqctl start_app(åªå¯åŠ¨åº”ç”¨æœåŠ¡)</strong></p></blockquote><p><strong>6.åœ¨èŠ‚ç‚¹ 3 æ‰§è¡Œ</strong></p><blockquote><p><strong>rabbitmqctl stop_app</strong></p><p><strong>rabbitmqctl reset</strong></p><p><strong>rabbitmqctl join_cluster rabbit@node2</strong></p><p><strong>rabbitmqctl start_app</strong></p></blockquote><p><strong>7.é›†ç¾¤çŠ¶æ€</strong></p><blockquote><p><strong>rabbitmqctl cluster_status</strong></p></blockquote><p><strong>8.éœ€è¦é‡æ–°è®¾ç½®ç”¨æˆ·</strong></p><blockquote><p><strong>åˆ›å»ºè´¦å·</strong></p><ul><li>rabbitmqctl add_user admin 123</li></ul><p><strong>è®¾ç½®ç”¨æˆ·è§’è‰²</strong></p><ul><li><strong>rabbitmqctl set_user_tags admin administrator</strong></li></ul><p><strong>è®¾ç½®ç”¨æˆ·æƒé™</strong></p><ul><li><strong>rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.<em>&quot; &quot;.</em>&quot; &quot;.*&quot;</strong></li></ul></blockquote><p><strong>9.è§£é™¤é›†ç¾¤èŠ‚ç‚¹(node2 å’Œ node3 æœºå™¨åˆ†åˆ«æ‰§è¡Œ)</strong></p><blockquote><ul><li><strong>rabbitmqctl stop_app</strong></li><li><strong>rabbitmqctl reset</strong></li><li><strong>rabbitmqctl start_app</strong></li><li><strong>rabbitmqctl cluster_status</strong></li><li><strong>rabbitmqctl forget_cluster_node rabbit@node2(node1 æœºå™¨ä¸Šæ‰§è¡Œ)</strong></li></ul></blockquote><h4 id="_10-2-é•œåƒé˜Ÿåˆ—" tabindex="-1"><a class="header-anchor" href="#_10-2-é•œåƒé˜Ÿåˆ—"><span><strong>10.2. é•œåƒé˜Ÿåˆ—</strong></span></a></h4><h5 id="_10-2-1-ä½¿ç”¨é•œåƒçš„åŸå› " tabindex="-1"><a class="header-anchor" href="#_10-2-1-ä½¿ç”¨é•œåƒçš„åŸå› "><span><strong>10.2.1. ä½¿ç”¨é•œåƒçš„åŸå› </strong></span></a></h5><p>å¦‚æœ RabbitMQ é›†ç¾¤ä¸­åªæœ‰ä¸€ä¸ª Broker èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„å¤±æ•ˆå°†å¯¼è‡´æ•´ä½“æœåŠ¡çš„ä¸´æ—¶æ€§ä¸å¯ç”¨ï¼Œå¹¶ ä¸”ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯çš„ä¸¢å¤±ã€‚å¯ä»¥å°†æ‰€æœ‰æ¶ˆæ¯éƒ½è®¾ç½®ä¸ºæŒä¹…åŒ–ï¼Œå¹¶ä¸”å¯¹åº”é˜Ÿåˆ—çš„durableå±æ€§ä¹Ÿè®¾ç½®ä¸ºtrueï¼Œ ä½†æ˜¯è¿™æ ·ä»ç„¶æ— æ³•é¿å…ç”±äºç¼“å­˜å¯¼è‡´çš„é—®é¢˜ï¼šå› ä¸ºæ¶ˆæ¯åœ¨å‘é€ä¹‹åå’Œè¢«å†™å…¥ç£ç›˜äº•æ‰§è¡Œåˆ·ç›˜åŠ¨ä½œä¹‹é—´å­˜åœ¨ ä¸€ä¸ªçŸ­æš‚å´ä¼šäº§ç”Ÿé—®é¢˜çš„æ—¶é—´çª—ã€‚é€šè¿‡ publisherconfirm æœºåˆ¶èƒ½å¤Ÿç¡®ä¿å®¢æˆ·ç«¯çŸ¥é“å“ªäº›æ¶ˆæ¯å·±ç»å­˜å…¥ç£ç›˜ï¼Œ å°½ç®¡å¦‚æ­¤ï¼Œä¸€èˆ¬ä¸å¸Œæœ›é‡åˆ°å› å•ç‚¹æ•…éšœå¯¼è‡´çš„æœåŠ¡ä¸å¯ç”¨ã€‚</p><p>å¼•å…¥é•œåƒé˜Ÿåˆ—(Mirror Queue)çš„æœºåˆ¶ï¼Œå¯ä»¥å°†é˜Ÿåˆ—é•œåƒåˆ°é›†ç¾¤ä¸­çš„å…¶ä»– Broker èŠ‚ç‚¹ä¹‹ä¸Šï¼Œå¦‚æœé›†ç¾¤ä¸­ çš„ä¸€ä¸ªèŠ‚ç‚¹å¤±æ•ˆäº†ï¼Œé˜Ÿåˆ—èƒ½è‡ªåŠ¨åœ°åˆ‡æ¢åˆ°é•œåƒä¸­çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><h5 id="_10-2-2-æ­å»ºæ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_10-2-2-æ­å»ºæ­¥éª¤"><span><strong>10.2.2. æ­å»ºæ­¥éª¤</strong></span></a></h5><p><strong>1.å¯åŠ¨ä¸‰å°é›†ç¾¤èŠ‚ç‚¹</strong></p><p><strong>2.éšä¾¿æ‰¾ä¸€ä¸ªèŠ‚ç‚¹æ·»åŠ  policy</strong></p><figure><a href="https://imgse.com/i/pCC2d91" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC2d91.jpg" alt="pCC2d91.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC2d91.jpg</figcaption></figure><p><strong>3.åœ¨ node1 ä¸Šåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œé˜Ÿåˆ—å­˜åœ¨é•œåƒé˜Ÿåˆ—</strong></p><figure><a href="https://imgse.com/i/pCC2UhR" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC2UhR.jpg" alt="pCC2UhR.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC2UhR.jpg</figcaption></figure><p><strong>4.åœæ‰ node1 ä¹‹åå‘ç° node2 æˆä¸ºé•œåƒé˜Ÿåˆ—</strong></p><figure><a href="https://imgse.com/i/pCC2NN9" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC2NN9.jpg" alt="pCC2NN9.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC2NN9.jpg</figcaption></figure><p><strong>5.å°±ç®—æ•´ä¸ªé›†ç¾¤åªå‰©ä¸‹ä¸€å°æœºå™¨äº† ä¾ç„¶èƒ½æ¶ˆè´¹é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯</strong></p><p>è¯´æ˜é˜Ÿåˆ—é‡Œé¢çš„æ¶ˆæ¯è¢«é•œåƒé˜Ÿåˆ—ä¼ é€’åˆ°ç›¸åº”æœºå™¨é‡Œé¢äº†</p><h4 id="_10-3-haproxy-keepalive-å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#_10-3-haproxy-keepalive-å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡"><span><strong>10.3. Haproxy+Keepalive å®ç°é«˜å¯ç”¨è´Ÿè½½å‡è¡¡</strong></span></a></h4><h5 id="_10-3-1-æ•´ä½“æ¶æ„å›¾" tabindex="-1"><a class="header-anchor" href="#_10-3-1-æ•´ä½“æ¶æ„å›¾"><span><strong>10.3.1. æ•´ä½“æ¶æ„å›¾</strong></span></a></h5><figure><a href="https://imgse.com/i/pCCRKVe" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCRKVe.jpg" alt="pCCRKVe.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCRKVe.jpg</figcaption></figure><h5 id="_10-3-2-haproxy-å®ç°è´Ÿè½½å‡è¡¡" tabindex="-1"><a class="header-anchor" href="#_10-3-2-haproxy-å®ç°è´Ÿè½½å‡è¡¡"><span>**10.3.2. Haproxy å®ç°è´Ÿè½½å‡è¡¡ **</span></a></h5><p>HAProxy æä¾›é«˜å¯ç”¨æ€§ã€è´Ÿè½½å‡è¡¡åŠåŸºäº TCPHTTP åº”ç”¨çš„ä»£ç†ï¼Œæ”¯æŒè™šæ‹Ÿä¸»æœºï¼Œå®ƒæ˜¯å…è´¹ã€å¿«é€Ÿå¹¶ ä¸”å¯é çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ Twitter,Reddit,StackOverflow,GitHub åœ¨å†…çš„å¤šå®¶çŸ¥åäº’è”ç½‘å…¬å¸åœ¨ä½¿ç”¨ã€‚ HAProxy å®ç°äº†ä¸€ç§äº‹ä»¶é©±åŠ¨ã€å•ä¸€è¿›ç¨‹æ¨¡å‹ï¼Œæ­¤æ¨¡å‹æ”¯æŒéå¸¸å¤§çš„äº•å‘è¿æ¥æ•°ã€‚</p><p>æ‰©å±• nginx,lvs,haproxy ä¹‹é—´çš„åŒºåˆ«: http://www.ha97.com/5646.html</p><h5 id="_10-3-3-æ­å»ºæ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_10-3-3-æ­å»ºæ­¥éª¤"><span><strong>10.3.3. æ­å»ºæ­¥éª¤</strong></span></a></h5><p><strong>1.ä¸‹è½½ haproxy(åœ¨ node1 å’Œ node2)</strong></p><blockquote><p><strong>yum -y install haproxy</strong></p></blockquote><p><strong>2.ä¿®æ”¹ node1 å’Œ node2 çš„ haproxy.cfg</strong></p><blockquote><p><strong>vim /etc/haproxy/haproxy.cfg</strong></p><p><strong>éœ€è¦ä¿®æ”¹çº¢è‰² IP ä¸ºå½“å‰æœºå™¨ IP</strong></p><figure><a href="https://imgse.com/i/pCCRnbD" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCRnbD.jpg" alt="pCCRnbD.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCRnbD.jpg</figcaption></figure></blockquote><p><strong>3.åœ¨ä¸¤å°èŠ‚ç‚¹å¯åŠ¨ haproxy</strong></p><blockquote><p><strong>haproxy -f /etc/haproxy/haproxy.cfg</strong></p><p><strong>ps -ef | grep haproxy</strong></p></blockquote><p><strong>4.è®¿é—®åœ°å€</strong></p><blockquote><p><strong>http://10.211.55.71:8888/stats</strong></p></blockquote><h5 id="_10-3-4-keepalived-å®ç°åŒæœº-ä¸»å¤‡-çƒ­å¤‡" tabindex="-1"><a class="header-anchor" href="#_10-3-4-keepalived-å®ç°åŒæœº-ä¸»å¤‡-çƒ­å¤‡"><span><strong>10.3.4. Keepalived å®ç°åŒæœº(ä¸»å¤‡)çƒ­å¤‡</strong></span></a></h5><p>è¯•æƒ³å¦‚æœå‰é¢é…ç½®çš„ HAProxy ä¸»æœºçªç„¶å®•æœºæˆ–è€…ç½‘å¡å¤±æ•ˆï¼Œé‚£ä¹ˆè™½ç„¶ RbbitMQ é›†ç¾¤æ²¡æœ‰ä»»ä½•æ•…éšœä½†æ˜¯ å¯¹äºå¤–ç•Œçš„å®¢æˆ·ç«¯æ¥è¯´æ‰€æœ‰çš„è¿æ¥éƒ½ä¼šè¢«æ–­å¼€ç»“æœå°†æ˜¯ç¾éš¾æ€§çš„ä¸ºäº†ç¡®ä¿è´Ÿè½½å‡è¡¡æœåŠ¡çš„å¯é æ€§åŒæ ·æ˜¾å¾— ååˆ†é‡è¦ï¼Œè¿™é‡Œå°±è¦å¼•å…¥ Keepalived å®ƒèƒ½å¤Ÿé€šè¿‡è‡ªèº«å¥åº·æ£€æŸ¥ã€èµ„æºæ¥ç®¡åŠŸèƒ½åšé«˜å¯ç”¨(åŒæœºçƒ­å¤‡)ï¼Œå®ç° æ•…éšœè½¬ç§».</p><h5 id="_10-3-5-æ­å»ºæ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_10-3-5-æ­å»ºæ­¥éª¤"><span><strong>10.3.5. æ­å»ºæ­¥éª¤</strong></span></a></h5><p><strong>1.ä¸‹è½½ keepalived</strong></p><blockquote><p><strong>yum -y install keepalived</strong></p></blockquote><p><strong>2.èŠ‚ç‚¹ node1 é…ç½®æ–‡ä»¶</strong></p><blockquote><p><strong>vim /etc/keepalived/keepalived.conf</strong></p><p><strong>æŠŠèµ„æ–™é‡Œé¢çš„ keepalived.conf ä¿®æ”¹ä¹‹åæ›¿æ¢</strong></p></blockquote><p><strong>3.èŠ‚ç‚¹ node2 é…ç½®æ–‡ä»¶</strong></p><blockquote><p><strong>éœ€è¦ä¿®æ”¹ global_defs çš„ router_id,å¦‚:nodeB</strong></p><p><strong>å…¶æ¬¡è¦ä¿®æ”¹ vrrp_instance_VI ä¸­ state ä¸º&quot;BACKUP&quot;ï¼›</strong></p><p><strong>æœ€åè¦å°† priority è®¾ç½®ä¸ºå°äº 100 çš„å€¼</strong></p></blockquote><p><strong>4.æ·»åŠ  haproxy_chk.sh</strong></p><blockquote><p><strong>(ä¸ºäº†é˜²æ­¢ HAProxy æœåŠ¡æŒ‚æ‰ä¹‹å Keepalived è¿˜åœ¨æ­£å¸¸å·¥ä½œè€Œæ²¡æœ‰åˆ‡æ¢åˆ° Backup ä¸Šï¼Œæ‰€ä»¥ è¿™é‡Œéœ€è¦ç¼–å†™ä¸€ä¸ªè„šæœ¬æ¥æ£€æµ‹ HAProxy åŠ¡çš„çŠ¶æ€,å½“ HAProxy æœåŠ¡æŒ‚æ‰ä¹‹åè¯¥è„šæœ¬ä¼šè‡ªåŠ¨é‡å¯ HAProxy çš„æœåŠ¡ï¼Œå¦‚æœä¸æˆåŠŸåˆ™å…³é—­ Keepalived æœåŠ¡ï¼Œè¿™æ ·ä¾¿å¯ä»¥åˆ‡æ¢åˆ° Backup ç»§ç»­å·¥ä½œ)</strong></p><p><strong>vim /etc/keepalived/haproxy_chk.sh(å¯ä»¥ç›´æ¥ä¸Šä¼ æ–‡ä»¶)</strong></p><p><strong>ä¿®æ”¹æƒé™ chmod 777 /etc/keepalived/haproxy_chk.sh</strong></p></blockquote><p><strong>5.å¯åŠ¨ keepalive å‘½ä»¤(node1 å’Œ node2 å¯åŠ¨)</strong></p><blockquote><p><strong>systemctl start keepalived</strong></p></blockquote><p><strong>6.è§‚å¯Ÿ Keepalived çš„æ—¥å¿—</strong></p><blockquote><p><strong>tail -f /var/log/messages -n 200</strong></p></blockquote><p><strong>7.è§‚å¯Ÿæœ€æ–°æ·»åŠ çš„ vip</strong></p><blockquote><p><strong>ip add show</strong></p></blockquote><p><strong>8.node1 æ¨¡æ‹Ÿ keepalived å…³é—­çŠ¶æ€</strong></p><blockquote><p><strong>systemctl stop keepalived</strong></p></blockquote><p><strong>9.ä½¿ç”¨ vip åœ°å€æ¥è®¿é—® rabbitmq é›†ç¾¤</strong></p><h4 id="_10-4-federation-exchange" tabindex="-1"><a class="header-anchor" href="#_10-4-federation-exchange"><span><strong>10.4. Federation Exchange</strong></span></a></h4><h5 id="_10-4-1-ä½¿ç”¨å®ƒçš„åŸå› " tabindex="-1"><a class="header-anchor" href="#_10-4-1-ä½¿ç”¨å®ƒçš„åŸå› "><span><strong>10.4.1. ä½¿ç”¨å®ƒçš„åŸå› </strong></span></a></h5><p>(broker åŒ—äº¬)ï¼Œ(broker æ·±åœ³)å½¼æ­¤ä¹‹é—´ç›¸è·ç”šè¿œï¼Œç½‘ç»œå»¶è¿Ÿæ˜¯ä¸€ä¸ªä¸å¾—ä¸é¢å¯¹çš„é—®é¢˜ã€‚æœ‰ä¸€ä¸ªåœ¨åŒ—äº¬ çš„ä¸šåŠ¡(Client åŒ—äº¬) éœ€è¦è¿æ¥(broker åŒ—äº¬)ï¼Œå‘å…¶ä¸­çš„äº¤æ¢å™¨ exchangeA å‘é€æ¶ˆæ¯ï¼Œæ­¤æ—¶çš„ç½‘ç»œå»¶è¿Ÿå¾ˆå°ï¼Œ (Client åŒ—äº¬)å¯ä»¥è¿…é€Ÿå°†æ¶ˆæ¯å‘é€è‡³ exchangeA ä¸­ï¼Œå°±ç®—åœ¨å¼€å¯äº† publisherconfirm æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„ æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¿…é€Ÿæ”¶åˆ°ç¡®è®¤ä¿¡æ¯ã€‚æ­¤æ—¶åˆæœ‰ä¸ªåœ¨æ·±åœ³çš„ä¸šåŠ¡(Client æ·±åœ³)éœ€è¦å‘ exchangeA å‘é€æ¶ˆæ¯ï¼Œ é‚£ä¹ˆ(Client æ·±åœ³) (broker åŒ—äº¬)ä¹‹é—´æœ‰å¾ˆå¤§çš„ç½‘ç»œå»¶è¿Ÿï¼Œ(Client æ·±åœ³) å°†å‘é€æ¶ˆæ¯è‡³ exchangeA ä¼šç»å†ä¸€ å®šçš„å»¶è¿Ÿï¼Œå°¤å…¶æ˜¯åœ¨å¼€å¯äº† publisherconfirm æœºåˆ¶æˆ–è€…äº‹åŠ¡æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œ(Client æ·±åœ³) ä¼šç­‰å¾…å¾ˆé•¿çš„å»¶ è¿Ÿæ—¶é—´æ¥æ¥æ”¶(broker åŒ—äº¬)çš„ç¡®è®¤ä¿¡æ¯ï¼Œè¿›è€Œå¿…ç„¶é€ æˆè¿™æ¡å‘é€çº¿ç¨‹çš„æ€§èƒ½é™ä½ï¼Œç”šè‡³é€ æˆä¸€å®šç¨‹åº¦ä¸Šçš„ é˜»å¡ã€‚</p><p>å°†ä¸šåŠ¡(Client æ·±åœ³)éƒ¨ç½²åˆ°åŒ—äº¬çš„æœºæˆ¿å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ(Client æ·±åœ³)è°ƒç”¨çš„å¦äº›æœåŠ¡éƒ½éƒ¨ ç½²åœ¨æ·±åœ³ï¼Œé‚£ä¹ˆåˆä¼šå¼•å‘æ–°çš„æ—¶å»¶é—®é¢˜ï¼Œæ€»ä¸è§å¾—å°†æ‰€æœ‰ä¸šåŠ¡å…¨éƒ¨éƒ¨ç½²åœ¨ä¸€ä¸ªæœºæˆ¿ï¼Œé‚£ä¹ˆå®¹ç¾åˆä½•ä»¥å®ç°ï¼Ÿ è¿™é‡Œä½¿ç”¨ Federation æ’ä»¶å°±å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜.</p><figure><a href="https://imgse.com/i/pCC4BwT" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC4BwT.jpg" alt="pCC4BwT.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC4BwT.jpg</figcaption></figure><h5 id="_10-4-2-æ­å»ºæ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_10-4-2-æ­å»ºæ­¥éª¤"><span><strong>10.4.2. æ­å»ºæ­¥éª¤</strong></span></a></h5><p><strong>1.éœ€è¦ä¿è¯æ¯å°èŠ‚ç‚¹å•ç‹¬è¿è¡Œ</strong></p><p><strong>2.åœ¨æ¯å°æœºå™¨ä¸Šå¼€å¯ federation ç›¸å…³æ’ä»¶</strong></p><blockquote><p><strong>rabbitmq-plugins enable rabbitmq_federation</strong></p><p><strong>rabbitmq-plugins enable rabbitmq_federation_management</strong></p><figure><a href="https://imgse.com/i/pCC4dO0" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC4dO0.jpg" alt="pCC4dO0.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC4dO0.jpg</figcaption></figure></blockquote><p><strong>3.åŸç†å›¾(å…ˆè¿è¡Œ consumer åœ¨ node2 åˆ›å»º fed_exchange)</strong></p><figure><a href="https://imgse.com/i/pCC4DTU" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC4DTU.jpg" alt="pCC4DTU.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC4DTU.jpg</figcaption></figure><p><strong>4.åœ¨ downstream(node2)é…ç½® upstream(node1)</strong></p><figure><a href="https://imgse.com/i/pCC40mV" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC40mV.jpg" alt="pCC40mV.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC40mV.jpg</figcaption></figure><p><strong>4.æ·»åŠ  policy</strong></p><figure><a href="https://imgse.com/i/pCC4skF" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC4skF.jpg" alt="pCC4skF.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC4skF.jpg</figcaption></figure><p><strong>5.æˆåŠŸçš„å‰æ</strong></p><figure><a href="https://imgse.com/i/pCC4ayq" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCC4ayq.jpg" alt="pCC4ayq.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCC4ayq.jpg</figcaption></figure><h4 id="_10-5-federation-queue" tabindex="-1"><a class="header-anchor" href="#_10-5-federation-queue"><span><strong>10.5. Federation Queue</strong></span></a></h4><h5 id="_10-5-1-ä½¿ç”¨å®ƒçš„åŸå› " tabindex="-1"><a class="header-anchor" href="#_10-5-1-ä½¿ç”¨å®ƒçš„åŸå› "><span><strong>10.5.1. ä½¿ç”¨å®ƒçš„åŸå› </strong></span></a></h5><p>è”é‚¦é˜Ÿåˆ—å¯ä»¥åœ¨å¤šä¸ª Broker èŠ‚ç‚¹(æˆ–è€…é›†ç¾¤)ä¹‹é—´ä¸ºå•ä¸ªé˜Ÿåˆ—æä¾›å‡è¡¡è´Ÿè½½çš„åŠŸèƒ½ã€‚ä¸€ä¸ªè”é‚¦é˜Ÿåˆ—å¯ä»¥ è¿æ¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸Šæ¸¸é˜Ÿåˆ—(upstream queue)ï¼Œå¹¶ä»è¿™äº›ä¸Šæ¸¸é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ä»¥æ»¡è¶³æœ¬åœ°æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯ çš„éœ€æ±‚ã€‚</p><h5 id="_10-5-2-æ­å»ºæ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_10-5-2-æ­å»ºæ­¥éª¤"><span><strong>10.5.2. æ­å»ºæ­¥éª¤</strong></span></a></h5><p><strong>1.åŸç†å›¾</strong></p><figure><a href="https://imgse.com/i/pCCoYfe" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCoYfe.jpg" alt="pCCoYfe.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCoYfe.jpg</figcaption></figure><p><strong>2.æ·»åŠ  upstream(åŒä¸Š)</strong></p><p><strong>3.æ·»åŠ  policy</strong></p><figure><a href="https://imgse.com/i/pCCoJYD" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCoJYD.jpg" alt="pCCoJYD.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCoJYD.jpg</figcaption></figure><h4 id="_10-6-shovel" tabindex="-1"><a class="header-anchor" href="#_10-6-shovel"><span><strong>10.6. Shovel</strong></span></a></h4><h5 id="_10-6-1-ä½¿ç”¨å®ƒçš„åŸå› " tabindex="-1"><a class="header-anchor" href="#_10-6-1-ä½¿ç”¨å®ƒçš„åŸå› "><span><strong>10.6.1. ä½¿ç”¨å®ƒçš„åŸå› </strong></span></a></h5><p>Federation å…·å¤‡çš„æ•°æ®è½¬å‘åŠŸèƒ½ç±»ä¼¼ï¼ŒShovel å¤Ÿå¯é ã€æŒç»­åœ°ä»ä¸€ä¸ª Broker ä¸­çš„é˜Ÿåˆ—(ä½œä¸ºæºç«¯ï¼Œå³ source)æ‹‰å–æ•°æ®å¹¶è½¬å‘è‡³å¦ä¸€ä¸ª Broker ä¸­çš„äº¤æ¢å™¨(ä½œä¸ºç›®çš„ç«¯ï¼Œå³ destination)ã€‚ä½œä¸ºæºç«¯çš„é˜Ÿåˆ—å’Œä½œ ä¸ºç›®çš„ç«¯çš„äº¤æ¢å™¨å¯ä»¥åŒæ—¶ä½äºåŒä¸€ä¸ª Brokerï¼Œä¹Ÿå¯ä»¥ä½äºä¸åŒçš„ Broker ä¸Šã€‚Shovel å¯ä»¥ç¿»è¯‘ä¸º&quot;é“²å­&quot;ï¼Œ æ˜¯ä¸€ç§æ¯”è¾ƒå½¢è±¡çš„æ¯”å–»ï¼Œè¿™ä¸ª&quot;é“²å­&quot;å¯ä»¥å°†æ¶ˆæ¯ä»ä¸€æ–¹&quot;é“²å­&quot;å¦ä¸€æ–¹ã€‚Shovel è¡Œä¸ºå°±åƒä¼˜ç§€çš„å®¢æˆ·ç«¯åº”ç”¨ ç¨‹åºèƒ½å¤Ÿè´Ÿè´£è¿æ¥æºå’Œç›®çš„åœ°ã€è´Ÿè´£æ¶ˆæ¯çš„è¯»å†™åŠè´Ÿè´£è¿æ¥å¤±è´¥é—®é¢˜çš„å¤„ç†ã€‚</p><h5 id="_10-6-2-æ­å»ºæ­¥éª¤" tabindex="-1"><a class="header-anchor" href="#_10-6-2-æ­å»ºæ­¥éª¤"><span><strong>10.6.2. æ­å»ºæ­¥éª¤</strong></span></a></h5><p><strong>1.å¼€å¯æ’ä»¶(éœ€è¦çš„æœºå™¨éƒ½å¼€å¯)</strong></p><blockquote><p><strong>rabbitmq-plugins enable rabbitmq_shovel</strong></p><p><strong>rabbitmq-plugins enable rabbitmq_shovel_management</strong></p><figure><a href="https://imgse.com/i/pCCogpQ" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCogpQ.jpg" alt="pCCogpQ.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCogpQ.jpg</figcaption></figure></blockquote><p><strong>2.åŸç†å›¾(åœ¨æºå¤´å‘é€çš„æ¶ˆæ¯ç›´æ¥å›è¿›å…¥åˆ°ç›®çš„åœ°é˜Ÿåˆ—)</strong></p><figure><a href="https://imgse.com/i/pCCo2lj" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCo2lj.jpg" alt="pCCo2lj.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCo2lj.jpg</figcaption></figure><p><strong>3.æ·»åŠ  shovel æºå’Œç›®çš„åœ°</strong></p><figure><a href="https://imgse.com/i/pCCoR6s" target="_blank" rel="noopener noreferrer"><img src="https://s1.ax1x.com/2023/06/05/pCCoR6s.jpg" alt="pCCoR6s.jpg" tabindex="0" loading="lazy"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><figcaption>pCCoR6s.jpg</figcaption></figure></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/swx08/edit/main/posts/ä¸­é—´ä»¶/MQ/RabbitMQæ¶ˆæ¯é˜Ÿåˆ—.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><!----><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">æ–‡å­¦åšå®¢</div><div class="vp-copyright">Copyright Â© 2024 sixkey </div></footer></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/vuepress/assets/app-DCsLG_oX.js" defer></script>
  </body>
</html>
